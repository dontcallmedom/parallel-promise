{
  "spec": {
    "title": "Payment Request API 1.1",
    "url": "https://w3c.github.io/payment-request/"
  },
  "algorithms": [
    {
      "name": "PaymentRequest.PaymentRequest()",
      "href": "https://w3c.github.io/payment-request/#dfn-paymentrequest-paymentrequest",
      "html": "The <code><dfn data-lt=\"PaymentRequest.PaymentRequest()|PaymentRequest(methodData, details)\" id=\"dfn-paymentrequest-paymentrequest\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">PaymentRequest(<var>methodData<!---0.170566%--></var>,\n          <var>details<!---0.170566%--></var>)</dfn></code> constructor <em class=\"rfc2119\">MUST<!---0.170566%--></em> act as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.170566%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.170566%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document<!---0.170566%--></code><!---0.170566%--></a> is not <a data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use</a> the <a href=\"https://w3c.github.io/payment-request/#dfn-payment\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-1\">\"payment\"</a>\n          permission, then <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a> a \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"securityerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#securityerror\"><code>SecurityError<!---0.170566%--></code></a>\"<!---0.170566%-->\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Establish the request's id:",
          "rationale": "if",
          "steps": [
            {
              "html": "If\n              <var>details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsInit\" data-xref-for=\"PaymentDetailsInit\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsinit-id\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsinit-id-1\"><code>id<!---0.170566%--></code></a><!---0.170566%--> is missing, add an\n              <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsInit\" data-xref-for=\"PaymentDetailsInit\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsinit-id\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsinit-id-2\"><code>id<!---0.170566%--></code></a><!---0.170566%--> member to <var>details<!---0.170566%--></var> and set its value\n              to a <abbr title=\"Universally Unique Identifier\">UUID</abbr>\n              [<cite><a class=\"bibref\" data-link-type=\"biblio\" href=\"https://w3c.github.io/payment-request/#bib-rfc4122\" title=\"A Universally Unique IDentifier (UUID) URN Namespace\">RFC4122<!---0.170566%--></a></cite><!---0.170566%-->]."
            }
          ]
        },
        {
          "html": "Let <var>serializedMethodData<!---0.170566%--></var> be an empty list."
        },
        {
          "html": "Process payment methods:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the length of the <var>methodData<!---0.170566%--></var> sequence is zero, then\n              <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a> a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.170566%--></code></a><!---0.170566%-->, optionally informing the\n              developer that at least one <a href=\"https://w3c.github.io/payment-request/#dfn-payment-method\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-method-10\">payment method</a> is required."
            },
            {
              "html": "Let <var data-type=\"Set\">seenPMIs<!---0.170566%--></var> be the empty <a data-link-type=\"dfn|abstract-op\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"ordered-set\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\">set<!---0.170566%--></a>."
            },
            {
              "html": "For each <var>paymentMethod<!---0.170566%--></var> of <var>methodData<!---0.170566%--></var>:",
              "rationale": "run",
              "steps": [
                {
                  "html": "Run the\n                  steps to <a data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-validate-a-payment-method-identifier\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-validate-a-payment-method-identifier\">validate a payment method identifier</a> with\n                  <var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-supportedmethods-1\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->. If it\n                  returns false, then throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"RangeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-rangeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror\"><code>RangeError<!---0.170566%--></code></a><!---0.170566%--> exception.\n                  Optionally, inform the developer that the payment method\n                  identifier is invalid."
                },
                {
                  "html": "Let <var>pmi<!---0.170566%--></var> be the result of parsing\n                  <var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-supportedmethods-2\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%--> with\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"url\" data-cite-path=\"/\" data-cite-frag=\"concept-basic-url-parser\" data-type=\"dfn\" href=\"https://url.spec.whatwg.org/#concept-basic-url-parser\">basic URL parser<!---0.170566%--></a>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If failure, set <var>pmi<!---0.170566%--></var> to\n                      <var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-supportedmethods-3\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->."
                    }
                  ]
                },
                {
                  "html": "If <var data-type=\"Set\">seenPMIs<!---0.170566%--></var> <a data-link-type=\"dfn|abstract-op\" data-link-for=\"list\" data-xref-for=\"set\" data-lt=\"contain\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"list-contain\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\">contains<!---0.170566%--></a> <var>pmi<!---0.170566%--></var> throw a\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"RangeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-rangeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror\"><code>RangeError<!---0.170566%--></code></a><!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%--> optionally informing the\n                  developer that this <a data-link-type=\"dfn|abstract-op\" data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-pmi\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-pmi\">payment method identifier<!---0.170566%--></a> is a\n                  duplicate."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"set\" data-xref-for=\"set\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"set-append\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\">Append<!---0.170566%--></a> <var>pmi<!---0.170566%--></var> to <var data-type=\"Set\">seenPMIs<!---0.170566%--></var>."
                },
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-data-5\"><code>data<!---0.170566%--></code></a><!---0.170566%--> member of\n                  <var>paymentMethod<!---0.170566%--></var> is missing, let <var>serializedData<!---0.170566%--></var> be null.\n                  Otherwise, let <var>serializedData<!---0.170566%--></var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"serialize a JavaScript value to a JSON string\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"serialize-a-javascript-value-to-a-json-string\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\">serialize<!---0.170566%--></a>\n                  <var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-data-6\"><code>data<!---0.170566%--></code></a><!---0.170566%--> into a JSON\n                  string. Rethrow any exceptions."
                },
                {
                  "html": "If <var>serializedData<!---0.170566%--></var> is not null, and if the specification\n                  that defines the\n                  <var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-supportedmethods-4\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->\n                  specifies an <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Payment Method\" data-xref-for=\"Payment Method\" href=\"https://w3c.github.io/payment-request/#dfn-additional-data-type\" class=\"internalDFN\" id=\"ref-for-dfn-additional-data-type-2\">additional data type<!---0.170566%--></a>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var>object<!---0.170566%--></var> be the result of <a data-cite=\"ECMASCRIPT#sec-json.parse\" href=\"https://tc39.es/ecma262/multipage/#sec-json.parse\">JSON-parsing</a>\n                      <var>serializedData<!---0.170566%--></var>."
                    },
                    {
                      "html": "<p>\n                          Let <var>idl<!---0.170566%--></var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converting<!---0.170566%--></a> <var>object<!---0.170566%--></var> to an IDL value of the\n                          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Payment Method\" data-xref-for=\"Payment Method\" href=\"https://w3c.github.io/payment-request/#dfn-additional-data-type\" class=\"internalDFN\" id=\"ref-for-dfn-additional-data-type-3\">additional data type<!---0.170566%--></a>. Rethrow any\n                          exceptions.\n                        </p>"
                    },
                    {
                      "html": "<p>\n                          Run the <a href=\"https://w3c.github.io/payment-request/#dfn-steps-to-validate-payment-method-data\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-steps-to-validate-payment-method-data-1\">steps to validate payment method data</a>,\n                          if any, from the specification that defines the\n                          <var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-supportedmethods-5\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->\n                          on <var>object<!---0.170566%--></var>. Rethrow any exceptions.\n                        </p>"
                    }
                  ]
                },
                {
                  "html": "Add the tuple\n                  (<var>paymentMethod<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodData\" data-xref-for=\"PaymentMethodData\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethoddata-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethoddata-supportedmethods-6\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->,\n                  <var>serializedData<!---0.170566%--></var>) to <var>serializedMethodData<!---0.170566%--></var>."
                }
              ]
            }
          ]
        },
        {
          "html": "Process the total:",
          "rationale": "check",
          "steps": [
            {
              "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-total-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-total-amount-1\">Check and canonicalize total amount</a>\n                <var>details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsInit\" data-xref-for=\"PaymentDetailsInit\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsinit-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsinit-total-1\"><code>total<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-1\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->.\n                Rethrow any exceptions."
            }
          ]
        },
        {
          "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-1\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%--> member of <var>details<!---0.170566%--></var> is\n          present, then for each <var>item<!---0.170566%--></var> in\n          <var>details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-2\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%-->:",
          "rationale": "check",
          "steps": [
            {
              "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-amount-1\">Check and canonicalize amount</a>\n                <var>item<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-2\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->. Rethrow any exceptions."
            }
          ]
        },
        {
          "html": "Let <var>serializedModifierData<!---0.170566%--></var> be an empty list."
        },
        {
          "html": "Process payment details modifiers:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>modifiers<!---0.170566%--></var> be an empty\n              <code><a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-sequence\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\">sequence</a></code>&lt;<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-1\"><code>PaymentDetailsModifier<!---0.170566%--></code></a><!---0.170566%-->&gt;."
            },
            {
              "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-1\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%--> member of <var>details<!---0.170566%--></var>\n              is present, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var>modifiers<!---0.170566%--></var> to\n                  <var>details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-2\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%-->."
                },
                {
                  "html": "For each <var>modifier<!---0.170566%--></var> of <var>modifiers<!---0.170566%--></var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-total-1\"><code>total<!---0.170566%--></code></a><!---0.170566%--> member of\n                      <var>modifier<!---0.170566%--></var> is present, then:",
                      "rationale": "check",
                      "steps": [
                        {
                          "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-total-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-total-amount-2\">Check and canonicalize total amount</a>\n                            <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-total-2\"><code>total<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-3\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->.\n                            Rethrow any exceptions."
                        }
                      ]
                    },
                    {
                      "html": "If the\n                      <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-additionaldisplayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-additionaldisplayitems-1\"><code>additionalDisplayItems<!---0.170566%--></code></a><!---0.170566%--> member\n                      of <var>modifier<!---0.170566%--></var> is present, then for each <var>item<!---0.170566%--></var> of\n                      <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-additionaldisplayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-additionaldisplayitems-2\"><code>additionalDisplayItems<!---0.170566%--></code></a><!---0.170566%-->:",
                      "rationale": "check",
                      "steps": [
                        {
                          "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-amount-2\">Check and canonicalize amount</a>\n                            <var>item<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-4\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->. Rethrow any\n                            exceptions."
                        }
                      ]
                    },
                    {
                      "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-data-1\"><code>data<!---0.170566%--></code></a><!---0.170566%--> member of\n                      <var>modifier<!---0.170566%--></var> is missing, let <var>serializedData<!---0.170566%--></var> be null.\n                      Otherwise, let <var>serializedData<!---0.170566%--></var> be the result of\n                      <a data-link-type=\"dfn|abstract-op\" data-lt=\"serialize a JavaScript value to a JSON string\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"serialize-a-javascript-value-to-a-json-string\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\">serialize<!---0.170566%--></a>\n                      <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-data-2\"><code>data<!---0.170566%--></code></a><!---0.170566%--> into a JSON\n                      string. Rethrow any exceptions."
                    },
                    {
                      "html": "Add the tuple\n                      (<var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-supportedmethods-1\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->,\n                      <var>serializedData<!---0.170566%--></var>) to <var>serializedModifierData<!---0.170566%--></var>."
                    },
                    {
                      "html": "Remove the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-data-3\"><code>data<!---0.170566%--></code></a><!---0.170566%--> member of\n                      <var>modifier<!---0.170566%--></var>, if it is present."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Set <var>details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-3\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%--> to\n              <var>modifiers<!---0.170566%--></var>."
            }
          ]
        },
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-11\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[handler]]\" href=\"https://w3c.github.io/payment-request/#dfn-handler\" class=\"internalDFN\" id=\"ref-for-dfn-handler-1\"><code>[[handler<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to <code>null<!---0.170566%--></code>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-1\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-created\" class=\"internalDFN\" id=\"ref-for-dfn-created-1\">created<!---0.170566%--></a>\"."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-1\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to false."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[details]]\" href=\"https://w3c.github.io/payment-request/#dfn-details\" class=\"internalDFN\" id=\"ref-for-dfn-details-1\"><code>[[details<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to <var>details<!---0.170566%--></var>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[serializedModifierData]]\" href=\"https://w3c.github.io/payment-request/#dfn-serializedmodifierdata\" class=\"internalDFN\" id=\"ref-for-dfn-serializedmodifierdata-1\"><code>[[serializedModifierData<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          <var>serializedModifierData<!---0.170566%--></var>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[serializedMethodData]]\" href=\"https://w3c.github.io/payment-request/#dfn-serializedmethoddata\" class=\"internalDFN\" id=\"ref-for-dfn-serializedmethoddata-1\"><code>[[serializedMethodData<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          <var>serializedMethodData<!---0.170566%--></var>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-1\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to null."
        },
        {
          "html": "Return <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>."
        }
      ]
    },
    {
      "html": "The <code>show(optional <var>detailsPromise<!---0.170566%--></var>)</code> method <em class=\"rfc2119\">MUST<!---0.170566%--></em> act as\n          follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.170566%--></a>."
        },
        {
          "html": "If the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.170566%--></a> of <a data-link-type=\"dfn|abstract-op\" data-cite=\"fetch\" data-cite-path=\"/\" data-cite-frag=\"concept-request\" data-type=\"dfn\" href=\"https://fetch.spec.whatwg.org/#concept-request\">request<!---0.170566%--></a> does not have\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/interaction.html\" data-cite-frag=\"transient-activation\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\">transient activation<!---0.170566%--></a>, the user agent <em class=\"rfc2119\">MAY<!---0.170566%--></em>:",
          "rationale": "return",
          "steps": [
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with<!---0.170566%--></a> with a \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"securityerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#securityerror\"><code>SecurityError<!---0.170566%--></code></a>\"<!---0.170566%-->\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
            }
          ]
        },
        {
          "html": "Otherwise,\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/interaction.html\" data-cite-frag=\"consume-user-activation\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation\">consume user activation<!---0.170566%--></a> of the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.170566%--></a>."
        },
        {
          "html": "Let <var>document<!---0.170566%--></var> be <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.170566%--></a>'s\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document<!---0.170566%--></code><!---0.170566%--></a>."
        },
        {
          "html": "If <var>document<!---0.170566%--></var> is\n          not <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Document\" data-xref-for=\"Document\" data-cite=\"html\" data-cite-path=\"/document-sequences.html\" data-cite-frag=\"fully-active\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active<!---0.170566%--></a>, then return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected\n          with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var>document<!---0.170566%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Document\" data-xref-for=\"Document\" data-cite=\"html\" data-cite-path=\"/interaction.html\" data-cite-frag=\"visibility-state\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#visibility-state\">visibility state<!---0.170566%--></a> is not <code>\"visible\"<!---0.170566%--></code>,\n          then return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%-->\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "<p>\n              Optionally, if the <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-4\">user agent</a> wishes to disallow the call\n              to <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"show()\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest-show\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-show-8\"><code>show<!---0.170566%--></code></a><code>(<!---0.170566%--><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%--> to protect the user, then return a\n              promise rejected with a \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"securityerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#securityerror\"><code>SecurityError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->. For\n              example, the <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-5\">user agent</a> may limit the rate at which a page\n              can call <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"show()\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest-show\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-show-9\"><code>show<!---0.170566%--></code></a><code>(<!---0.170566%--><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%-->, as described in section\n              <a href=\"https://w3c.github.io/payment-request/#privacy\" class=\"sec-ref\"><bdi class=\"secno\">15. </bdi>\n        Privacy and Security Considerations</a>.\n            </p>"
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-2\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-created\" class=\"internalDFN\" id=\"ref-for-dfn-created-2\">created<!---0.170566%--></a>\" then return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected\n          with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If the <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-6\">user agent</a>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-2\">payment request is showing</a>\n          boolean is true, then:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-3\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n              \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-1\">closed<!---0.170566%--></a>\"."
            },
            {
              "html": "Return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%-->\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
            }
          ]
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-4\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-1\">interactive<!---0.170566%--></a>\"."
        },
        {
          "html": "Let <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var> be <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[acceptPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-acceptpromise\" class=\"internalDFN\" id=\"ref-for-dfn-acceptpromise-1\"><code>[[acceptPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var>."
        },
        {
          "html": "Optionally:",
          "rationale": "reject",
          "steps": [
            {
              "html": "Reject <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var> with an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%-->\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-5\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n              \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-2\">closed<!---0.170566%--></a>\"."
            },
            {
              "html": "Return <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var>."
            }
          ]
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-2\">payment-relevant browsing context</a>'s\n          <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-3\">payment request is showing</a> boolean to true."
        },
        {
          "html": "Return <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var> and perform the remaining steps <a data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in\n          parallel</a>."
        },
        {
          "html": "Let <var data-type=\"list\">handlers<!---0.170566%--></var> be an empty <a data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"list\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">list</a>."
        },
        {
          "html": "For each <var>paymentMethod<!---0.170566%--></var> tuple in\n          <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[serializedMethodData]]\" href=\"https://w3c.github.io/payment-request/#dfn-serializedmethoddata\" class=\"internalDFN\" id=\"ref-for-dfn-serializedmethoddata-2\"><code>[[serializedMethodData<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>identifier<!---0.170566%--></var> be the first element in the <var>paymentMethod<!---0.170566%--></var>\n              tuple."
            },
            {
              "html": "Let <var>data<!---0.170566%--></var> be the result of <a data-cite=\"ECMASCRIPT#sec-json.parse\" href=\"https://tc39.es/ecma262/multipage/#sec-json.parse\">JSON-parsing</a> the second element\n              in the <var>paymentMethod<!---0.170566%--></var> tuple."
            },
            {
              "html": "If the specification that defines the <var>identifier<!---0.170566%--></var> specifies\n              an <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Payment Method\" data-xref-for=\"Payment Method\" href=\"https://w3c.github.io/payment-request/#dfn-additional-data-type\" class=\"internalDFN\" id=\"ref-for-dfn-additional-data-type-4\">additional data type<!---0.170566%--></a>, then <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">convert<!---0.170566%--></a> <var>data<!---0.170566%--></var> to an IDL value of that type.\n              Otherwise, <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">convert<!---0.170566%--></a> <var>data<!---0.170566%--></var> to\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"object\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-object\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-object\"><code>object<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "If conversion results in an <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-exception\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception</a> <var>error<!---0.170566%--></var>:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-6\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n                  \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-3\">closed<!---0.170566%--></a>\"."
                },
                {
                  "html": "Reject <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var> with <var>error<!---0.170566%--></var>."
                },
                {
                  "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-3\">payment-relevant browsing\n                  context</a>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-4\">payment request is showing</a> boolean to\n                  false."
                },
                {
                  "html": "Terminate this algorithm."
                }
              ]
            },
            {
              "html": "Let <var>registeredHandlers<!---0.170566%--></var> be a <a data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"list\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\">list</a> of registered\n              payment handlers for the payment method <var>identifier<!---0.170566%--></var>."
            },
            {
              "html": "For each <var>handler<!---0.170566%--></var> in <var>registeredHandlers<!---0.170566%--></var>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "Let <var>canMakePayment<!---0.170566%--></var> be the result of running <var>handler<!---0.170566%--></var>'s\n                  <a href=\"https://w3c.github.io/payment-request/#dfn-steps-to-check-if-a-payment-can-be-made\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-steps-to-check-if-a-payment-can-be-made-1\">steps to check if a payment can be made</a> with <var>data<!---0.170566%--></var>."
                },
                {
                  "html": "If <var>canMakePayment<!---0.170566%--></var> is true, then append <var>handler<!---0.170566%--></var> to\n                  <var data-type=\"list\">handlers<!---0.170566%--></var>."
                }
              ]
            }
          ]
        },
        {
          "html": "If <var data-type=\"list\">handlers<!---0.170566%--></var> is empty, then:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-7\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n              \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-4\">closed<!---0.170566%--></a>\"."
            },
            {
              "html": "Reject <var data-type=\"Promise\">acceptPromise<!---0.170566%--></var> with \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"notsupportederror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\"><code>NotSupportedError<!---0.170566%--></code></a>\"<!---0.170566%-->\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-4\">payment-relevant browsing context</a>'s\n              <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-5\">payment request is showing</a> boolean to false."
            },
            {
              "html": "Terminate this algorithm."
            }
          ]
        },
        {
          "html": "<p data-cite=\"html\">\n              Present a user interface that will allow the user to interact\n              with the <var data-type=\"list\">handlers<!---0.170566%--></var>. The user agent <em class=\"rfc2119\">SHOULD<!---0.170566%--></em> prioritize the user's\n              preference when presenting payment methods. The user interface\n              <em class=\"rfc2119\">SHOULD<!---0.170566%--></em> be presented using the language and locale-based\n              formatting that matches the <var>document<!---0.170566%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-lt=\"document element\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"document-element\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#document-element\">document element's<!---0.170566%--></a> <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Node\" data-xref-for=\"Node\" data-cite=\"html\" data-cite-path=\"/dom.html\" data-cite-frag=\"language\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#language\">language<!---0.170566%--></a>, if any, or an\n              appropriate fallback if that is not available.\n            </p>"
        },
        {
          "html": "If\n          <var>detailsPromise<!---0.170566%--></var> was passed, then:",
          "rationale": "run",
          "steps": [
            {
              "html": "Run the <a href=\"https://w3c.github.io/payment-request/#dfn-update-a-paymentrequest-s-details-algorithm\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-update-a-paymentrequest-s-details-algorithm-1\">update a <code>PaymentRequest</code>'s details\n              algorithm</a> with <var>detailsPromise<!---0.170566%--></var>, <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>, and null."
            },
            {
              "html": "Wait for the <var>detailsPromise<!---0.170566%--></var> to settle."
            }
          ]
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[handler]]\" href=\"https://w3c.github.io/payment-request/#dfn-handler\" class=\"internalDFN\" id=\"ref-for-dfn-handler-2\"><code>[[handler<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> be the <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-2\">payment\n          handler</a> selected by the end-user."
        },
        {
          "html": "Let <var data-type=\"list\">modifiers<!---0.170566%--></var> be an empty list."
        },
        {
          "html": "For each <var>tuple<!---0.170566%--></var> in\n          <!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[serializedModifierData]]\" href=\"https://w3c.github.io/payment-request/#dfn-serializedmodifierdata\" class=\"internalDFN\" id=\"ref-for-dfn-serializedmodifierdata-2\"><code>[[serializedModifierData<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the first element of <var>tuple<!---0.170566%--></var> (a <a data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-pmi\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-pmi\">PMI</a>) matches the\n              <a data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-pmi\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-pmi\">payment method identifier</a> of\n              <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[handler]]\" href=\"https://w3c.github.io/payment-request/#dfn-handler\" class=\"internalDFN\" id=\"ref-for-dfn-handler-3\"><code>[[handler<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->, then append the second\n              element of <var>tuple<!---0.170566%--></var> (the serialized method data) to <var data-type=\"list\">modifiers<!---0.170566%--></var>."
            }
          ]
        },
        {
          "html": "If <var>document<!---0.170566%--></var> stops being <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Document\" data-xref-for=\"Document\" data-cite=\"html\" data-cite-path=\"/document-sequences.html\" data-cite-frag=\"fully-active\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active<!---0.170566%--></a> while the\n              user interface is being shown, or no longer is by the time this\n              step is reached, then:",
          "rationale": "close",
          "steps": [
            {
              "html": "Close down the user interface."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-5\">payment-relevant browsing context</a>'s\n              <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-6\">payment request is showing</a> boolean to false."
            }
          ]
        }
      ]
    },
    {
      "html": "The <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"abort()\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest-abort\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-abort-5\"><code>abort<!---0.170566%--></code></a><code>(<!---0.170566%--><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%--> method <em class=\"rfc2119\">MUST<!---0.170566%--></em> act as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.170566%--></a>."
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-2\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not null, and\n          <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-3\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-1\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->\n          is not null, return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an\n          \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If the value of <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-8\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-2\">interactive<!---0.170566%--></a>\" then return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected\n          with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Let <var data-type=\"Promise\">promise<!---0.170566%--></var> be <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Return <var data-type=\"Promise\">promise<!---0.170566%--></var> and perform the remaining steps <a data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in\n          parallel</a>."
        },
        {
          "html": "Try to abort the current user interaction with the <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-6\">payment\n          handler</a> and close down any remaining user interface."
        },
        {
          "html": "<a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"user-interaction-task-source\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\">user interaction task source</a> to\n            perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If it is not possible to abort the current user interaction,\n              then reject <var data-type=\"Promise\">promise<!---0.170566%--></var> with \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%-->\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%--> and abort these steps."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-9\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n              \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-5\">closed<!---0.170566%--></a>\"."
            },
            {
              "html": "Reject the promise\n              <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[acceptPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-acceptpromise\" class=\"internalDFN\" id=\"ref-for-dfn-acceptpromise-3\"><code>[[acceptPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> with an\n              \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "Resolve <var data-type=\"Promise\">promise<!---0.170566%--></var> with undefined."
            }
          ]
        }
      ]
    },
    {
      "name": "check and canonicalize amount",
      "href": "https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-amount",
      "html": "To <dfn id=\"dfn-check-and-canonicalize-amount\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">check and canonicalize amount</dfn> given a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-3\"><code>PaymentCurrencyAmount<!---0.170566%--></code></a><!---0.170566%--> <var>amount<!---0.170566%--></var>, run the following steps:",
      "rationale": "if",
      "steps": [
        {
          "html": "If the result of <a data-cite=\"ecma-402#sec-iswellformedcurrencycode\" href=\"https://tc39.es/ecma402/#sec-iswellformedcurrencycode\">IsWellFormedCurrencyCode</a>(<var>amount<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentCurrencyAmount\" data-xref-for=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-currency\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-currency-3\"><code>currency<!---0.170566%--></code></a><!---0.170566%-->)\n          is false, then throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"RangeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-rangeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror\"><code>RangeError<!---0.170566%--></code></a><!---0.170566%--> exception, optionally informing\n          the developer that the currency is invalid."
        },
        {
          "html": "If <var>amount<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentCurrencyAmount\" data-xref-for=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-value\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-value-2\"><code>value<!---0.170566%--></code></a><!---0.170566%--> is not a <a href=\"https://w3c.github.io/payment-request/#dfn-valid-decimal-monetary-value\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-valid-decimal-monetary-value-2\">valid\n          decimal monetary value</a>, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.170566%--></code></a><!---0.170566%-->, optionally\n          informing the developer that the currency is invalid."
        },
        {
          "html": "Set <var>amount<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentCurrencyAmount\" data-xref-for=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-currency\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-currency-4\"><code>currency<!---0.170566%--></code></a><!---0.170566%--> to the result of\n          <a data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"ascii-uppercase\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ascii-uppercase\">ASCII uppercase</a> <var>amount<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentCurrencyAmount\" data-xref-for=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-currency\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-currency-5\"><code>currency<!---0.170566%--></code></a><!---0.170566%-->."
        }
      ]
    },
    {
      "name": "check and canonicalize total amount",
      "href": "https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-total-amount",
      "html": "To <dfn id=\"dfn-check-and-canonicalize-total-amount\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">check and canonicalize total amount</dfn> given a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-4\"><code>PaymentCurrencyAmount<!---0.170566%--></code></a><!---0.170566%--> <var data-type=\"PaymentCurrencyAmount\">amount<!---0.170566%--></var>, run the\n          following steps:",
      "rationale": "check",
      "steps": [
        {
          "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-amount-4\">Check and canonicalize amount</a> <var data-type=\"PaymentCurrencyAmount\">amount<!---0.170566%--></var>. Rethrow any\n            exceptions."
        },
        {
          "html": "If the first <a data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"code-point\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#code-point\">code point</a> of\n          <var data-type=\"PaymentCurrencyAmount\">amount<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentCurrencyAmount\" data-xref-for=\"PaymentCurrencyAmount\" href=\"https://w3c.github.io/payment-request/#dom-paymentcurrencyamount-value\" class=\"internalDFN\" id=\"ref-for-dom-paymentcurrencyamount-value-3\"><code>value<!---0.170566%--></code></a><!---0.170566%--> is U+002D (-), then throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.170566%--></code></a><!---0.170566%--> optionally informing the developer that a total's value\n          can't be a negative number."
        }
      ]
    },
    {
      "html": "The <code>retry(<var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var>)</code> method\n          <em class=\"rfc2119\">MUST<!---0.170566%--></em> act as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.170566%--></a>."
        },
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be\n          <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[request]]\" href=\"https://w3c.github.io/payment-request/#dfn-request\" class=\"internalDFN\" id=\"ref-for-dfn-request-1\"><code>[[request<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Let <var data-type=\"Document\">document<!---0.170566%--></var> be <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global\n          object</a>'s <a data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated <code>Document<!---0.170566%--></code></a>."
        },
        {
          "html": "If\n          <var data-type=\"Document\">document<!---0.170566%--></var> is not <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Document\" data-xref-for=\"Document\" data-cite=\"html\" data-cite-path=\"/document-sequences.html\" data-cite-frag=\"fully-active\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active<!---0.170566%--></a>, then return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise\n          rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[complete]]\" href=\"https://w3c.github.io/payment-request/#dfn-complete\" class=\"internalDFN\" id=\"ref-for-dfn-complete-1\"><code>[[complete<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is true, return\n          <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%-->\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-3\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not null,\n          return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%-->\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-10\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-4\">interactive<!---0.170566%--></a>\"."
        },
        {
          "html": "Let <var data-type=\"Promise\">retryPromise<!---0.170566%--></var> be <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-4\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          <var data-type=\"Promise\">retryPromise<!---0.170566%--></var>."
        },
        {
          "html": "If <var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var> was passed:",
          "rationale": "if",
          "steps": [
            {
              "html": "If\n              <var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentValidationErrors\" data-xref-for=\"PaymentValidationErrors\" href=\"https://w3c.github.io/payment-request/#dom-paymentvalidationerrors-paymentmethod\" class=\"internalDFN\" id=\"ref-for-dom-paymentvalidationerrors-paymentmethod-1\"><code>paymentMethod<!---0.170566%--></code></a><!---0.170566%-->\n              member was passed, and if required by the specification that\n              defines <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-methodname-2\"><code>methodName<!---0.170566%--></code></a><!---0.170566%-->, then\n              <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">convert<!---0.170566%--></a> <var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var>'s\n              <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentValidationErrors\" data-xref-for=\"PaymentValidationErrors\" href=\"https://w3c.github.io/payment-request/#dom-paymentvalidationerrors-paymentmethod\" class=\"internalDFN\" id=\"ref-for-dom-paymentvalidationerrors-paymentmethod-2\"><code>paymentMethod<!---0.170566%--></code></a><!---0.170566%--> member to an IDL value\n              of the type specified there. Otherwise, <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">convert<!---0.170566%--></a> to <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"object\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-object\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-object\"><code>object<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-6\">payment-relevant browsing context</a>'s\n              <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-7\">payment request is showing</a> boolean to false."
            },
            {
              "html": "If conversion results in a <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-exception\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception</a> <var>error<!---0.170566%--></var>:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "Reject <var data-type=\"Promise\">retryPromise<!---0.170566%--></var> with <var>error<!---0.170566%--></var>."
                },
                {
                  "html": "Set <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-19\">user agent</a>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-8\">payment request is showing</a>\n                  boolean to false."
                },
                {
                  "html": "Return."
                }
              ]
            },
            {
              "html": "By matching the members of <var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var> to input fields in\n              the user agent's UI, indicate to the end user that something is\n              wrong with the data of the payment response. For example, a user\n              agent might draw the user's attention to the erroneous\n              <var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var> in the browser's UI and display the value of each\n              field in a manner that helps the user fix each error. Similarly,\n              if the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentValidationErrors\" data-xref-for=\"PaymentValidationErrors\" href=\"https://w3c.github.io/payment-request/#dom-paymentvalidationerrors-error\" class=\"internalDFN\" id=\"ref-for-dom-paymentvalidationerrors-error-1\"><code>error<!---0.170566%--></code></a><!---0.170566%--> member is passed,\n              present the error in the user agent's UI. In the case where the\n              value of a member is the empty string, the user agent <em class=\"rfc2119\">MAY<!---0.170566%--></em>\n              substitute a value with a suitable error message."
            }
          ]
        },
        {
          "html": "Otherwise, if <var data-type=\"PaymentValidationErrors\">errorFields<!---0.170566%--></var> was not passed, signal to the end\n          user to attempt to retry the payment. Re-enable any UI element that\n          affords the end user the ability to retry accepting the payment\n          request."
        },
        {
          "html": "<span data-tests=\"payment-response/rejects_if_not_active-manual.https.html\">If\n            <var data-type=\"Document\">document<!---0.170566%--></var> stops being <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Document\" data-xref-for=\"Document\" data-cite=\"html\" data-cite-path=\"/document-sequences.html\" data-cite-frag=\"fully-active\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active<!---0.170566%--></a> while the user\n            interface is being shown, or no longer is by the time this step is\n            reached, then:</span>",
          "rationale": "close",
          "steps": [
            {
              "html": "Close down the user interface."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-7\">payment-relevant browsing context</a>'s\n              <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-9\">payment request is showing</a> boolean to false."
            }
          ]
        },
        {
          "html": "Finally, when <var data-type=\"Promise\">retryPromise<!---0.170566%--></var> settles, set\n          <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-5\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to null."
        },
        {
          "html": "Return <var data-type=\"Promise\">retryPromise<!---0.170566%--></var>."
        }
      ]
    },
    {
      "html": "The <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"complete()\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-complete\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-complete-8\"><code>complete<!---0.170566%--></code></a><code>(<!---0.170566%--><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%--> method <em class=\"rfc2119\">MUST<!---0.170566%--></em> act as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.170566%--></a>."
        },
        {
          "html": "If <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[complete]]\" href=\"https://w3c.github.io/payment-request/#dfn-complete\" class=\"internalDFN\" id=\"ref-for-dfn-complete-2\"><code>[[complete<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is true, return\n          <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%-->\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-6\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not null,\n          return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%-->\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Let <var data-type=\"Promise\">promise<!---0.170566%--></var> be <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Let <var>serializedData<!---0.170566%--></var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"serialize a JavaScript value to a JSON string\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"serialize-a-javascript-value-to-a-json-string\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\">serialize<!---0.170566%--></a>\n          <var>details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentCompleteDetails\" data-xref-for=\"PaymentCompleteDetails\" href=\"https://w3c.github.io/payment-request/#dom-paymentcompletedetails-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentcompletedetails-data-2\"><code>data<!---0.170566%--></code></a><!---0.170566%--> into a JSON string."
        },
        {
          "html": "If serializing <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throws<!---0.170566%--></a> an exception, return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a\n          promise rejected with</a> that exception."
        },
        {
          "html": "If required by the specification that defines the\n          <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-methodname-3\"><code>methodName<!---0.170566%--></code></a><!---0.170566%-->:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>json<!---0.170566%--></var> be the result of calling <code>JSON<!---0.170566%--></code>'s <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"JSON\" data-xref-for=\"JSON\" data-lt=\"parse()\" data-cite=\"ecmascript\" data-cite-path=\"/structured-data.html\" data-cite-frag=\"sec-json.parse\" data-type=\"method\" href=\"https://tc39.es/ecma262/multipage/structured-data.html#sec-json.parse\"><code>parse<!---0.170566%--></code></a><code>(<!---0.170566%--><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%-->\n              with <var>serializedData<!---0.170566%--></var>."
            },
            {
              "html": "Let <var>idl<!---0.170566%--></var> be the result of <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converting<!---0.170566%--></a> <var>json<!---0.170566%--></var> to an IDL value of the type specified\n              by the specification that defines the\n              <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-methodname-4\"><code>methodName<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "If the conversion to an IDL value <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throws<!---0.170566%--></a> an\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-exception\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception<!---0.170566%--></a>, return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> that\n              exception."
            },
            {
              "html": "If required by the specification that defines the\n              <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-methodname-5\"><code>methodName<!---0.170566%--></code></a><!---0.170566%-->, validate the members\n              of <var>idl<!---0.170566%--></var>. If a member's value is invalid, return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise\n              rejected with</a> a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"ecmascript\" data-cite-path=\"/fundamental-objects.html\" data-cite-frag=\"sec-native-error-types-used-in-this-standard-typeerror\" data-type=\"exception\" href=\"https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-native-error-types-used-in-this-standard-typeerror\"><code>TypeError<!---0.170566%--></code></a><!---0.170566%-->."
            }
          ]
        },
        {
          "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[complete]]\" href=\"https://w3c.github.io/payment-request/#dfn-complete\" class=\"internalDFN\" id=\"ref-for-dfn-complete-3\"><code>[[complete<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to true."
        },
        {
          "html": "Return <var data-type=\"Promise\">promise<!---0.170566%--></var> and perform the remaining steps <a data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in\n          parallel</a>."
        },
        {
          "html": "If <var>document<!---0.170566%--></var> stops being <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Document\" data-xref-for=\"Document\" data-cite=\"html\" data-cite-path=\"/document-sequences.html\" data-cite-frag=\"fully-active\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\">fully active<!---0.170566%--></a> while the\n          user interface is being shown, or no longer is by the time this step\n          is reached, then:",
          "rationale": "close",
          "steps": [
            {
              "html": "Close down the user interface."
            },
            {
              "html": "Set <var>request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-8\">payment-relevant browsing context</a>'s\n              <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-10\">payment request is showing</a> boolean to false."
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "close",
          "steps": [
            {
              "html": "Close down any remaining user interface. The <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-21\">user\n              agent</a> <em class=\"rfc2119\">MAY<!---0.170566%--></em> use the value <var>result<!---0.170566%--></var> and <var>serializedData<!---0.170566%--></var> to\n              influence the user experience."
            },
            {
              "html": "Set <var>request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-9\">payment-relevant browsing context</a>'s\n              <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-11\">payment request is showing</a> boolean to false."
            },
            {
              "html": "Resolve <var data-type=\"Promise\">promise<!---0.170566%--></var> with undefined."
            }
          ]
        }
      ]
    },
    {
      "html": "The <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequestUpdateEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequestupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequestupdateevent-4\"><code>PaymentRequestUpdateEvent<!---0.170566%--></code></a><!---0.170566%-->'s\n            <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"constructor(type, eventInitDict)\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequestupdateevent-constructor\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequestupdateevent-constructor-2\"><code>constructor<!---0.170566%--></code></a><code>(<var>type<!---0.170566%--></var><!---0.170566%-->, <!---0.170566%--><!---0.170566%--><var>eventInitDict<!---0.170566%--></var><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%--> <em class=\"rfc2119\">MUST<!---0.170566%--></em>\n            act as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var> be the result of calling\n            the <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"concept-event-constructor\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-constructor\">constructor<!---0.170566%--></a> of <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequestUpdateEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequestupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequestupdateevent-5\"><code>PaymentRequestUpdateEvent<!---0.170566%--></code></a><!---0.170566%--> with\n            <var>type<!---0.170566%--></var> and <var>eventInitDict<!---0.170566%--></var>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"[[waitForUpdate]]\" href=\"https://w3c.github.io/payment-request/#dfn-waitforupdate\" class=\"internalDFN\" id=\"ref-for-dfn-waitforupdate-1\"><code>[[waitForUpdate<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n            false."
        },
        {
          "html": "Return <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>."
        }
      ]
    },
    {
      "html": "The <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"method\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"updateWith()\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequestupdateevent-updatewith\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequestupdateevent-updatewith-7\"><code>updateWith<!---0.170566%--></code></a><code>(<!---0.170566%--><!---0.170566%--><!---0.170566%-->)</code><!---0.170566%--><!---0.170566%--> with\n            <var data-type=\"Promise\">detailsPromise<!---0.170566%--></var> method <em class=\"rfc2119\">MUST<!---0.170566%--></em> act as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.170566%--></a>."
        },
        {
          "html": "If <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>'s <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"dom-event-istrusted\" data-type=\"attribute\" href=\"https://dom.spec.whatwg.org/#dom-event-istrusted\"><code>isTrusted<!---0.170566%--></code></a><!---0.170566%--> attribute is false, then\n            <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"[[waitForUpdate]]\" href=\"https://w3c.github.io/payment-request/#dfn-waitforupdate\" class=\"internalDFN\" id=\"ref-for-dfn-waitforupdate-3\"><code>[[waitForUpdate<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is\n            true, then <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%-->\n            <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"event-target\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#event-target\">target<!---0.170566%--></a> is an instance of\n            <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-17\"><code>PaymentResponse<!---0.170566%--></code></a><!---0.170566%-->, let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>'s\n            <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"event-target\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#event-target\">target<!---0.170566%--></a>'s <!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[request]]\" href=\"https://w3c.github.io/payment-request/#dfn-request\" class=\"internalDFN\" id=\"ref-for-dfn-request-2\"><code>[[request<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Otherwise, let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be the value of\n            <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"event-target\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#event-target\">target<!---0.170566%--></a>."
        },
        {
          "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> is an instance of <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-23\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-11\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not\n            \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-5\">interactive<!---0.170566%--></a>\", then <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a> an\n            \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-2\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is true, then\n            <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Set <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"stop-propagation-flag\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#stop-propagation-flag\">stop propagation flag<!---0.170566%--></a> and <a data-link-type=\"dfn|abstract-op\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"stop-immediate-propagation-flag\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#stop-immediate-propagation-flag\">stop immediate propagation flag<!---0.170566%--></a>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"[[waitForUpdate]]\" href=\"https://w3c.github.io/payment-request/#dfn-waitforupdate\" class=\"internalDFN\" id=\"ref-for-dfn-waitforupdate-4\"><code>[[waitForUpdate<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n            true."
        },
        {
          "html": "Let <var data-type=\"URL or null\">pmi<!---0.170566%--></var> be null."
        },
        {
          "html": "If <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var> has a <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodChangeEvent\" data-xref-for=\"PaymentMethodChangeEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethodchangeevent-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethodchangeevent-methodname-2\"><code>methodName<!---0.170566%--></code></a><!---0.170566%-->\n            attribute, set <var data-type=\"URL or null\">pmi<!---0.170566%--></var> to the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodChangeEvent\" data-xref-for=\"PaymentMethodChangeEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethodchangeevent-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethodchangeevent-methodname-3\"><code>methodName<!---0.170566%--></code></a><!---0.170566%-->\n            attribute's value."
        },
        {
          "html": "Run the <a href=\"https://w3c.github.io/payment-request/#dfn-update-a-paymentrequest-s-details-algorithm\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-update-a-paymentrequest-s-details-algorithm-3\">update a <code>PaymentRequest</code>'s details\n            algorithm</a> with <var data-type=\"Promise\">detailsPromise<!---0.170566%--></var>, <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>, and <var data-type=\"URL or null\">pmi<!---0.170566%--></var>."
        }
      ]
    },
    {
      "name": "can make payment algorithm",
      "href": "https://w3c.github.io/payment-request/#dfn-can-make-payment-algorithm",
      "html": "The <dfn id=\"dfn-can-make-payment-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">can make payment algorithm</dfn> checks if the <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-24\">user\n          agent</a> supports making payment with the <a href=\"https://w3c.github.io/payment-request/#dfn-payment-method\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-method-23\">payment methods</a>\n          with which the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-25\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> was constructed.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-26\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> object on\n          which the method was called."
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-13\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-created\" class=\"internalDFN\" id=\"ref-for-dfn-created-4\">created<!---0.170566%--></a>\", then return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected\n          with</a> an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Optionally, at the <a data-cite=\"html\" data-cite-path=\"/document-sequences.html\" data-cite-frag=\"top-level-browsing-context\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#top-level-browsing-context\">top-level browsing\n          context</a>'s discretion, return <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-rejected-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\">a promise rejected with</a> a\n          \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"notallowederror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Let <var data-type=\"Promise\">hasHandlerPromise<!---0.170566%--></var> be <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise</a>."
        },
        {
          "html": "Return <var data-type=\"Promise\">hasHandlerPromise<!---0.170566%--></var>, and perform the remaining steps <a data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in\n          parallel</a>."
        },
        {
          "html": "For each <var>paymentMethod<!---0.170566%--></var> tuple in <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.\n          <!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[serializedMethodData]]\" href=\"https://w3c.github.io/payment-request/#dfn-serializedmethoddata\" class=\"internalDFN\" id=\"ref-for-dfn-serializedmethoddata-3\"><code>[[serializedMethodData<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>identifier<!---0.170566%--></var> be the first element in the <var>paymentMethod<!---0.170566%--></var>\n              tuple."
            },
            {
              "html": "If the user agent has a <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-11\">payment handler</a> that supports\n              handling payment requests for <var>identifier<!---0.170566%--></var>, resolve\n              <var data-type=\"Promise\">hasHandlerPromise<!---0.170566%--></var> with true and terminate this algorithm."
            }
          ]
        },
        {
          "html": "Resolve <var data-type=\"Promise\">hasHandlerPromise<!---0.170566%--></var> with false."
        }
      ]
    },
    {
      "name": "payment handler/payment method changed algorithm",
      "href": "https://w3c.github.io/payment-request/#dfn-payment-method-changed-algorithm",
      "html": "A <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-12\">payment handler</a> <em class=\"rfc2119\">MAY<!---0.170566%--></em> run the <dfn data-export=\"\" data-dfn-for=\"payment handler\" id=\"dfn-payment-method-changed-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">payment method changed algorithm</dfn>\n          when the user changes <a href=\"https://w3c.github.io/payment-request/#dfn-payment-method\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-method-25\">payment method</a> with <var>methodDetails<!---0.170566%--></var>,\n          which is a <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-dictionary\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-dictionary\">dictionary</a> or an <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"object\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-object\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-object\"><code>object<!---0.170566%--></code></a><!---0.170566%--> or null, and a\n          <var>methodName<!---0.170566%--></var>, which is a DOMString that represents the <a data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-pmi\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-pmi\">payment\n          method identifier</a> of the <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-13\">payment handler</a> the user is\n          interacting with.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-28\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> object\n          that the user is interacting with."
        },
        {
          "html": "<a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"user-interaction-task-source\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\">user interaction task source</a> to\n            run the following steps:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-3\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is false.\n              Only one update can take place at a time."
            },
            {
              "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-14\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is\n              \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-7\">interactive<!---0.170566%--></a>\"."
            },
            {
              "html": "<a data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"concept-event-fire\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">Fire an event</a> named \"<a href=\"https://w3c.github.io/payment-request/#dfn-paymentmethodchange\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-paymentmethodchange-2\"><code>paymentmethodchange</code></a>\" at\n                <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> using <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentMethodChangeEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethodchangeevent\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethodchangeevent-4\"><code>PaymentMethodChangeEvent<!---0.170566%--></code></a><!---0.170566%-->, with its\n                <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodChangeEvent\" data-xref-for=\"PaymentMethodChangeEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethodchangeevent-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethodchangeevent-methodname-4\"><code>methodName<!---0.170566%--></code></a><!---0.170566%--> attribute initialized\n                to <var>methodName<!---0.170566%--></var>, and its\n                <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentMethodChangeEvent\" data-xref-for=\"PaymentMethodChangeEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentmethodchangeevent-methoddetails\" class=\"internalDFN\" id=\"ref-for-dom-paymentmethodchangeevent-methoddetails-2\"><code>methodDetails<!---0.170566%--></code></a><!---0.170566%--> attribute\n                initialized to <var>methodDetails<!---0.170566%--></var>."
            }
          ]
        }
      ]
    },
    {
      "name": "PaymentRequest updated algorithm",
      "href": "https://w3c.github.io/payment-request/#dfn-paymentrequest-updated-algorithm",
      "html": "The <dfn id=\"dfn-paymentrequest-updated-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\" class=\"respec-offending-element\" title=\"Found definition for &quot;PaymentRequest updated algorithm&quot;, but nothing links to it. This is usually a spec bug!\">PaymentRequest updated algorithm</dfn> is run by other\n          algorithms above to <a data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"concept-event-fire\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\">fire an event</a> to indicate that a user has\n          made a change to a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-29\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> called <var>request<!---0.170566%--></var> with an event\n          name of <var>name<!---0.170566%--></var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-4\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is false. Only\n          one update can take place at a time."
        },
        {
          "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-15\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-8\">interactive<!---0.170566%--></a>\"."
        },
        {
          "html": "Let <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var> be the result of\n          <a data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"concept-event-create\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-create\">creating an event</a> using the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequestUpdateEvent\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequestupdateevent\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequestupdateevent-8\"><code>PaymentRequestUpdateEvent<!---0.170566%--></code></a><!---0.170566%-->\n          interface."
        },
        {
          "html": "Initialize <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>'s <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"Event\" data-xref-for=\"Event\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"dom-event-type\" data-type=\"attribute\" href=\"https://dom.spec.whatwg.org/#dom-event-type\"><code>type<!---0.170566%--></code></a><!---0.170566%--> attribute to <var>name<!---0.170566%--></var>."
        },
        {
          "html": "<a data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"concept-event-dispatch\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-dispatch\">Dispatch</a> <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var> at <var>request<!---0.170566%--></var>."
        },
        {
          "html": "If <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"[[waitForUpdate]]\" href=\"https://w3c.github.io/payment-request/#dfn-waitforupdate\" class=\"internalDFN\" id=\"ref-for-dfn-waitforupdate-5\"><code>[[waitForUpdate<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is\n          true, disable any part of the user interface that could cause another\n          update event to be fired."
        },
        {
          "html": "Otherwise, set\n          <var data-type=\"PaymentRequestUpdateEvent\">event<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequestUpdateEvent\" data-xref-for=\"PaymentRequestUpdateEvent\" data-lt=\"[[waitForUpdate]]\" href=\"https://w3c.github.io/payment-request/#dfn-waitforupdate\" class=\"internalDFN\" id=\"ref-for-dfn-waitforupdate-6\"><code>[[waitForUpdate<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to true."
        }
      ]
    },
    {
      "name": "user accepts the payment request algorithm",
      "href": "https://w3c.github.io/payment-request/#dfn-user-accepts-the-payment-request-algorithm",
      "html": "The <dfn data-local-lt=\"user accepts the payment request\" data-export=\"\" data-lt=\"user accepts the payment request algorithm|user accepts the payment request\" id=\"dfn-user-accepts-the-payment-request-algorithm\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">user accepts the payment request algorithm</dfn> runs\n          when the user accepts the payment request and confirms that they want\n          to pay. It <em class=\"rfc2119\">MUST<!---0.170566%--></em> <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">queue a task</a> on the <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"user-interaction-task-source\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\">user interaction task\n          source</a> to perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-30\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> object\n          that the user is interacting with."
        },
        {
          "html": "If the <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-5\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is true, then\n          terminate this algorithm and take no further action. The <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-25\">user\n          agent</a> user interface <em class=\"rfc2119\">SHOULD<!---0.170566%--></em> ensure that this never occurs."
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-16\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-9\">interactive<!---0.170566%--></a>\", then terminate this algorithm and\n          take no further action. The <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-26\">user agent</a> user interface <em class=\"rfc2119\">SHOULD<!---0.170566%--></em>\n          ensure that this never occurs."
        },
        {
          "html": "Let <var data-type=\"boolean\">isRetry<!---0.170566%--></var> be true if\n          <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-4\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not null, false\n          otherwise."
        },
        {
          "html": "Let <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> be\n          <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-5\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> if <var data-type=\"boolean\">isRetry<!---0.170566%--></var> is true, or a\n          new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-18\"><code>PaymentResponse<!---0.170566%--></code></a><!---0.170566%--> otherwise."
        },
        {
          "html": "If <var data-type=\"boolean\">isRetry<!---0.170566%--></var> is false, initialize the newly created <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[request]]\" href=\"https://w3c.github.io/payment-request/#dfn-request\" class=\"internalDFN\" id=\"ref-for-dfn-request-3\"><code>[[request<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>."
            },
            {
              "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-7\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to null."
            },
            {
              "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[complete]]\" href=\"https://w3c.github.io/payment-request/#dfn-complete\" class=\"internalDFN\" id=\"ref-for-dfn-complete-4\"><code>[[complete<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to false."
            },
            {
              "html": "Set the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-requestid\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-requestid-2\"><code>requestId<!---0.170566%--></code></a><!---0.170566%--> attribute value of\n              <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> to the value of\n              <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[details]]\" href=\"https://w3c.github.io/payment-request/#dfn-details\" class=\"internalDFN\" id=\"ref-for-dfn-details-4\"><code>[[details<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsInit\" data-xref-for=\"PaymentDetailsInit\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsinit-id\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsinit-id-7\"><code>id<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-6\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>."
            }
          ]
        },
        {
          "html": "Let <var data-type=\"payment handler\">handler<!---0.170566%--></var> be\n          <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[handler]]\" href=\"https://w3c.github.io/payment-request/#dfn-handler\" class=\"internalDFN\" id=\"ref-for-dfn-handler-4\"><code>[[handler<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Set the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-methodname\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-methodname-6\"><code>methodName<!---0.170566%--></code></a><!---0.170566%--> attribute value of\n          <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> to the <a data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-pmi\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-pmi\">payment method identifier</a> of <var data-type=\"payment handler\">handler<!---0.170566%--></var>."
        },
        {
          "html": "Set the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" href=\"https://w3c.github.io/payment-request/#dom-paymentresponse-details\" class=\"internalDFN\" id=\"ref-for-dom-paymentresponse-details-2\"><code>details<!---0.170566%--></code></a><!---0.170566%--> attribute value of <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>\n          to an object resulting from running the <var data-type=\"payment handler\">handler<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-steps-to-respond-to-a-payment-request\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-steps-to-respond-to-a-payment-request-1\">steps to\n          respond to a payment request</a>."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-17\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-8\">closed<!---0.170566%--></a>\"."
        },
        {
          "html": "If <var data-type=\"boolean\">isRetry<!---0.170566%--></var> is true, resolve\n          <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-8\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> with undefined.\n          Otherwise, resolve <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[acceptPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-acceptpromise\" class=\"internalDFN\" id=\"ref-for-dfn-acceptpromise-5\"><code>[[acceptPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->\n          with <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>."
        }
      ]
    },
    {
      "name": "user aborts the payment request",
      "href": "https://w3c.github.io/payment-request/#dfn-user-aborts-the-payment-request",
      "html": "The <dfn data-lt=\"user aborts the payment request|user aborts the payment request algorithm\" id=\"dfn-user-aborts-the-payment-request\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">user aborts the\n          payment request algorithm</dfn> runs when the user aborts the payment\n          request through the currently interactive user interface. It <em class=\"rfc2119\">MUST<!---0.170566%--></em>\n          <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">queue a task</a> on the <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"user-interaction-task-source\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\">user interaction task source</a> to\n          perform the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Let <var data-type=\"PaymentRequest\">request<!---0.170566%--></var> be the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-31\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> object\n          that the user is interacting with."
        },
        {
          "html": "If <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-18\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is not\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-interactive\" class=\"internalDFN\" id=\"ref-for-dfn-interactive-10\">interactive<!---0.170566%--></a>\", then terminate this algorithm and\n          take no further action. The <a href=\"https://w3c.github.io/payment-request/#dfn-user-agent\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-agent-27\">user agent</a> user interface <em class=\"rfc2119\">SHOULD<!---0.170566%--></em>\n          ensure that this never occurs."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-19\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n          \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-9\">closed<!---0.170566%--></a>\"."
        },
        {
          "html": "Set <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-10\">payment-relevant browsing context</a>'s\n          <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-12\">payment request is showing</a> boolean to false."
        },
        {
          "html": "Let <var>error<!---0.170566%--></var> be an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%--> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "Let <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> be\n          <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-7\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->."
        },
        {
          "html": "If <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> is not null:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[complete]]\" href=\"https://w3c.github.io/payment-request/#dfn-complete\" class=\"internalDFN\" id=\"ref-for-dfn-complete-5\"><code>[[complete<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to true."
            },
            {
              "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-9\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> is\n              not null."
            },
            {
              "html": "Reject <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-10\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> with\n              <var>error<!---0.170566%--></var>."
            }
          ]
        },
        {
          "html": "Otherwise, reject <var data-type=\"PaymentRequest\">request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[acceptPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-acceptpromise\" class=\"internalDFN\" id=\"ref-for-dfn-acceptpromise-6\"><code>[[acceptPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->\n          with <var>error<!---0.170566%--></var>."
        },
        {
          "html": "Abort the current user interaction and close down any remaining\n          user interface."
        }
      ]
    },
    {
      "html": "In the case where a timeout occurs, or the user manually aborts, or\n          the <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-14\">payment handler</a> decides to abort this particular payment,\n          the user agent <em class=\"rfc2119\">MUST<!---0.170566%--></em> run the <a href=\"https://w3c.github.io/payment-request/#dfn-user-aborts-the-payment-request\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-user-aborts-the-payment-request-7\">user aborts the payment request\n          algorithm</a>.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Set <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-6\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to true."
        },
        {
          "html": "<a data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">In parallel</a>, disable the user interface that allows the user\n            to accept the payment request. This is to ensure that the payment\n            is not accepted until the user interface is updated with any new\n            details."
        },
        {
          "html": "<a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"upon-rejection\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-rejection\">Upon rejection</a> of <var>detailsPromise<!---0.170566%--></var>:",
          "rationale": "abort",
          "steps": [
            {
              "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-2\">Abort the update</a> with <var>request<!---0.170566%--></var> and an \"<a data-link-type=\"idl\" data-cite=\"webidl\" data-xref-type=\"exception\" data-cite-path=\"/\" data-cite-frag=\"aborterror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#aborterror\"><code>AbortError<!---0.170566%--></code></a>\"<!---0.170566%-->\n                <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.170566%--></code></a><!---0.170566%-->."
            }
          ]
        },
        {
          "html": "<a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"upon-fulfillment\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#upon-fulfillment\">Upon fulfillment</a> of <var>detailsPromise<!---0.170566%--></var> with value <var>value<!---0.170566%--></var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var> be the result of\n              <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converting<!---0.170566%--></a> <var>value<!---0.170566%--></var> to a\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-9\"><code>PaymentDetailsUpdate<!---0.170566%--></code></a><!---0.170566%--> dictionary. If this <a data-link-type=\"dfn|abstract-op\" data-link-for=\"exception\" data-xref-for=\"exception\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-throw\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-throw\">throw<!---0.170566%--></a>\n              an exception, <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-3\">abort the update</a> with <var>request<!---0.170566%--></var> and with the\n              thrown exception."
            },
            {
              "html": "Let <var>serializedModifierData<!---0.170566%--></var> be an empty list."
            },
            {
              "html": "Validate and canonicalize the details:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-total-3\"><code>total<!---0.170566%--></code></a><!---0.170566%--> member of <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>\n                  is present, then:",
                  "rationale": "check",
                  "steps": [
                    {
                      "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-total-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-total-amount-3\">Check and canonicalize total amount</a>\n                        <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-total-4\"><code>total<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-10\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->.\n                        If an exception is thrown, then <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-4\">abort the update</a>\n                        with <var>request<!---0.170566%--></var> and that exception."
                    }
                  ]
                },
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-6\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%--> member of\n                  <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var> is present, then for each <var>item<!---0.170566%--></var> in\n                  <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-7\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%-->:",
                  "rationale": "check",
                  "steps": [
                    {
                      "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-amount-5\">Check and canonicalize amount</a>\n                        <var>item<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-11\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->. If an exception is\n                        thrown, then <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-5\">abort the update</a> with <var>request<!---0.170566%--></var> and\n                        that exception."
                    }
                  ]
                },
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-7\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%--> member of\n                  <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var> is present, then:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "Let <var>modifiers<!---0.170566%--></var> be the sequence\n                      <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-8\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%-->."
                    },
                    {
                      "html": "Let <var>serializedModifierData<!---0.170566%--></var> be an empty list."
                    },
                    {
                      "html": "For each <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-8\"><code>PaymentDetailsModifier<!---0.170566%--></code></a><!---0.170566%--> <var>modifier<!---0.170566%--></var> in\n                      <var>modifiers<!---0.170566%--></var>:",
                      "rationale": "run",
                      "steps": [
                        {
                          "html": "Run the steps to <a data-cite=\"payment-method-id\" data-cite-path=\"/\" data-cite-frag=\"dfn-validate-a-payment-method-identifier\" data-type=\"dfn\" href=\"https://www.w3.org/TR/payment-method-id/#dfn-validate-a-payment-method-identifier\">validate a payment method\n                          identifier</a> with\n                          <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-supportedmethods\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-supportedmethods-5\"><code>supportedMethods<!---0.170566%--></code></a><!---0.170566%-->.\n                          If it returns false, then <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-6\">abort the update</a>\n                          with <var>request<!---0.170566%--></var> and a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"RangeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-rangeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-rangeerror\"><code>RangeError<!---0.170566%--></code></a><!---0.170566%--> exception.\n                          Optionally, inform the developer that the payment\n                          method identifier is invalid."
                        },
                        {
                          "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-total-6\"><code>total<!---0.170566%--></code></a><!---0.170566%--> member of\n                          <var>modifier<!---0.170566%--></var> is present, then:",
                          "rationale": "check",
                          "steps": [
                            {
                              "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-total-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-total-amount-4\">Check and canonicalize total amount</a>\n                                <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-total-7\"><code>total<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-12\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->.\n                                If an exception is thrown, then <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-7\">abort the\n                                update</a> with <var>request<!---0.170566%--></var> and that exception."
                            }
                          ]
                        },
                        {
                          "html": "If the\n                          <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-additionaldisplayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-additionaldisplayitems-5\"><code>additionalDisplayItems<!---0.170566%--></code></a><!---0.170566%-->\n                          member of <var>modifier<!---0.170566%--></var> is present, then for each\n                          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-13\"><code>PaymentItem<!---0.170566%--></code></a><!---0.170566%--> <var>item<!---0.170566%--></var> in\n                          <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-additionaldisplayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-additionaldisplayitems-6\"><code>additionalDisplayItems<!---0.170566%--></code></a><!---0.170566%-->:",
                          "rationale": "check",
                          "steps": [
                            {
                              "html": "<a href=\"https://w3c.github.io/payment-request/#dfn-check-and-canonicalize-amount\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-check-and-canonicalize-amount-6\">Check and canonicalize amount</a>\n                                <var>item<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentItem\" data-xref-for=\"PaymentItem\" href=\"https://w3c.github.io/payment-request/#dom-paymentitem-amount\" class=\"internalDFN\" id=\"ref-for-dom-paymentitem-amount-13\"><code>amount<!---0.170566%--></code></a><!---0.170566%-->. If an exception\n                                is thrown, then <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-8\">abort the update</a> with\n                                <var>request<!---0.170566%--></var> and that exception."
                            }
                          ]
                        },
                        {
                          "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-data-7\"><code>data<!---0.170566%--></code></a><!---0.170566%--> member of\n                          <var>modifier<!---0.170566%--></var> is missing, let <var>serializedData<!---0.170566%--></var> be null.\n                          Otherwise, let <var>serializedData<!---0.170566%--></var> be the result of\n                          <a data-link-type=\"dfn|abstract-op\" data-lt=\"serialize a JavaScript value to a JSON string\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"serialize-a-javascript-value-to-a-json-string\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-a-json-string\">serialize<!---0.170566%--></a>\n                          <var>modifier<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-data-8\"><code>data<!---0.170566%--></code></a><!---0.170566%--> into a\n                          JSON string. If it throws an exception, then <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-9\">abort\n                          the update</a> with <var>request<!---0.170566%--></var> and that exception."
                        },
                        {
                          "html": "Add <var>serializedData<!---0.170566%--></var> to <var>serializedModifierData<!---0.170566%--></var>."
                        },
                        {
                          "html": "Remove the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsModifier\" data-xref-for=\"PaymentDetailsModifier\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsmodifier-data\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsmodifier-data-9\"><code>data<!---0.170566%--></code></a><!---0.170566%--> member\n                          of <var>modifier<!---0.170566%--></var>, if it is present."
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-paymentmethoderrors\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-paymentmethoderrors-2\"><code>paymentMethodErrors<!---0.170566%--></code></a><!---0.170566%--> member is\n              present and <var>identifier<!---0.170566%--></var> is not null:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If required by the specification that defines the <var>pmi<!---0.170566%--></var>,\n                  then <a data-link-type=\"dfn|abstract-op\" data-lt=\"converted to an IDL value\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">convert<!---0.170566%--></a>\n                  <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-paymentmethoderrors\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-paymentmethoderrors-3\"><code>paymentMethodErrors<!---0.170566%--></code></a><!---0.170566%--> to an IDL value."
                },
                {
                  "html": "If conversion results in a <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-exception\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception</a> <var>error<!---0.170566%--></var>, <a href=\"https://w3c.github.io/payment-request/#dfn-abort-the-update\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-abort-the-update-10\">\n                    abort the update</a> with <var>error<!---0.170566%--></var>."
                },
                {
                  "html": "The <a href=\"https://w3c.github.io/payment-request/#dfn-payment-handler\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-handler-15\">payment handler</a> <em class=\"rfc2119\">SHOULD<!---0.170566%--></em> display an error for\n                  each relevant erroneous field of\n                  <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-paymentmethoderrors\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-paymentmethoderrors-4\"><code>paymentMethodErrors<!---0.170566%--></code></a><!---0.170566%-->."
                }
              ]
            },
            {
              "html": "Update the <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-33\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> using the new details:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-total-5\"><code>total<!---0.170566%--></code></a><!---0.170566%--> member of <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>\n                  is present, then:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set\n                      <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[details]]\" href=\"https://w3c.github.io/payment-request/#dfn-details\" class=\"internalDFN\" id=\"ref-for-dfn-details-5\"><code>[[details<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsInit\" data-xref-for=\"PaymentDetailsInit\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsinit-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsinit-total-6\"><code>total<!---0.170566%--></code></a><!---0.170566%-->\n                      to <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsUpdate\" data-xref-for=\"PaymentDetailsUpdate\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsupdate-total\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsupdate-total-6\"><code>total<!---0.170566%--></code></a><!---0.170566%-->."
                    }
                  ]
                },
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-8\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%--> member of\n                  <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var> is present, then:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set\n                      <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[details]]\" href=\"https://w3c.github.io/payment-request/#dfn-details\" class=\"internalDFN\" id=\"ref-for-dfn-details-6\"><code>[[details<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-9\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%-->\n                      to <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-displayitems\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-displayitems-10\"><code>displayItems<!---0.170566%--></code></a><!---0.170566%-->."
                    }
                  ]
                },
                {
                  "html": "If the <!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-9\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%--> member of\n                  <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var> is present, then:",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "Set\n                      <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[details]]\" href=\"https://w3c.github.io/payment-request/#dfn-details\" class=\"internalDFN\" id=\"ref-for-dfn-details-7\"><code>[[details<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-10\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%-->\n                      to <var data-type=\"PaymentDetailsUpdate\">details<!---0.170566%--></var>.<!---0.170566%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"PaymentDetailsBase\" data-xref-for=\"PaymentDetailsBase\" href=\"https://w3c.github.io/payment-request/#dom-paymentdetailsbase-modifiers\" class=\"internalDFN\" id=\"ref-for-dom-paymentdetailsbase-modifiers-11\"><code>modifiers<!---0.170566%--></code></a><!---0.170566%-->."
                    },
                    {
                      "html": "Set\n                      <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[serializedModifierData]]\" href=\"https://w3c.github.io/payment-request/#dfn-serializedmodifierdata\" class=\"internalDFN\" id=\"ref-for-dfn-serializedmodifierdata-7\"><code>[[serializedModifierData<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->\n                      to <var>serializedModifierData<!---0.170566%--></var>."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "Set <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-7\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to false."
        },
        {
          "html": "Update the user interface based on any changed values in\n          <var>request<!---0.170566%--></var>. Re-enable user interface elements disabled prior to\n          running this algorithm."
        }
      ]
    },
    {
      "name": "abort the update",
      "href": "https://w3c.github.io/payment-request/#dfn-abort-the-update",
      "html": "To <dfn data-export=\"\" id=\"dfn-abort-the-update\" tabindex=\"0\" aria-haspopup=\"dialog\" data-dfn-type=\"dfn\">abort the update</dfn> with a\n            <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dom-paymentrequest\" class=\"internalDFN\" id=\"ref-for-dom-paymentrequest-34\"><code>PaymentRequest<!---0.170566%--></code></a><!---0.170566%--> <var>request<!---0.170566%--></var> and <a data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-exception\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-exception\">exception</a> <var>exception<!---0.170566%--></var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "Optionally, show an error message to the user when letting them\n            know an error has occurred."
        },
        {
          "html": "Abort the current user interaction and close down any remaining\n            user interface."
        },
        {
          "html": "<a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task\">Queue a task</a> on the <a data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"user-interaction-task-source\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#user-interaction-task-source\">user interaction task source</a> to\n              perform the following steps:",
          "rationale": "set",
          "steps": [
            {
              "html": "Set <var>request<!---0.170566%--></var>'s <a href=\"https://w3c.github.io/payment-request/#dfn-payment-relevant-browsing-context\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-relevant-browsing-context-11\">payment-relevant browsing context</a>'s\n                <a href=\"https://w3c.github.io/payment-request/#dfn-payment-request-is-showing\" class=\"internalDFN\" data-link-type=\"dfn\" id=\"ref-for-dfn-payment-request-is-showing-13\">payment request is showing</a> boolean to false."
            },
            {
              "html": "Set <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[state]]\" href=\"https://w3c.github.io/payment-request/#dfn-state\" class=\"internalDFN\" id=\"ref-for-dfn-state-20\"><code>[[state<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n                \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" href=\"https://w3c.github.io/payment-request/#dfn-closed\" class=\"internalDFN\" id=\"ref-for-dfn-closed-10\">closed<!---0.170566%--></a>\"."
            },
            {
              "html": "Let <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> be\n                <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[response]]\" href=\"https://w3c.github.io/payment-request/#dfn-response\" class=\"internalDFN\" id=\"ref-for-dfn-response-8\"><code>[[response<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->."
            },
            {
              "html": "If <var data-type=\"PaymentResponse\">response<!---0.170566%--></var> is not null, then:",
              "rationale": "set",
              "steps": [
                {
                  "html": "Set <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[complete]]\" href=\"https://w3c.github.io/payment-request/#dfn-complete\" class=\"internalDFN\" id=\"ref-for-dfn-complete-6\"><code>[[complete<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to\n                    true."
                },
                {
                  "html": "<a href=\"https://infra.spec.whatwg.org/#assert\">Assert</a>: <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-11\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->\n                    is not null."
                },
                {
                  "html": "Reject <var data-type=\"PaymentResponse\">response<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentResponse\" data-xref-for=\"PaymentResponse\" data-lt=\"[[retryPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-retrypromise\" class=\"internalDFN\" id=\"ref-for-dfn-retrypromise-12\"><code>[[retryPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%-->\n                    with <var>exception<!---0.170566%--></var>."
                }
              ]
            },
            {
              "html": "Otherwise, reject\n                <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[acceptPromise]]\" href=\"https://w3c.github.io/payment-request/#dfn-acceptpromise\" class=\"internalDFN\" id=\"ref-for-dfn-acceptpromise-7\"><code>[[acceptPromise<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> with\n                <var>exception<!---0.170566%--></var>."
            },
            {
              "html": "Set <var>request<!---0.170566%--></var>.<!---0.170566%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"PaymentRequest\" data-xref-for=\"PaymentRequest\" data-lt=\"[[updating]]\" href=\"https://w3c.github.io/payment-request/#dfn-updating\" class=\"internalDFN\" id=\"ref-for-dfn-updating-8\"><code>[[updating<!---0.170566%-->]]<!---0.170566%--></code></a><!---0.170566%--> to false."
            }
          ]
        },
        {
          "html": "Abort the algorithm."
        }
      ]
    }
  ]
}
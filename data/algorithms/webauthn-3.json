{
  "spec": {
    "title": "Web Authentication: An API for accessing Public Key Credentials - Level 3",
    "url": "https://w3c.github.io/webauthn/"
  },
  "algorithms": [
    {
      "html": "When this method is invoked, the user agent MUST execute the following algorithm:",
      "rationale": "assert",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialcreationoptions-publickey\" id=\"ref-for-dom-credentialcreationoptions-publickey②\">publicKey</a></code></code> is present.</p>"
        },
        {
          "html": "If <var>sameOriginWithAncestors</var> is <code>false</code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-mediation\" id=\"ref-for-dom-credentialcreationoptions-mediation②\">mediation</a></code></code> is present with the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-conditional\" id=\"ref-for-dom-credentialmediationrequirement-conditional⑦\">conditional</a></code>:",
              "rationale": "throw",
              "steps": [
                {
                  "html": "<p>Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code></p>"
                }
              ]
            },
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a>, as determined by the calling <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create\" id=\"ref-for-dom-credentialscontainer-create①②\">create()</a></code> implementation, does not have <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation\">transient activation</a>:",
              "rationale": "throw",
              "steps": [
                {
                  "html": "<p>Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation\" id=\"ref-for-consume-user-activation\">Consume user activation</a> of the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>pkOptions</var> be the value of <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialcreationoptions-publickey\" id=\"ref-for-dom-credentialcreationoptions-publickey③\">publicKey</a></code></code>.</p>"
        },
        {
          "html": "<p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-timeout\" id=\"ref-for-dom-publickeycredentialcreationoptions-timeout\">timeout</a></code></code> is present, check if its value lies within a\nreasonable range as defined by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client\" id=\"ref-for-client①⑦\">client</a> and if not, correct it to the closest value lying within that range. Set a timer <var>lifetimeTimer</var> to this adjusted value. If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-timeout\" id=\"ref-for-dom-publickeycredentialcreationoptions-timeout①\">timeout</a></code></code> is not\npresent, then set <var>lifetimeTimer</var> to a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client\" id=\"ref-for-client①⑧\">client</a>-specific default.</p>\n      <p>See the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#recommended-range-and-default-for-a-webauthn-ceremony-timeout\" id=\"ref-for-recommended-range-and-default-for-a-webauthn-ceremony-timeout\">recommended range and default for a WebAuthn ceremony timeout</a> for guidance on deciding a reasonable range and default for <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-timeout\" id=\"ref-for-dom-publickeycredentialcreationoptions-timeout②\">timeout</a></code></code>.</p>"
        },
        {
          "html": "<p>If the length of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-user\" id=\"ref-for-dom-publickeycredentialcreationoptions-user①\">user</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialuserentity-id\" id=\"ref-for-dom-publickeycredentialuserentity-id①\">id</a></code></code> is not between 1 and 64 bytes (inclusive) then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>callerOrigin</var> be <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-create-origin-options-sameoriginwithancestors-origin\" id=\"ref-for-dom-publickeycredential-create-origin-options-sameoriginwithancestors-origin\">origin</a></code>. If <var>callerOrigin</var> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque\">opaque origin</a>, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror②\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>effectiveDomain</var> be the <var>callerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-effective-domain\" id=\"ref-for-concept-origin-effective-domain④\">effective domain</a>.\nIf <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-effective-domain\" id=\"ref-for-concept-origin-effective-domain⑤\">effective domain</a> is not a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#valid-domain\" id=\"ref-for-valid-domain①\">valid domain</a>, then throw a\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code>.</p>"
        },
        {
          "html": "If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-rp\" id=\"ref-for-dom-publickeycredentialcreationoptions-rp①\">rp</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id①\">id</a></code></code>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "is present",
                  "steps": [
                    {
                      "html": "<p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-rp\" id=\"ref-for-dom-publickeycredentialcreationoptions-rp②\">rp</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id②\">id</a></code></code> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#is-a-registrable-domain-suffix-of-or-is-equal-to\" id=\"ref-for-is-a-registrable-domain-suffix-of-or-is-equal-to②\">is not a\nregistrable domain suffix of and is not equal to</a> <var>effectiveDomain</var>, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror①\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code>.</p>"
                    }
                  ]
                },
                {
                  "case": "Is not present",
                  "steps": [
                    {
                      "html": "<p>Set <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-rp\" id=\"ref-for-dom-publickeycredentialcreationoptions-rp③\">rp</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id③\">id</a></code></code> to <var>effectiveDomain</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>credTypesAndPubKeyAlgs</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item①\">items</a> are pairs of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-publickeycredentialtype\" id=\"ref-for-enumdef-publickeycredentialtype①\">PublicKeyCredentialType</a></code> and\na <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#typedefdef-cosealgorithmidentifier\" id=\"ref-for-typedefdef-cosealgorithmidentifier\">COSEAlgorithmIdentifier</a></code>.</p>"
        },
        {
          "html": "If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-pubkeycredparams\" id=\"ref-for-dom-publickeycredentialcreationoptions-pubkeycredparams\">pubKeyCredParams</a></code></code>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "is zero",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append\">Append</a> the following pairs of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-publickeycredentialtype\" id=\"ref-for-enumdef-publickeycredentialtype②\">PublicKeyCredentialType</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#typedefdef-cosealgorithmidentifier\" id=\"ref-for-typedefdef-cosealgorithmidentifier①\">COSEAlgorithmIdentifier</a></code> values to <var>credTypesAndPubKeyAlgs</var>:</p>\n        <ul>\n         <li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key\" id=\"ref-for-dom-publickeycredentialtype-public-key①\">public-key</a></code> and <code>-7</code> (\"ES256\").</p>\n         </li><li data-md=\"\">\n          <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key\" id=\"ref-for-dom-publickeycredentialtype-public-key②\">public-key</a></code> and <code>-257</code> (\"RS256\").</p>\n        </li></ul>"
                    }
                  ]
                },
                {
                  "case": "is non-zero",
                  "steps": [
                    {
                      "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>current</var> of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-pubkeycredparams\" id=\"ref-for-dom-publickeycredentialcreationoptions-pubkeycredparams①\">pubKeyCredParams</a></code></code>:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <code><var>current</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialparameters-type\" id=\"ref-for-dom-publickeycredentialparameters-type\">type</a></code></code> does not contain a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-publickeycredentialtype\" id=\"ref-for-enumdef-publickeycredentialtype③\">PublicKeyCredentialType</a></code> supported\nby this implementation, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
                        },
                        {
                          "html": "<p>Let <var>alg</var> be <code><var>current</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialparameters-alg\" id=\"ref-for-dom-publickeycredentialparameters-alg\">alg</a></code></code>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append①\">Append</a> the pair of <code><var>current</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialparameters-type\" id=\"ref-for-dom-publickeycredentialparameters-type①\">type</a></code></code> and <var>alg</var> to <var>credTypesAndPubKeyAlgs</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>clientExtensions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①\">map</a> and let <var>authenticatorExtensions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">map</a>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#CreateCred-process-extensions\"></a> If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-extensions\" id=\"ref-for-dom-publickeycredentialcreationoptions-extensions\">extensions</a></code></code> is present, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate\">for each</a> <var>extensionId</var> → <var>clientExtensionInput</var> of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-extensions\" id=\"ref-for-dom-publickeycredentialcreationoptions-extensions①\">extensions</a></code></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>extensionId</var> is not supported by this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform①⑥\">client platform</a> or is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#registration-extension\" id=\"ref-for-registration-extension\">registration extension</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set\">Set</a> <var>clientExtensions</var>[<var>extensionId</var>] to <var>clientExtensionInput</var>.</p>"
            },
            {
              "html": "<p>If <var>extensionId</var> is not an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension\" id=\"ref-for-authenticator-extension\">authenticator extension</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue②\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>authenticatorExtensionInput</var> be the (<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#cbor\" id=\"ref-for-cbor②\">CBOR</a>) result of running <var>extensionId</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-processing\" id=\"ref-for-client-extension-processing①\">client extension processing</a> algorithm on <var>clientExtensionInput</var>. If the algorithm returned an error, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue③\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set①\">Set</a> <var>authenticatorExtensions</var>[<var>extensionId</var>] to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding③\">base64url encoding</a> of <var>authenticatorExtensionInput</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>collectedClientData</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-collectedclientdata\" id=\"ref-for-dictdef-collectedclientdata\">CollectedClientData</a></code> instance whose fields are:</p>\n      <dl>\n       <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-type\" id=\"ref-for-dom-collectedclientdata-type\">type</a></code>\n       </dt><dd data-md=\"\">\n        <p>The string \"webauthn.create\".</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge\" id=\"ref-for-dom-collectedclientdata-challenge\">challenge</a></code>\n       </dt><dd data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding④\">base64url encoding</a> of <var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-challenge\" id=\"ref-for-dom-publickeycredentialcreationoptions-challenge\">challenge</a></code>.</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-origin\" id=\"ref-for-dom-collectedclientdata-origin\">origin</a></code>\n       </dt><dd data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin\">serialization of</a> <var>callerOrigin</var>.</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin\">topOrigin</a></code>\n       </dt><dd data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin①\">serialization of</a> <var>callerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin①\">top-level origin</a> if\nthe <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-create-origin-options-sameoriginwithancestors-sameoriginwithancestors\" id=\"ref-for-dom-publickeycredential-create-origin-options-sameoriginwithancestors-sameoriginwithancestors\">sameOriginWithAncestors</a></code> argument passed to this <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots⑨\">internal method</a> is <code>false</code>, else <code>undefined</code>.</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-crossorigin\" id=\"ref-for-dom-collectedclientdata-crossorigin\">crossOrigin</a></code>\n       </dt><dd data-md=\"\">\n        <p>The inverse of the value of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-create-origin-options-sameoriginwithancestors-sameoriginwithancestors\" id=\"ref-for-dom-publickeycredential-create-origin-options-sameoriginwithancestors-sameoriginwithancestors①\">sameOriginWithAncestors</a></code> argument passed to this <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①⓪\">internal method</a>.</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>clientDataJSON</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-json-compatible-serialization-of-client-data\" id=\"ref-for-collectedclientdata-json-compatible-serialization-of-client-data\">JSON-compatible serialization of client data</a> constructed from <var>collectedClientData</var>.</p>"
        },
        {
          "html": "<p>Let <var>clientDataHash</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-hash-of-the-serialized-client-data\" id=\"ref-for-collectedclientdata-hash-of-the-serialized-client-data\">hash of the serialized client data</a> represented by <var>clientDataJSON</var>.</p>"
        },
        {
          "html": "<p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-signal\" id=\"ref-for-dom-credentialcreationoptions-signal\">signal</a></code></code> is present and <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, throw\nthe <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-signal\" id=\"ref-for-dom-credentialcreationoptions-signal①\">signal</a></code></code>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>issuedRequests</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">ordered set</a>.</p>"
        },
        {
          "html": "<p>Let <var>authenticators</var> represent a value which at any given instant is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">set</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform①⑦\">client platform</a>-specific handles, where each <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item②\">item</a> identifies an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑥⑧\">authenticator</a> presently available on this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform①⑧\">client platform</a> at that instant.</p>"
        },
        {
          "html": "If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-mediation\" id=\"ref-for-dom-credentialcreationoptions-mediation③\">mediation</a></code></code> is present with the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-conditional\" id=\"ref-for-dom-credentialmediationrequirement-conditional⑧\">conditional</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the user agent has not recently mediated an authentication, the origin of said authentication is not <var>callerOrigin</var>, or the user\ndoes not consent to this type of credential creation, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror③\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>\n        <p>It is up to the user agent to decide when it believes an authentication ceremony has\nbeen completed. That authentication ceremony MAY be performed via other means than the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#web-authentication-api\" id=\"ref-for-web-authentication-api①①\">Web Authentication API</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Consider the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-hints\" id=\"ref-for-dom-publickeycredentialcreationoptions-hints\">hints</a></code> and craft the user interface accordingly, as the user-agent sees fit.</p>"
        },
        {
          "html": "<p>Start <var>lifetimeTimer</var>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#CreateCred-async-loop\"></a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-while\" id=\"ref-for-iteration-while\">While</a> <var>lifetimeTimer</var> has not expired, perform the following actions depending upon <var>lifetimeTimer</var>,\n    and the state and response <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">for each</a> <var>authenticator</var> in <var>authenticators</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If lifetimeTimer expires,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">For each</a> <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove\">remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "If the user exercises a user agent user-interface option to cancel the process,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel①\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①\">remove</a> <var>authenticator</var> from <var>issuedRequests</var>. Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror④\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
                    }
                  ]
                },
                {
                  "case": "If options.signal is present and aborted,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel②\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②\">remove</a> <var>authenticator</var> from <var>issuedRequests</var>. Then throw the <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-signal\" id=\"ref-for-dom-credentialcreationoptions-signal③\">signal</a></code></code>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                    }
                  ]
                },
                {
                  "case": "If an authenticator becomes available on this client device,",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p>This <var>authenticator</var> is now the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"create\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-candidate-authenticator\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">candidate authenticator</dfn>.</p>\n         </li><li data-md=\"\">\n          <p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection\">authenticatorSelection</a></code></code> is present:</p>\n          <ol>\n           <li data-md=\"\">\n            <p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection①\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-authenticatorattachment\" id=\"ref-for-dom-authenticatorselectioncriteria-authenticatorattachment\">authenticatorAttachment</a></code></code> is\npresent and its value is not equal to <var>authenticator</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-attachment-modality\" id=\"ref-for-authenticator-attachment-modality②\">authenticator attachment modality</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue④\">continue</a>.</p>\n           </li><li data-md=\"\">\n            <p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection②\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey\" id=\"ref-for-dom-authenticatorselectioncriteria-residentkey\">residentKey</a></code></code></p>\n            <dl class=\"switch\">\n             <dt data-md=\"\">is present and set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required\" id=\"ref-for-dom-residentkeyrequirement-required\">required</a></code>\n             </dt><dd data-md=\"\">\n              <p>If the <var>authenticator</var> is not capable of storing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-discoverable-public-key-credential-source\" id=\"ref-for-client-side-discoverable-public-key-credential-source①\">client-side discoverable public key credential\n  source</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑤\">continue</a>.</p>\n             </dd><dt data-md=\"\">is present and set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred\" id=\"ref-for-dom-residentkeyrequirement-preferred\">preferred</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-residentkeyrequirement-discouraged\" id=\"ref-for-dom-residentkeyrequirement-discouraged\">discouraged</a></code>\n             </dt><dd data-md=\"\">\n              <p>No effect.</p>\n             </dd><dt data-md=\"\">is not present\n             </dt><dd data-md=\"\">\n              <p>if <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection③\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-requireresidentkey\" id=\"ref-for-dom-authenticatorselectioncriteria-requireresidentkey\">requireResidentKey</a></code></code> is set to <code>true</code> and the <var>authenticator</var> is not capable of storing a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-discoverable-public-key-credential-source\" id=\"ref-for-client-side-discoverable-public-key-credential-source②\">client-side discoverable public\n  key credential source</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑥\">continue</a>.</p>\n            </dd></dl>\n           </li><li data-md=\"\">\n            <p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection④\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification\" id=\"ref-for-dom-authenticatorselectioncriteria-userverification\">userVerification</a></code></code> is\nset to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-userverificationrequirement-required\" id=\"ref-for-dom-userverificationrequirement-required\">required</a></code> and the <var>authenticator</var> is not capable of performing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification①⑤\">user\nverification</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑦\">continue</a>.</p>\n          </li></ol>\n         </li><li data-md=\"\">\n          <p>Let <var>requireResidentKey</var> be the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"effective-resident-key-requirement-for-credential-creation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">effective resident key requirement for credential creation</dfn>, a Boolean value, as follows:</p>\n          <p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection⑤\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey\" id=\"ref-for-dom-authenticatorselectioncriteria-residentkey①\">residentKey</a></code></code></p>\n          <dl class=\"switch\">\n           <dt data-md=\"\">is present and set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required\" id=\"ref-for-dom-residentkeyrequirement-required①\">required</a></code>\n           </dt><dd data-md=\"\">\n            <p>Let <var>requireResidentKey</var> be <code>true</code>.</p>\n           </dd><dt data-md=\"\">is present and set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred\" id=\"ref-for-dom-residentkeyrequirement-preferred①\">preferred</a></code>\n           </dt><dd data-md=\"\">\n            <p>If the <var>authenticator</var></p>\n            <dl class=\"switch\">\n             <dt data-md=\"\">is capable of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-credential-storage-modality\" id=\"ref-for-client-side-credential-storage-modality①\">client-side credential storage modality</a>\n             </dt><dd data-md=\"\">\n              <p>Let <var>requireResidentKey</var> be <code>true</code>.</p>\n             </dd><dt data-md=\"\">is not capable of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-credential-storage-modality\" id=\"ref-for-client-side-credential-storage-modality②\">client-side credential storage modality</a>, or if the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client\" id=\"ref-for-client②①\">client</a> cannot determine authenticator capability,\n             </dt><dd data-md=\"\">\n              <p>Let <var>requireResidentKey</var> be <code>false</code>.</p>\n            </dd></dl>\n           </dd><dt data-md=\"\">is present and set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-residentkeyrequirement-discouraged\" id=\"ref-for-dom-residentkeyrequirement-discouraged①\">discouraged</a></code>\n           </dt><dd data-md=\"\">\n            <p>Let <var>requireResidentKey</var> be <code>false</code>.</p>\n           </dd><dt data-md=\"\">is not present\n           </dt><dd data-md=\"\">\n            <p>Let <var>requireResidentKey</var> be the value of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection⑥\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-requireresidentkey\" id=\"ref-for-dom-authenticatorselectioncriteria-requireresidentkey①\">requireResidentKey</a></code></code>.</p>\n          </dd></dl>\n         </li><li data-md=\"\">\n          <p>Let <var>userVerification</var> be the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"effective-user-verification-requirement-for-credential-creation\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">effective user verification requirement for credential creation</dfn>, a Boolean value,\nas follows. If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection\" id=\"ref-for-dom-publickeycredentialcreationoptions-authenticatorselection⑦\">authenticatorSelection</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification\" id=\"ref-for-dom-authenticatorselectioncriteria-userverification①\">userVerification</a></code></code></p>\n          <dl class=\"switch\">\n           <dt data-md=\"\">is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-userverificationrequirement-required\" id=\"ref-for-dom-userverificationrequirement-required①\">required</a></code>\n           </dt><dd data-md=\"\">\n            <ol>\n             <li data-md=\"\">\n              <p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-mediation\" id=\"ref-for-dom-credentialcreationoptions-mediation④\">mediation</a></code></code> is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-conditional\" id=\"ref-for-dom-credentialmediationrequirement-conditional⑨\">conditional</a></code> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification①⑥\">user verification</a> cannot be collected during the ceremony,\nthrow a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#constrainterror\" id=\"ref-for-constrainterror\">ConstraintError</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>\n             </li><li data-md=\"\">\n              <p>Let <var>userVerification</var> be <code>true</code>.</p>\n            </li></ol>\n           </dd><dt data-md=\"\">is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-userverificationrequirement-preferred\" id=\"ref-for-dom-userverificationrequirement-preferred\">preferred</a></code>\n           </dt><dd data-md=\"\">\n            <p>If the <var>authenticator</var></p>\n            <dl class=\"switch\">\n             <dt data-md=\"\">is capable of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification①⑦\">user verification</a>\n             </dt><dd data-md=\"\">\n              <p>Let <var>userVerification</var> be <code>true</code>.</p>\n             </dd><dt data-md=\"\">is not capable of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification①⑧\">user verification</a>\n             </dt><dd data-md=\"\">\n              <p>Let <var>userVerification</var> be <code>false</code>.</p>\n            </dd></dl>\n           </dd><dt data-md=\"\">is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-userverificationrequirement-discouraged\" id=\"ref-for-dom-userverificationrequirement-discouraged\">discouraged</a></code>\n           </dt><dd data-md=\"\">\n            <p>Let <var>userVerification</var> be <code>false</code>.</p>\n          </dd></dl>\n         </li><li data-md=\"\">\n          <p>Let <var>enterpriseAttestationPossible</var> be a Boolean value, as follows. If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-attestation\" id=\"ref-for-dom-publickeycredentialcreationoptions-attestation\">attestation</a></code></code></p>\n          <dl class=\"switch\">\n           <dt data-md=\"\">is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-enterprise\" id=\"ref-for-dom-attestationconveyancepreference-enterprise\">enterprise</a></code>\n           </dt><dd data-md=\"\">\n            <p>Let <var>enterpriseAttestationPossible</var> be <code>true</code> if the user agent wishes to support enterprise attestation for <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-rp\" id=\"ref-for-dom-publickeycredentialcreationoptions-rp⑥\">rp</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id⑥\">id</a></code></code> (see <a href=\"https://w3c.github.io/webauthn/#CreateCred-DetermineRpId\">step 8</a>, above). Otherwise <code>false</code>.</p>\n           </dd><dt data-md=\"\">otherwise\n           </dt><dd data-md=\"\">\n            <p>Let <var>enterpriseAttestationPossible</var> be <code>false</code>.</p>\n          </dd></dl>\n         </li><li data-md=\"\">\n          <p>Let <var>attestationFormats</var> be a list of strings, initialized to the value of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-attestationformats\" id=\"ref-for-dom-publickeycredentialcreationoptions-attestationformats\">attestationFormats</a></code></code>.</p>\n         </li><li data-md=\"\">\n          <p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-attestation\" id=\"ref-for-dom-publickeycredentialcreationoptions-attestation①\">attestation</a></code></code></p>\n          <dl class=\"switch\">\n           <dt data-md=\"\">is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-none\" id=\"ref-for-dom-attestationconveyancepreference-none\">none</a></code>\n           </dt><dd data-md=\"\">\n            <p>Set <var>attestationFormats</var> be the single-element list containing the string “none”</p>\n          </dd></dl>\n         </li><li data-md=\"\">\n          <p>Let <var>excludeCredentialDescriptorList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a>.</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> credential descriptor <var>C</var> in <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-excludecredentials\" id=\"ref-for-dom-publickeycredentialcreationoptions-excludecredentials\">excludeCredentials</a></code></code>:</p>\n          <ol>\n           <li data-md=\"\">\n            <p>If <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports\" id=\"ref-for-dom-publickeycredentialdescriptor-transports②\">transports</a></code></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty③\">is not empty</a>, and <var>authenticator</var> is connected over a transport not\nmentioned in <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports\" id=\"ref-for-dom-publickeycredentialdescriptor-transports③\">transports</a></code></code>, the client MAY <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue⑧\">continue</a>.</p>\n            \n           </li><li data-md=\"\">\n            <p>Otherwise, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append②\">Append</a> <var>C</var> to <var>excludeCredentialDescriptorList</var>.</p>\n          </li></ol>\n         </li><li id=\"CreateCred-InvokeAuthnrMakeCred\"><a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#CreateCred-InvokeAuthnrMakeCred\"></a> Invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatormakecredential\" id=\"ref-for-authenticatormakecredential⑤\">authenticatorMakeCredential</a> operation on <var>authenticator</var> with <var>clientDataHash</var>, <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-rp\" id=\"ref-for-dom-publickeycredentialcreationoptions-rp⑦\">rp</a></code></code>, <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-user\" id=\"ref-for-dom-publickeycredentialcreationoptions-user②\">user</a></code></code>, <var>requireResidentKey</var>, <var>userVerification</var>, <var>credTypesAndPubKeyAlgs</var>, <var>excludeCredentialDescriptorList</var>, <var>enterpriseAttestationPossible</var>, <var>attestationFormats</var>,\n        and <var>authenticatorExtensions</var> as parameters. \n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">Append</a> <var>authenticator</var> to <var>issuedRequests</var>.</p>\n        </li></ol>",
                      "ignored": [
                        "This authenticator is now the candidate authenticator. If pkOptions.authenticatorSelection is present: If pkOptions.authenticatorSelection.authenticatorAttachment is present and its value is not equal to authenticator’s authenticator attachment modality, continue. If pkOptions.authenticatorSelection.residentKey is present and set to required If the authenticator is not capable of storing a client-side discoverable public key credential source, continue. is present and set to preferred or discouraged No effect. is not present if pkOptions.authenticatorSelection.requireResidentKey is set to true and the authenticator is not capable of storing a client-side discoverable public key credential source, continue. If pkOptions.authenticatorSelection.userVerification is set to required and the authenticator is not capable of performing user verification, continue. Let requireResidentKey be the effective resident key requirement for credential creation, a Boolean value, as follows: If pkOptions.authenticatorSelection.residentKey is present and set to required Let requireResidentKey be true. is present and set to preferred If the authenticator is capable of client-side credential storage modality Let requireResidentKey be true. is not capable of client-side credential storage modality, or if the client cannot determine authenticator capability, Let requireResidentKey be false. is present and set to discouraged Let requireResidentKey be false. is not present Let requireResidentKey be the value of pkOptions.authenticatorSelection.requireResidentKey. Let userVerification be the effective user verification requirement for credential creation, a Boolean value, as follows. If pkOptions.authenticatorSelection.userVerification is set to required If options.mediation is set to conditional and user verification cannot be collected during the ceremony, throw a ConstraintError DOMException. Let userVerification be true. is set to preferred If the authenticator is capable of user verification Let userVerification be true. is not capable of user verification Let userVerification be false. is set to discouraged Let userVerification be false. Let enterpriseAttestationPossible be a Boolean value, as follows. If pkOptions.attestation is set to enterprise Let enterpriseAttestationPossible be true if the user agent wishes to support enterprise attestation for pkOptions.rp.id (see step 8, above). Otherwise false. otherwise Let enterpriseAttestationPossible be false. Let attestationFormats be a list of strings, initialized to the value of pkOptions.attestationFormats. If pkOptions.attestation is set to none Set attestationFormats be the single-element list containing the string “none” Let excludeCredentialDescriptorList be a new list. For each credential descriptor C in pkOptions.excludeCredentials: If C.transports is not empty, and authenticator is connected over a transport not mentioned in C.transports, the client MAY continue. Otherwise, Append C to excludeCredentialDescriptorList. Invoke the authenticatorMakeCredential operation on authenticator with clientDataHash, pkOptions.rp, pkOptions.user, requireResidentKey, userVerification, credTypesAndPubKeyAlgs, excludeCredentialDescriptorList, enterpriseAttestationPossible, attestationFormats, and authenticatorExtensions as parameters. Append authenticator to issuedRequests."
                      ]
                    }
                  ]
                },
                {
                  "case": "If an authenticator ceases to be available on this client device,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove③\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "If any authenticator returns a status indicating that the user cancelled the operation,",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove④\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel③\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑤\">remove</a> it from <var>issuedRequests</var>.</p>\n          \n        </li></ol>",
                      "rationale": "remove",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove④\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel③\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑤\">remove</a> it from <var>issuedRequests</var>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "If any authenticator returns an error status equivalent to \"InvalidStateError\",",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑥\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel④\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑦\">remove</a> it from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code>.</p>\n        </li></ol>",
                      "rationale": "remove",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑥\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑦\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel④\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑦\">remove</a> it from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p>Throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "If any authenticator returns an error status not equivalent to \"InvalidStateError\",",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑧\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "If any authenticator indicates success,",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑨\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>. This authenticator is now the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"create\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-selected-authenticator\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">selected authenticator</dfn>.</p>\n         </li><li data-md=\"\">\n          <p>Let <var>credentialCreationData</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct②\">struct</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑧\">items</a> are:</p>\n          <dl>\n           <dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-attestationobjectresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attestationObjectResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes returned from the successful <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatormakecredential\" id=\"ref-for-authenticatormakecredential⑥\">authenticatorMakeCredential</a> operation.</p>\n            \n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-clientdatajsonresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientDataJSONResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of <var>clientDataJSON</var>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-attestationconveyancepreferenceoption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attestationConveyancePreferenceOption</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the value of <var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-attestation\" id=\"ref-for-dom-publickeycredentialcreationoptions-attestation②\">attestation</a></code>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-clientextensionresults\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientExtensionResults</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientoutputs\" id=\"ref-for-dictdef-authenticationextensionsclientoutputs①\">AuthenticationExtensionsClientOutputs</a></code> object containing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier①\">extension identifier</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output①\">client extension output</a> entries. The entries are created by running each extension’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-processing\" id=\"ref-for-client-extension-processing②\">client extension processing</a> algorithm to create the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output②\">client extension outputs</a>, for each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension\" id=\"ref-for-client-extension\">client extension</a> in <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-extensions\" id=\"ref-for-dom-publickeycredentialcreationoptions-extensions②\">extensions</a></code></code>.</p>\n          </dd></dl>\n         </li><li data-md=\"\">\n          <p>Let <var>constructCredentialAlg</var> be an algorithm that takes a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global\">global object</a> <var>global</var>, and whose steps are:</p>\n          <ol>\n           <li data-md=\"\">\n            <p>If <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationconveyancepreferenceoption\" id=\"ref-for-credentialcreationdata-attestationconveyancepreferenceoption\">attestationConveyancePreferenceOption</a></code>’s value is</p>\n            <dl class=\"switch\">\n             <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-none\" id=\"ref-for-dom-attestationconveyancepreference-none①\">none</a></code>\n             </dt><dd data-md=\"\">\n              <p>Replace potentially uniquely identifying information with non-identifying versions of the\nsame:</p>\n              <ol>\n               <li data-md=\"\">\n                <p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid①\">aaguid</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attested-credential-data\" id=\"ref-for-attested-credential-data\">attested credential data</a> is 16 zero bytes, <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult\">attestationObjectResult</a>.fmt</code> is \"packed\", and \"x5c\" is absent from <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult①\">attestationObjectResult</a></code>, then <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self-attestation\" id=\"ref-for-self-attestation④\">self attestation</a> is being used and no further action is needed.</p>\n               </li><li data-md=\"\">\n                <p>Otherwise:</p>\n                <ol>\n                 <li data-md=\"\">\n                  <p>Set the value of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult②\">attestationObjectResult</a>.fmt</code> to \"none\", and set the value of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult③\">attestationObjectResult</a>.attStmt</code> to be an empty <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#cbor\" id=\"ref-for-cbor③\">CBOR</a> map. (See <a href=\"https://w3c.github.io/webauthn/#sctn-none-attestation\">§ 8.7 None Attestation Statement Format</a> and <a href=\"https://w3c.github.io/webauthn/#sctn-generating-an-attestation-object\">§ 6.5.4 Generating an Attestation Object</a>).</p>\n                 </li><li data-md=\"\">\n                  <p>If <var>authenticator</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#platform-authenticators\" id=\"ref-for-platform-authenticators①①\">platform authenticator</a> then replace the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid②\">aaguid</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attested-credential-data\" id=\"ref-for-attested-credential-data①\">attested credential data</a> with 16 zero bytes.</p>\n                </li></ol>\n              </li></ol>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-indirect\" id=\"ref-for-dom-attestationconveyancepreference-indirect\">indirect</a></code>\n             </dt><dd data-md=\"\">\n              <p>The client MAY replace the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid③\">aaguid</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement④\">attestation statement</a> with a more privacy-friendly\nand/or more easily verifiable version of the same data (for example, by employing an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#anonymization-ca\" id=\"ref-for-anonymization-ca\">Anonymization CA</a>).</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-direct\" id=\"ref-for-dom-attestationconveyancepreference-direct\">direct</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-enterprise\" id=\"ref-for-dom-attestationconveyancepreference-enterprise①\">enterprise</a></code>\n             </dt><dd data-md=\"\">\n              <p>Convey the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑦③\">authenticator</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#aaguid\" id=\"ref-for-aaguid\">AAGUID</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement⑤\">attestation statement</a>, unaltered, to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party①⓪⓪\">Relying Party</a>.</p>\n            </dd></dl>\n           </li><li data-md=\"\">\n            <p>Let <var>attestationObject</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑤\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor①\">%ArrayBuffer%</a>, containing the\nbytes of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult④\">attestationObjectResult</a></code>’s value.</p>\n           </li><li data-md=\"\">\n            <p>Let <var>id</var> be <code><var>attestationObject</var>.authData.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata\" id=\"ref-for-authdata-attestedcredentialdata\">attestedCredentialData</a>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialid\" id=\"ref-for-authdata-attestedcredentialdata-credentialid\">credentialId</a></code>.</p>\n           </li><li data-md=\"\">\n            <p>Let <var>pubKeyCred</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#publickeycredential\" id=\"ref-for-publickeycredential①③\">PublicKeyCredential</a></code> object associated with <var>global</var> whose fields are:</p>\n            <dl>\n             <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-identifier-slot\" id=\"ref-for-dom-publickeycredential-identifier-slot②\">[[identifier]]</a></code>\n             </dt><dd data-md=\"\">\n              <p><var>id</var></p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-authenticatorattachment\" id=\"ref-for-dom-publickeycredential-authenticatorattachment②\">authenticatorAttachment</a></code>\n             </dt><dd data-md=\"\">\n              <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-authenticatorattachment\" id=\"ref-for-enumdef-authenticatorattachment①\">AuthenticatorAttachment</a></code> value matching the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-attachment-modality\" id=\"ref-for-authenticator-attachment-modality③\">authenticator attachment modality</a> of <var>authenticator</var>.</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-response\" id=\"ref-for-dom-publickeycredential-response②\">response</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorattestationresponse\" id=\"ref-for-authenticatorattestationresponse①\">AuthenticatorAttestationResponse</a></code> object associated with <var>global</var> whose fields are:</p>\n              <dl>\n               <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson①\">clientDataJSON</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑥\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor②\">%ArrayBuffer%</a>, containing the bytes of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-clientdatajsonresult\" id=\"ref-for-credentialcreationdata-clientdatajsonresult\">clientDataJSONResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-attestationobject\" id=\"ref-for-dom-authenticatorattestationresponse-attestationobject①\">attestationObject</a></code>\n               </dt><dd data-md=\"\">\n                <p><var>attestationObject</var></p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-transports-slot\" id=\"ref-for-dom-authenticatorattestationresponse-transports-slot\">[[transports]]</a></code>\n               </dt><dd data-md=\"\">\n                <p>A sequence of zero or more unique <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①①\">DOMString</a></code>s, in lexicographical order, that the <var>authenticator</var> is believed to support. The values SHOULD be members of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-authenticatortransport\" id=\"ref-for-enumdef-authenticatortransport\">AuthenticatorTransport</a></code>, but <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform①⑨\">client platforms</a> MUST ignore unknown values.</p>\n                <p>If a user agent does not wish to divulge this information it MAY substitute an arbitrary sequence designed to preserve privacy. This sequence MUST still be valid, i.e. lexicographically sorted and free of duplicates. For example, it may use the empty sequence. Either way, in this case the user agent takes the risk that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party①⓪①\">Relying Party</a> behavior may be suboptimal.</p>\n                <p>If the user agent does not have any transport information, it SHOULD set this field to the empty sequence.</p>\n                \n              </dd></dl>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-clientextensionsresults-slot\" id=\"ref-for-dom-publickeycredential-clientextensionsresults-slot①\">[[clientExtensionsResults]]</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑦\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor③\">%ArrayBuffer%</a>, containing the bytes of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-clientextensionresults\" id=\"ref-for-credentialcreationdata-clientextensionresults\">clientExtensionResults</a></code>.</p>\n            </dd></dl>\n           </li><li data-md=\"\">\n            <p>Return <var>pubKeyCred</var>.</p>\n          </li></ol>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑤\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⓪\">remove</a> it from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p>Return <var>constructCredentialAlg</var> and terminate this algorithm.</p>\n        </li></ol>",
                      "rationale": "remove",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove⑨\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>. This authenticator is now the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"create\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-selected-authenticator\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">selected authenticator</dfn>.</p>"
                        },
                        {
                          "html": "<p>Let <var>credentialCreationData</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct②\">struct</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑧\">items</a> are:</p>\n          <dl>\n           <dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-attestationobjectresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attestationObjectResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes returned from the successful <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatormakecredential\" id=\"ref-for-authenticatormakecredential⑥\">authenticatorMakeCredential</a> operation.</p>\n            \n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-clientdatajsonresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientDataJSONResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of <var>clientDataJSON</var>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-attestationconveyancepreferenceoption\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">attestationConveyancePreferenceOption</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the value of <var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-attestation\" id=\"ref-for-dom-publickeycredentialcreationoptions-attestation②\">attestation</a></code>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credentialCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credentialcreationdata-clientextensionresults\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientExtensionResults</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientoutputs\" id=\"ref-for-dictdef-authenticationextensionsclientoutputs①\">AuthenticationExtensionsClientOutputs</a></code> object containing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier①\">extension identifier</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output①\">client extension output</a> entries. The entries are created by running each extension’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-processing\" id=\"ref-for-client-extension-processing②\">client extension processing</a> algorithm to create the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output②\">client extension outputs</a>, for each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension\" id=\"ref-for-client-extension\">client extension</a> in <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-extensions\" id=\"ref-for-dom-publickeycredentialcreationoptions-extensions②\">extensions</a></code></code>.</p>\n          </dd></dl>"
                        },
                        {
                          "html": "Let <var>constructCredentialAlg</var> be an algorithm that takes a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global\">global object</a> <var>global</var>, and whose steps are:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "If <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationconveyancepreferenceoption\" id=\"ref-for-credentialcreationdata-attestationconveyancepreferenceoption\">attestationConveyancePreferenceOption</a></code>’s value is",
                              "rationale": ".switch",
                              "steps": [
                                {
                                  "operation": "switch",
                                  "steps": [
                                    {
                                      "case": "none",
                                      "steps": [
                                        {
                                          "html": "Replace potentially uniquely identifying information with non-identifying versions of the\nsame:",
                                          "rationale": "if",
                                          "steps": [
                                            {
                                              "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid①\">aaguid</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attested-credential-data\" id=\"ref-for-attested-credential-data\">attested credential data</a> is 16 zero bytes, <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult\">attestationObjectResult</a>.fmt</code> is \"packed\", and \"x5c\" is absent from <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult①\">attestationObjectResult</a></code>, then <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self-attestation\" id=\"ref-for-self-attestation④\">self attestation</a> is being used and no further action is needed.</p>"
                                            },
                                            {
                                              "html": "Otherwise:",
                                              "rationale": "set",
                                              "steps": [
                                                {
                                                  "html": "<p>Set the value of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult②\">attestationObjectResult</a>.fmt</code> to \"none\", and set the value of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult③\">attestationObjectResult</a>.attStmt</code> to be an empty <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#cbor\" id=\"ref-for-cbor③\">CBOR</a> map. (See <a href=\"https://w3c.github.io/webauthn/#sctn-none-attestation\">§ 8.7 None Attestation Statement Format</a> and <a href=\"https://w3c.github.io/webauthn/#sctn-generating-an-attestation-object\">§ 6.5.4 Generating an Attestation Object</a>).</p>"
                                                },
                                                {
                                                  "html": "<p>If <var>authenticator</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#platform-authenticators\" id=\"ref-for-platform-authenticators①①\">platform authenticator</a> then replace the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid②\">aaguid</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attested-credential-data\" id=\"ref-for-attested-credential-data①\">attested credential data</a> with 16 zero bytes.</p>"
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    },
                                    {
                                      "case": "indirect",
                                      "steps": [
                                        {
                                          "html": "<p>The client MAY replace the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid③\">aaguid</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement④\">attestation statement</a> with a more privacy-friendly\nand/or more easily verifiable version of the same data (for example, by employing an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#anonymization-ca\" id=\"ref-for-anonymization-ca\">Anonymization CA</a>).</p>"
                                        }
                                      ]
                                    },
                                    {
                                      "case": "direct or enterprise",
                                      "steps": [
                                        {
                                          "html": "<p>Convey the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑦③\">authenticator</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#aaguid\" id=\"ref-for-aaguid\">AAGUID</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement⑤\">attestation statement</a>, unaltered, to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party①⓪⓪\">Relying Party</a>.</p>"
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "html": "<p>Let <var>attestationObject</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑤\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor①\">%ArrayBuffer%</a>, containing the\nbytes of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-attestationobjectresult\" id=\"ref-for-credentialcreationdata-attestationobjectresult④\">attestationObjectResult</a></code>’s value.</p>"
                            },
                            {
                              "html": "<p>Let <var>id</var> be <code><var>attestationObject</var>.authData.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata\" id=\"ref-for-authdata-attestedcredentialdata\">attestedCredentialData</a>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialid\" id=\"ref-for-authdata-attestedcredentialdata-credentialid\">credentialId</a></code>.</p>"
                            },
                            {
                              "html": "<p>Let <var>pubKeyCred</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#publickeycredential\" id=\"ref-for-publickeycredential①③\">PublicKeyCredential</a></code> object associated with <var>global</var> whose fields are:</p>\n            <dl>\n             <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-identifier-slot\" id=\"ref-for-dom-publickeycredential-identifier-slot②\">[[identifier]]</a></code>\n             </dt><dd data-md=\"\">\n              <p><var>id</var></p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-authenticatorattachment\" id=\"ref-for-dom-publickeycredential-authenticatorattachment②\">authenticatorAttachment</a></code>\n             </dt><dd data-md=\"\">\n              <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-authenticatorattachment\" id=\"ref-for-enumdef-authenticatorattachment①\">AuthenticatorAttachment</a></code> value matching the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-attachment-modality\" id=\"ref-for-authenticator-attachment-modality③\">authenticator attachment modality</a> of <var>authenticator</var>.</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-response\" id=\"ref-for-dom-publickeycredential-response②\">response</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorattestationresponse\" id=\"ref-for-authenticatorattestationresponse①\">AuthenticatorAttestationResponse</a></code> object associated with <var>global</var> whose fields are:</p>\n              <dl>\n               <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson①\">clientDataJSON</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑥\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor②\">%ArrayBuffer%</a>, containing the bytes of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-clientdatajsonresult\" id=\"ref-for-credentialcreationdata-clientdatajsonresult\">clientDataJSONResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-attestationobject\" id=\"ref-for-dom-authenticatorattestationresponse-attestationobject①\">attestationObject</a></code>\n               </dt><dd data-md=\"\">\n                <p><var>attestationObject</var></p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-transports-slot\" id=\"ref-for-dom-authenticatorattestationresponse-transports-slot\">[[transports]]</a></code>\n               </dt><dd data-md=\"\">\n                <p>A sequence of zero or more unique <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①①\">DOMString</a></code>s, in lexicographical order, that the <var>authenticator</var> is believed to support. The values SHOULD be members of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-authenticatortransport\" id=\"ref-for-enumdef-authenticatortransport\">AuthenticatorTransport</a></code>, but <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform①⑨\">client platforms</a> MUST ignore unknown values.</p>\n                <p>If a user agent does not wish to divulge this information it MAY substitute an arbitrary sequence designed to preserve privacy. This sequence MUST still be valid, i.e. lexicographically sorted and free of duplicates. For example, it may use the empty sequence. Either way, in this case the user agent takes the risk that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party①⓪①\">Relying Party</a> behavior may be suboptimal.</p>\n                <p>If the user agent does not have any transport information, it SHOULD set this field to the empty sequence.</p>\n                \n              </dd></dl>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-clientextensionsresults-slot\" id=\"ref-for-dom-publickeycredential-clientextensionsresults-slot①\">[[clientExtensionsResults]]</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑦\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor③\">%ArrayBuffer%</a>, containing the bytes of <code><var>credentialCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credentialcreationdata-clientextensionresults\" id=\"ref-for-credentialcreationdata-clientextensionresults\">clientExtensionResults</a></code>.</p>\n            </dd></dl>"
                            },
                            {
                              "html": "<p>Return <var>pubKeyCred</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑧\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑤\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⓪\">remove</a> it from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p>Return <var>constructCredentialAlg</var> and terminate this algorithm.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑤\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code>. In order to prevent information leak that could identify the\nuser without <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent⑧\">consent</a>, this step MUST NOT be executed before <var>lifetimeTimer</var> has expired. See <a href=\"https://w3c.github.io/webauthn/#sctn-make-credential-privacy\">§ 14.5.1 Registration Ceremony Privacy</a> for details.</p>"
        }
      ]
    },
    {
      "html": "When this method is invoked, the user agent MUST execute the following algorithm:",
      "rationale": "assert",
      "steps": [
        {
          "html": "<p class=\"assertion\">Assert: <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey\" id=\"ref-for-dom-credentialrequestoptions-publickey②\">publicKey</a></code></code> is present.</p>"
        },
        {
          "html": "<p>Let <var>pkOptions</var> be the value of <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey\" id=\"ref-for-dom-credentialrequestoptions-publickey③\">publicKey</a></code></code>.</p>"
        },
        {
          "html": "If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialrequestoptions-mediation\" id=\"ref-for-dom-credentialrequestoptions-mediation②\">mediation</a></code></code> is present with the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-conditional\" id=\"ref-for-dom-credentialmediationrequirement-conditional①③\">conditional</a></code>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>credentialIdFilter</var> be the value of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials⑤\">allowCredentials</a></code></code>.</p>"
            },
            {
              "html": "<p>Set <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials⑥\">allowCredentials</a></code></code> to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①\">empty</a>.</p>"
            },
            {
              "html": "<p>Set a timer <var>lifetimeTimer</var> to a value of infinity.</p>"
            }
          ]
        },
        {
          "html": "Else:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>credentialIdFilter</var> be an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty②\">empty</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list②\">list</a>.</p>"
            },
            {
              "html": "<p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout\" id=\"ref-for-dom-publickeycredentialrequestoptions-timeout\">timeout</a></code></code> is present, check if its value lies\nwithin a reasonable range as defined by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client\" id=\"ref-for-client②②\">client</a> and if not, correct it to the closest value lying within that range.\nSet a timer <var>lifetimeTimer</var> to this adjusted value. If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout\" id=\"ref-for-dom-publickeycredentialrequestoptions-timeout①\">timeout</a></code></code> is not present, then set <var>lifetimeTimer</var> to a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client\" id=\"ref-for-client②③\">client</a>-specific default.</p>\n        <p>See the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#recommended-range-and-default-for-a-webauthn-ceremony-timeout\" id=\"ref-for-recommended-range-and-default-for-a-webauthn-ceremony-timeout①\">recommended range and default for a WebAuthn ceremony timeout</a> for guidance on deciding a reasonable range and default for <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout\" id=\"ref-for-dom-publickeycredentialrequestoptions-timeout②\">timeout</a></code></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>callerOrigin</var> be <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-origin-options-sameoriginwithancestors-origin\" id=\"ref-for-dom-publickeycredential-discoverfromexternalsource-origin-options-sameoriginwithancestors-origin\">origin</a></code>. If <var>callerOrigin</var> is\nan <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin-opaque\" id=\"ref-for-concept-origin-opaque①\">opaque origin</a>, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑥\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>effectiveDomain</var> be the <var>callerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-effective-domain\" id=\"ref-for-concept-origin-effective-domain⑧\">effective domain</a>.\nIf <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-effective-domain\" id=\"ref-for-concept-origin-effective-domain⑨\">effective domain</a> is not a <a data-link-type=\"dfn\" href=\"https://url.spec.whatwg.org/#valid-domain\" id=\"ref-for-valid-domain②\">valid domain</a>, then throw a\n\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror②\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①③\">DOMException</a></code>.</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid\" id=\"ref-for-dom-publickeycredentialrequestoptions-rpid①\">rpId</a></code></code> <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#is-a-registrable-domain-suffix-of-or-is-equal-to\" id=\"ref-for-is-a-registrable-domain-suffix-of-or-is-equal-to③\">is not a registrable domain suffix of and is not\nequal to</a> <var>effectiveDomain</var>, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror③\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①④\">DOMException</a></code>.</p>"
            },
            {
              "html": "<p>Set <var>rpId</var> to <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid\" id=\"ref-for-dom-publickeycredentialrequestoptions-rpid②\">rpId</a></code></code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>clientExtensions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③\">map</a> and let <var>authenticatorExtensions</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">map</a>.</p>"
        },
        {
          "html": "If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions\" id=\"ref-for-dom-publickeycredentialrequestoptions-extensions\">extensions</a></code></code> is present, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate①\">for each</a> <var>extensionId</var> → <var>clientExtensionInput</var> of <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions\" id=\"ref-for-dom-publickeycredentialrequestoptions-extensions①\">extensions</a></code></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>extensionId</var> is not supported by this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform②①\">client platform</a> or is not an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authentication-extension\" id=\"ref-for-authentication-extension\">authentication extension</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⓪\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set②\">Set</a> <var>clientExtensions</var>[<var>extensionId</var>] to <var>clientExtensionInput</var>.</p>"
            },
            {
              "html": "<p>If <var>extensionId</var> is not an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension\" id=\"ref-for-authenticator-extension①\">authenticator extension</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①①\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>authenticatorExtensionInput</var> be the (<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#cbor\" id=\"ref-for-cbor④\">CBOR</a>) result of running <var>extensionId</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-processing\" id=\"ref-for-client-extension-processing③\">client extension processing</a> algorithm on <var>clientExtensionInput</var>. If the algorithm returned an error, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①②\">continue</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set③\">Set</a> <var>authenticatorExtensions</var>[<var>extensionId</var>] to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding⑤\">base64url encoding</a> of <var>authenticatorExtensionInput</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>collectedClientData</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-collectedclientdata\" id=\"ref-for-dictdef-collectedclientdata①\">CollectedClientData</a></code> instance whose fields are:</p>\n      <dl>\n       <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-type\" id=\"ref-for-dom-collectedclientdata-type①\">type</a></code>\n       </dt><dd data-md=\"\">\n        <p>The string \"webauthn.get\".</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge\" id=\"ref-for-dom-collectedclientdata-challenge①\">challenge</a></code>\n       </dt><dd data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding⑥\">base64url encoding</a> of <var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge\" id=\"ref-for-dom-publickeycredentialrequestoptions-challenge\">challenge</a></code></p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-origin\" id=\"ref-for-dom-collectedclientdata-origin①\">origin</a></code>\n       </dt><dd data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin②\">serialization of</a> <var>callerOrigin</var>.</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin①\">topOrigin</a></code>\n       </dt><dd data-md=\"\">\n        <p>The <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin\" id=\"ref-for-ascii-serialisation-of-an-origin③\">serialization of</a> <var>callerOrigin</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin\" id=\"ref-for-concept-environment-top-level-origin②\">top-level origin</a> if\nthe <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-origin-options-sameoriginwithancestors-sameoriginwithancestors\" id=\"ref-for-dom-publickeycredential-discoverfromexternalsource-origin-options-sameoriginwithancestors-sameoriginwithancestors\">sameOriginWithAncestors</a></code> argument passed to this <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①④\">internal method</a> is <code>false</code>, else <code>undefined</code>.</p>\n       </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-crossorigin\" id=\"ref-for-dom-collectedclientdata-crossorigin①\">crossOrigin</a></code>\n       </dt><dd data-md=\"\">\n        <p>The inverse of the value of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-origin-options-sameoriginwithancestors-sameoriginwithancestors\" id=\"ref-for-dom-publickeycredential-discoverfromexternalsource-origin-options-sameoriginwithancestors-sameoriginwithancestors①\">sameOriginWithAncestors</a></code> argument passed to this <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots\" id=\"ref-for-sec-object-internal-methods-and-internal-slots①⑤\">internal method</a>.</p>\n      </dd></dl>"
        },
        {
          "html": "<p>Let <var>clientDataJSON</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-json-compatible-serialization-of-client-data\" id=\"ref-for-collectedclientdata-json-compatible-serialization-of-client-data①\">JSON-compatible serialization of client data</a> constructed from <var>collectedClientData</var>.</p>"
        },
        {
          "html": "<p>Let <var>clientDataHash</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-hash-of-the-serialized-client-data\" id=\"ref-for-collectedclientdata-hash-of-the-serialized-client-data①\">hash of the serialized client data</a> represented by <var>clientDataJSON</var>.</p>"
        },
        {
          "html": "<p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialrequestoptions-signal\" id=\"ref-for-dom-credentialrequestoptions-signal\">signal</a></code></code> is present and <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted②\">aborted</a>, throw\nthe <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialrequestoptions-signal\" id=\"ref-for-dom-credentialrequestoptions-signal①\">signal</a></code></code>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason②\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>issuedRequests</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set②\">ordered set</a>.</p>"
        },
        {
          "html": "<p>Let <var>savedCredentialIds</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤\">map</a>.</p>"
        },
        {
          "html": "<p>Let <var>authenticators</var> represent a value which at any given instant is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">set</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform②②\">client platform</a>-specific handles, where each <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item③\">item</a> identifies an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑦⑥\">authenticator</a> presently available on this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform②③\">client platform</a> at that instant.</p>"
        },
        {
          "html": "<p>Let <var>silentlyDiscoveredCredentials</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">map</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\" id=\"ref-for-map-entry\">entries</a> are of the form: <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata\" id=\"ref-for-discoverablecredentialmetadata\">DiscoverableCredentialMetadata</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑦⑨\">authenticator</a>.</p>"
        },
        {
          "html": "<p>Consider the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-hints\" id=\"ref-for-dom-publickeycredentialrequestoptions-hints\">hints</a></code> and craft the user interface accordingly, as the user-agent sees fit.</p>"
        },
        {
          "html": "<p>Start <var>lifetimeTimer</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-while\" id=\"ref-for-iteration-while①\">While</a> <var>lifetimeTimer</var> has not expired, perform the following actions depending upon <var>lifetimeTimer</var>,\nand the state and response <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑨\">for each</a> <var>authenticator</var> in <var>authenticators</var>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If lifetimeTimer expires,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⓪\">For each</a> <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑥\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①①\">remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "If the user exercises a user agent user-interface option to cancel the process,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①①\">For each</a> <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑦\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①②\">remove</a> <var>authenticator</var> from <var>issuedRequests</var>. Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑦\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑤\">DOMException</a></code>.</p>"
                    }
                  ]
                },
                {
                  "case": "If options.signal is present and aborted,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①②\">For each</a> <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑧\">authenticatorCancel</a> operation on <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①③\">remove</a> <var>authenticator</var> from <var>issuedRequests</var>. Then\nthrow the <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialrequestoptions-signal\" id=\"ref-for-dom-credentialrequestoptions-signal③\">signal</a></code></code>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason③\">abort reason</a>.</p>"
                    }
                  ]
                },
                {
                  "case": "If options.mediation is conditional and the user interacts with an input or textarea form control with an autocomplete attribute whose non-autofill credential type is \"webauthn\",",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p>If <var>silentlyDiscoveredCredentials</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty③\">empty</a>:</p>\n          <ol>\n           <li data-md=\"\">\n            <p>Prompt the user to optionally select a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata\" id=\"ref-for-discoverablecredentialmetadata①\">DiscoverableCredentialMetadata</a> (<var>credentialMetadata</var>) from <var>silentlyDiscoveredCredentials</var>.</p>\n            \n           </li><li data-md=\"\">\n            <p>If the user selects a <var>credentialMetadata</var>,</p>\n            <ol>\n             <li data-md=\"\">\n              <p>Let <var>publicKeyOptions</var> be a temporary copy of <var>pkOptions</var>.</p>\n             </li><li data-md=\"\">\n              <p>Let <var>authenticator</var> be the value of <var>silentlyDiscoveredCredentials</var>[<var>credentialMetadata</var>].</p>\n             </li><li data-md=\"\">\n              <p>Set <code><var>publicKeyOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials⑦\">allowCredentials</a></code></code> to be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> containing a\nsingle <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor\" id=\"ref-for-dictdef-publickeycredentialdescriptor①\">PublicKeyCredentialDescriptor</a></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item④\">item</a> whose <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id①\">id</a></code>'s value is set to <var>credentialMetadata</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata-id\" id=\"ref-for-discoverablecredentialmetadata-id\">id</a>'s value and whose<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id②\">id</a></code> value is set to <var>credentialMetadata</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata-type\" id=\"ref-for-discoverablecredentialmetadata-type\">type</a>.</p>\n             </li><li data-md=\"\">\n              <p>Execute the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#publickeycredential-issuing-a-credential-request-to-an-authenticator\" id=\"ref-for-publickeycredential-issuing-a-credential-request-to-an-authenticator\">issuing a credential request to an authenticator</a> algorithm with <var>authenticator</var>, <var>savedCredentialIds</var>, <var>publicKeyOptions</var>, <var>rpId</var>, <var>clientDataHash</var>, and <var>authenticatorExtensions</var>.</p>\n              <p>If this returns <code>false</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①③\">continue</a>.</p>\n             </li><li data-md=\"\">\n              <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>authenticator</var> to <var>issuedRequests</var>.</p>\n            </li></ol>\n          </li></ol>\n        </li></ol>",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>silentlyDiscoveredCredentials</var> is not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty③\">empty</a>:",
                          "rationale": "prompt",
                          "steps": [
                            {
                              "html": "<p>Prompt the user to optionally select a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata\" id=\"ref-for-discoverablecredentialmetadata①\">DiscoverableCredentialMetadata</a> (<var>credentialMetadata</var>) from <var>silentlyDiscoveredCredentials</var>.</p>"
                            },
                            {
                              "html": "If the user selects a <var>credentialMetadata</var>,",
                              "rationale": "let",
                              "steps": [
                                {
                                  "html": "<p>Let <var>publicKeyOptions</var> be a temporary copy of <var>pkOptions</var>.</p>"
                                },
                                {
                                  "html": "<p>Let <var>authenticator</var> be the value of <var>silentlyDiscoveredCredentials</var>[<var>credentialMetadata</var>].</p>"
                                },
                                {
                                  "html": "<p>Set <code><var>publicKeyOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials⑦\">allowCredentials</a></code></code> to be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list③\">list</a> containing a\nsingle <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor\" id=\"ref-for-dictdef-publickeycredentialdescriptor①\">PublicKeyCredentialDescriptor</a></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item④\">item</a> whose <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id①\">id</a></code>'s value is set to <var>credentialMetadata</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata-id\" id=\"ref-for-discoverablecredentialmetadata-id\">id</a>'s value and whose<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id②\">id</a></code> value is set to <var>credentialMetadata</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata-type\" id=\"ref-for-discoverablecredentialmetadata-type\">type</a>.</p>"
                                },
                                {
                                  "html": "<p>Execute the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#publickeycredential-issuing-a-credential-request-to-an-authenticator\" id=\"ref-for-publickeycredential-issuing-a-credential-request-to-an-authenticator\">issuing a credential request to an authenticator</a> algorithm with <var>authenticator</var>, <var>savedCredentialIds</var>, <var>publicKeyOptions</var>, <var>rpId</var>, <var>clientDataHash</var>, and <var>authenticatorExtensions</var>.</p>\n              <p>If this returns <code>false</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①③\">continue</a>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">Append</a> <var>authenticator</var> to <var>issuedRequests</var>.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "If options.mediation is not conditional, issuedRequests is empty, pkOptions.allowCredentials is not empty, and no authenticator will become available for any public key credentials therein,",
                  "steps": [
                    {
                      "html": "<p>Indicate to the user that no eligible credential could be found. When the user acknowledges the dialog, throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑧\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑥\">DOMException</a></code>.</p>"
                    }
                  ]
                },
                {
                  "case": "If an authenticator becomes available on this client device,",
                  "steps": [
                    {
                      "html": "<span class=\"marker\">Note:</span> This includes the case where an <var>authenticator</var> was available upon <var>lifetimeTimer</var> initiation.",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialrequestoptions-mediation\" id=\"ref-for-dom-credentialrequestoptions-mediation⑤\">mediation</a></code></code> is <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-conditional\" id=\"ref-for-dom-credentialmediationrequirement-conditional①⑦\">conditional</a></code> and the <var>authenticator</var> supports the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#silentcredentialdiscovery\" id=\"ref-for-silentcredentialdiscovery\">silentCredentialDiscovery</a> operation:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>collectedDiscoveredCredentialMetadata</var> be the result of invoking the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#silentcredentialdiscovery\" id=\"ref-for-silentcredentialdiscovery①\">silentCredentialDiscovery</a> operation on <var>authenticator</var> with <var>rpId</var> as parameter.</p>"
                            },
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①③\">For each</a> <var>credentialMetadata</var> of <var>collectedDiscoveredCredentialMetadata</var>:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "<p>If <var>credentialIdFilter</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty④\">is empty</a> or <var>credentialIdFilter</var> contains an item whose <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id③\">id</a></code>'s value is set to <var>credentialMetadata</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata-id\" id=\"ref-for-discoverablecredentialmetadata-id①\">id</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set④\">set</a> <var>silentlyDiscoveredCredentials</var>[<var>credentialMetadata</var>] to <var>authenticator</var>.</p>"
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "Else:",
                          "rationale": "execute",
                          "steps": [
                            {
                              "html": "<p>Execute the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#publickeycredential-issuing-a-credential-request-to-an-authenticator\" id=\"ref-for-publickeycredential-issuing-a-credential-request-to-an-authenticator①\">issuing a credential request to an authenticator</a> algorithm with <var>authenticator</var>, <var>savedCredentialIds</var>, <var>pkOptions</var>, <var>rpId</var>, <var>clientDataHash</var>, and <var>authenticatorExtensions</var>.</p>\n            <p>If this returns <code>false</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①④\">continue</a>.</p>"
                            },
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">Append</a> <var>authenticator</var> to <var>issuedRequests</var>.</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "If an authenticator ceases to be available on this client device,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①④\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "If any authenticator returns a status indicating that the user cancelled the operation,",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑤\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①④\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑨\">authenticatorCancel</a> operation\non <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑥\">remove</a> it from <var>issuedRequests</var>.</p>\n          \n        </li></ol>",
                      "rationale": "remove",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑤\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①④\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel⑨\">authenticatorCancel</a> operation\non <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑥\">remove</a> it from <var>issuedRequests</var>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "If any authenticator returns an error status,",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑦\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "If any authenticator indicates success,",
                  "steps": [
                    {
                      "html": "<ol>\n         <li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑧\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p><span id=\"assertionCreationDataCreation\"></span> Let <var>assertionCreationData</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct③\">struct</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑨\">items</a> are:</p>\n          <dl>\n           <dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-credentialidresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">credentialIdResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>If <code><var>savedCredentialIds</var>[<var>authenticator</var>]</code> exists, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult\">credentialIdResult</a> to be\nthe bytes of <code><var>savedCredentialIds</var>[<var>authenticator</var>]</code>. Otherwise, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult①\">credentialIdResult</a> to be the bytes of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id②⓪\">credential ID</a> returned from the successful <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion③\">authenticatorGetAssertion</a> operation, as defined in <a href=\"https://w3c.github.io/webauthn/#sctn-op-get-assertion\">§ 6.3.3 The authenticatorGetAssertion Operation</a>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-clientdatajsonresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientDataJSONResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of <var>clientDataJSON</var>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-authenticatordataresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">authenticatorDataResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data\" id=\"ref-for-authenticator-data⑤\">authenticator data</a> returned by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑧①\">authenticator</a>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-signatureresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">signatureResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of the signature value returned by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑧②\">authenticator</a>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-userhandleresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">userHandleResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑧③\">authenticator</a> returned a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-handle\" id=\"ref-for-user-handle⑨\">user handle</a>, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult\">userHandleResult</a> to be the bytes of\nthe returned <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-handle\" id=\"ref-for-user-handle①⓪\">user handle</a>. Otherwise, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult①\">userHandleResult</a> to null.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-clientextensionresults\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientExtensionResults</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientoutputs\" id=\"ref-for-dictdef-authenticationextensionsclientoutputs②\">AuthenticationExtensionsClientOutputs</a></code> object containing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier②\">extension identifier</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output③\">client extension output</a> entries. The entries are created by running each extension’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-processing\" id=\"ref-for-client-extension-processing④\">client extension processing</a> algorithm to create the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output④\">client extension outputs</a>, for each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension\" id=\"ref-for-client-extension①\">client extension</a> in <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions\" id=\"ref-for-dom-publickeycredentialrequestoptions-extensions②\">extensions</a></code></code>.</p>\n          </dd></dl>\n         </li><li data-md=\"\">\n          <p>If <var>credentialIdFilter</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑤\">is not empty</a> and <var>credentialIdFilter</var> does not contain an item whose <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id④\">id</a></code>'s value is set to the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult②\">credentialIdResult</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑤\">continue</a>.</p>\n         </li><li data-md=\"\">\n          <p>If <var>credentialIdFilter</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑥\">is empty</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult②\">userHandleResult</a> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑥\">continue</a>.</p>\n         </li><li data-md=\"\">\n          <p>Let <var>constructAssertionAlg</var> be an algorithm that takes a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global①\">global object</a> <var>global</var>, and whose steps are:</p>\n          <ol>\n           <li data-md=\"\">\n            <p>Let <var>pubKeyCred</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#publickeycredential\" id=\"ref-for-publickeycredential①④\">PublicKeyCredential</a></code> object associated with <var>global</var> whose fields are:</p>\n            <dl>\n             <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-identifier-slot\" id=\"ref-for-dom-publickeycredential-identifier-slot③\">[[identifier]]</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑧\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor④\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult③\">credentialIdResult</a></code>.</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-authenticatorattachment\" id=\"ref-for-dom-publickeycredential-authenticatorattachment③\">authenticatorAttachment</a></code>\n             </dt><dd data-md=\"\">\n              <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-authenticatorattachment\" id=\"ref-for-enumdef-authenticatorattachment②\">AuthenticatorAttachment</a></code> value matching the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-attachment-modality\" id=\"ref-for-authenticator-attachment-modality④\">authenticator attachment modality</a> of <var>authenticator</var>.</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-response\" id=\"ref-for-dom-publickeycredential-response③\">response</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorassertionresponse\" id=\"ref-for-authenticatorassertionresponse②\">AuthenticatorAssertionResponse</a></code> object associated with <var>global</var> whose fields are:</p>\n              <dl>\n               <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson②\">clientDataJSON</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑨\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑤\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-clientdatajsonresult\" id=\"ref-for-assertioncreationdata-clientdatajsonresult\">clientDataJSONResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-authenticatordata\" id=\"ref-for-dom-authenticatorassertionresponse-authenticatordata\">authenticatorData</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①⓪\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑥\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-authenticatordataresult\" id=\"ref-for-assertioncreationdata-authenticatordataresult\">authenticatorDataResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-signature\" id=\"ref-for-dom-authenticatorassertionresponse-signature\">signature</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①①\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑦\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-signatureresult\" id=\"ref-for-assertioncreationdata-signatureresult\">signatureResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-userhandle\" id=\"ref-for-dom-authenticatorassertionresponse-userhandle②\">userHandle</a></code>\n               </dt><dd data-md=\"\">\n                <p>If <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult③\">userHandleResult</a></code> is null, set this\nfield to null. Otherwise, set this field to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①②\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑧\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult④\">userHandleResult</a></code>.</p>\n              </dd></dl>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-clientextensionsresults-slot\" id=\"ref-for-dom-publickeycredential-clientextensionsresults-slot②\">[[clientExtensionsResults]]</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①③\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑨\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-clientextensionresults\" id=\"ref-for-assertioncreationdata-clientextensionresults\">clientExtensionResults</a></code>.</p>\n            </dd></dl>\n           </li><li data-md=\"\">\n            <p>Return <var>pubKeyCred</var>.</p>\n          </li></ol>\n         </li><li data-md=\"\">\n          <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑤\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel①⓪\">authenticatorCancel</a> operation\non <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑨\">remove</a> it from <var>issuedRequests</var>.</p>\n         </li><li data-md=\"\">\n          <p>Return <var>constructAssertionAlg</var> and terminate this algorithm.</p>\n        </li></ol>",
                      "rationale": "remove",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑧\">Remove</a> <var>authenticator</var> from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p><span id=\"assertionCreationDataCreation\"></span> Let <var>assertionCreationData</var> be a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct③\">struct</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item⑨\">items</a> are:</p>\n          <dl>\n           <dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-credentialidresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">credentialIdResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>If <code><var>savedCredentialIds</var>[<var>authenticator</var>]</code> exists, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult\">credentialIdResult</a> to be\nthe bytes of <code><var>savedCredentialIds</var>[<var>authenticator</var>]</code>. Otherwise, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult①\">credentialIdResult</a> to be the bytes of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id②⓪\">credential ID</a> returned from the successful <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion③\">authenticatorGetAssertion</a> operation, as defined in <a href=\"https://w3c.github.io/webauthn/#sctn-op-get-assertion\">§ 6.3.3 The authenticatorGetAssertion Operation</a>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-clientdatajsonresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientDataJSONResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of <var>clientDataJSON</var>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-authenticatordataresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">authenticatorDataResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data\" id=\"ref-for-authenticator-data⑤\">authenticator data</a> returned by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑧①\">authenticator</a>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-signatureresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">signatureResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is the bytes of the signature value returned by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑧②\">authenticator</a>.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-userhandleresult\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">userHandleResult</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator⑧③\">authenticator</a> returned a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-handle\" id=\"ref-for-user-handle⑨\">user handle</a>, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult\">userHandleResult</a> to be the bytes of\nthe returned <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-handle\" id=\"ref-for-user-handle①⓪\">user handle</a>. Otherwise, set the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult①\">userHandleResult</a> to null.</p>\n           </dd><dt data-md=\"\"><code><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"assertionCreationData\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"assertioncreationdata-clientextensionresults\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">clientExtensionResults</dfn></code>\n           </dt><dd data-md=\"\">\n            <p>whose value is an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientoutputs\" id=\"ref-for-dictdef-authenticationextensionsclientoutputs②\">AuthenticationExtensionsClientOutputs</a></code> object containing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier②\">extension identifier</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output③\">client extension output</a> entries. The entries are created by running each extension’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-processing\" id=\"ref-for-client-extension-processing④\">client extension processing</a> algorithm to create the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output④\">client extension outputs</a>, for each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension\" id=\"ref-for-client-extension①\">client extension</a> in <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions\" id=\"ref-for-dom-publickeycredentialrequestoptions-extensions②\">extensions</a></code></code>.</p>\n          </dd></dl>"
                        },
                        {
                          "html": "<p>If <var>credentialIdFilter</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑤\">is not empty</a> and <var>credentialIdFilter</var> does not contain an item whose <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id④\">id</a></code>'s value is set to the value of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult②\">credentialIdResult</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑤\">continue</a>.</p>"
                        },
                        {
                          "html": "<p>If <var>credentialIdFilter</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑥\">is empty</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult②\">userHandleResult</a> is null, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑥\">continue</a>.</p>"
                        },
                        {
                          "html": "Let <var>constructAssertionAlg</var> be an algorithm that takes a <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-global\" id=\"ref-for-concept-settings-object-global①\">global object</a> <var>global</var>, and whose steps are:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>pubKeyCred</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#publickeycredential\" id=\"ref-for-publickeycredential①④\">PublicKeyCredential</a></code> object associated with <var>global</var> whose fields are:</p>\n            <dl>\n             <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-identifier-slot\" id=\"ref-for-dom-publickeycredential-identifier-slot③\">[[identifier]]</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑧\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor④\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-credentialidresult\" id=\"ref-for-assertioncreationdata-credentialidresult③\">credentialIdResult</a></code>.</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-authenticatorattachment\" id=\"ref-for-dom-publickeycredential-authenticatorattachment③\">authenticatorAttachment</a></code>\n             </dt><dd data-md=\"\">\n              <p>The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-authenticatorattachment\" id=\"ref-for-enumdef-authenticatorattachment②\">AuthenticatorAttachment</a></code> value matching the current <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-attachment-modality\" id=\"ref-for-authenticator-attachment-modality④\">authenticator attachment modality</a> of <var>authenticator</var>.</p>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-response\" id=\"ref-for-dom-publickeycredential-response③\">response</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorassertionresponse\" id=\"ref-for-authenticatorassertionresponse②\">AuthenticatorAssertionResponse</a></code> object associated with <var>global</var> whose fields are:</p>\n              <dl>\n               <dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson②\">clientDataJSON</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer⑨\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑤\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-clientdatajsonresult\" id=\"ref-for-assertioncreationdata-clientdatajsonresult\">clientDataJSONResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-authenticatordata\" id=\"ref-for-dom-authenticatorassertionresponse-authenticatordata\">authenticatorData</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①⓪\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑥\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-authenticatordataresult\" id=\"ref-for-assertioncreationdata-authenticatordataresult\">authenticatorDataResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-signature\" id=\"ref-for-dom-authenticatorassertionresponse-signature\">signature</a></code>\n               </dt><dd data-md=\"\">\n                <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①①\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑦\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-signatureresult\" id=\"ref-for-assertioncreationdata-signatureresult\">signatureResult</a></code>.</p>\n               </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-userhandle\" id=\"ref-for-dom-authenticatorassertionresponse-userhandle②\">userHandle</a></code>\n               </dt><dd data-md=\"\">\n                <p>If <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult③\">userHandleResult</a></code> is null, set this\nfield to null. Otherwise, set this field to a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①②\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑧\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-userhandleresult\" id=\"ref-for-assertioncreationdata-userhandleresult④\">userHandleResult</a></code>.</p>\n              </dd></dl>\n             </dd><dt data-md=\"\"><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-clientextensionsresults-slot\" id=\"ref-for-dom-publickeycredential-clientextensionsresults-slot②\">[[clientExtensionsResults]]</a></code>\n             </dt><dd data-md=\"\">\n              <p>A new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\" id=\"ref-for-idl-ArrayBuffer①③\">ArrayBuffer</a></code>, created using <var>global</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-arraybuffer-constructor\" id=\"ref-for-sec-arraybuffer-constructor⑨\">%ArrayBuffer%</a>, containing the bytes of <code><var>assertionCreationData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertioncreationdata-clientextensionresults\" id=\"ref-for-assertioncreationdata-clientextensionresults\">clientExtensionResults</a></code>.</p>\n            </dd></dl>"
                            },
                            {
                              "html": "<p>Return <var>pubKeyCred</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑤\">For each</a> remaining <var>authenticator</var> in <var>issuedRequests</var> invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorcancel\" id=\"ref-for-authenticatorcancel①⓪\">authenticatorCancel</a> operation\non <var>authenticator</var> and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove①⑨\">remove</a> it from <var>issuedRequests</var>.</p>"
                        },
                        {
                          "html": "<p>Return <var>constructAssertionAlg</var> and terminate this algorithm.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑨\">NotAllowedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑦\">DOMException</a></code>. In order to prevent information leak that could identify the\nuser without <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent①⓪\">consent</a>, this step MUST NOT be executed before <var>lifetimeTimer</var> has expired. See <a href=\"https://w3c.github.io/webauthn/#sctn-assertion-privacy\">§ 14.5.2 Authentication Ceremony Privacy</a> for details.</p>"
        }
      ]
    },
    {
      "html": "The steps for <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#publickeycredential-issuing-a-credential-request-to-an-authenticator\" id=\"ref-for-publickeycredential-issuing-a-credential-request-to-an-authenticator②\">issuing a credential request to an authenticator</a> are as follows:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification\" id=\"ref-for-dom-publickeycredentialrequestoptions-userverification\">userVerification</a></code></code> is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-userverificationrequirement-required\" id=\"ref-for-dom-userverificationrequirement-required②\">required</a></code> and the <var>authenticator</var> is not capable of performing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification①⑨\">user verification</a>,\nreturn <code>false</code>.</p>"
        },
        {
          "html": "Let <var>userVerification</var> be the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"effective-user-verification-requirement-for-assertion\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">effective user verification requirement for assertion</dfn>, a Boolean value, as\nfollows. If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification\" id=\"ref-for-dom-publickeycredentialrequestoptions-userverification①\">userVerification</a></code></code>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "is set to required",
                  "steps": [
                    {
                      "html": "<p>Let <var>userVerification</var> be <code>true</code>.</p>"
                    }
                  ]
                },
                {
                  "case": "is set to preferred",
                  "steps": [
                    {
                      "html": "If the <var>authenticator</var>",
                      "rationale": ".switch",
                      "steps": [
                        {
                          "operation": "switch",
                          "steps": [
                            {
                              "case": "is capable of user verification",
                              "steps": [
                                {
                                  "html": "<p>Let <var>userVerification</var> be <code>true</code>.</p>"
                                }
                              ]
                            },
                            {
                              "case": "is not capable of user verification",
                              "steps": [
                                {
                                  "html": "<p>Let <var>userVerification</var> be <code>false</code>.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "is set to discouraged",
                  "steps": [
                    {
                      "html": "<p>Let <var>userVerification</var> be <code>false</code>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<span id=\"allowCredentialDescriptorListCreation\"></span> If <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①⓪\">allowCredentials</a></code></code>",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "is not empty",
                  "steps": [
                    {
                      "html": "<ol>\n        <li data-md=\"\">\n         <p>Let <var>allowCredentialDescriptorList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a>.</p>\n        </li><li data-md=\"\">\n         <p>Execute a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform②⑧\">client platform</a>-specific procedure to determine which, if any, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential\" id=\"ref-for-public-key-credential③⓪\">public key credentials</a> described by <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①①\">allowCredentials</a></code></code> are <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#bound-credential\" id=\"ref-for-bound-credential①⓪\">bound</a> to this <var>authenticator</var>, by matching with <var>rpId</var>, <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①②\">allowCredentials</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id⑤\">id</a></code></code>,\nand <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①③\">allowCredentials</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type\" id=\"ref-for-dom-publickeycredentialdescriptor-type①\">type</a></code></code>.\nSet <var>allowCredentialDescriptorList</var> to this filtered list.</p>\n        </li><li data-md=\"\">\n         <p>If <var>allowCredentialDescriptorList</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑧\">is empty</a>, return <code>false</code>.</p>\n        </li><li data-md=\"\">\n         <p>Let <var>distinctTransports</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">ordered set</a>.</p>\n        </li><li data-md=\"\">\n         <p>If <var>allowCredentialDescriptorList</var> has exactly one value, set <code><var>savedCredentialIds</var>[<var>authenticator</var>]</code> to <code><var>allowCredentialDescriptorList</var>[0].id</code>’s\nvalue (see <a href=\"https://w3c.github.io/webauthn/#authenticatorGetAssertion-return-values\">here</a> in <a href=\"https://w3c.github.io/webauthn/#sctn-op-get-assertion\">§ 6.3.3 The authenticatorGetAssertion Operation</a> for more information).</p>\n        </li><li data-md=\"\">\n         <p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑥\">For each</a> credential descriptor <var>C</var> in <var>allowCredentialDescriptorList</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">append</a> each value, if any, of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports\" id=\"ref-for-dom-publickeycredentialdescriptor-transports⑦\">transports</a></code></code> to <var>distinctTransports</var>.</p>\n         \n        </li><li data-md=\"\">\n         <p>If <var>distinctTransports</var></p>\n         <dl class=\"switch\">\n          <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑨\">is not empty</a>\n          </dt><dd data-md=\"\">\n           <p>The client selects one <var>transport</var> value from <var>distinctTransports</var>, possibly incorporating local\nconfiguration knowledge of the appropriate transport to use with <var>authenticator</var> in making its\nselection.</p>\n           <p>Then, using <var>transport</var>, invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion④\">authenticatorGetAssertion</a> operation on <var>authenticator</var>, with <var>rpId</var>, <var>clientDataHash</var>, <var>allowCredentialDescriptorList</var>, <var>userVerification</var>,\nand <var>authenticatorExtensions</var> as parameters.</p>\n          </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①⓪\">is empty</a>\n          </dt><dd data-md=\"\">\n           <p>Using local configuration knowledge of the appropriate transport to use with <var>authenticator</var>,\ninvoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion⑤\">authenticatorGetAssertion</a> operation on <var>authenticator</var> with <var>rpId</var>, <var>clientDataHash</var>, <var>allowCredentialDescriptorList</var>, <var>userVerification</var>,\nand <var>authenticatorExtensions</var> as parameters.</p>\n         </dd></dl>\n       </li></ol>",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>allowCredentialDescriptorList</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list④\">list</a>.</p>"
                        },
                        {
                          "html": "<p>Execute a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-platform\" id=\"ref-for-client-platform②⑧\">client platform</a>-specific procedure to determine which, if any, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential\" id=\"ref-for-public-key-credential③⓪\">public key credentials</a> described by <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①①\">allowCredentials</a></code></code> are <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#bound-credential\" id=\"ref-for-bound-credential①⓪\">bound</a> to this <var>authenticator</var>, by matching with <var>rpId</var>, <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①②\">allowCredentials</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id⑤\">id</a></code></code>,\nand <code><var>pkOptions</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①③\">allowCredentials</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type\" id=\"ref-for-dom-publickeycredentialdescriptor-type①\">type</a></code></code>.\nSet <var>allowCredentialDescriptorList</var> to this filtered list.</p>"
                        },
                        {
                          "html": "<p>If <var>allowCredentialDescriptorList</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty⑧\">is empty</a>, return <code>false</code>.</p>"
                        },
                        {
                          "html": "<p>Let <var>distinctTransports</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">ordered set</a>.</p>"
                        },
                        {
                          "html": "<p>If <var>allowCredentialDescriptorList</var> has exactly one value, set <code><var>savedCredentialIds</var>[<var>authenticator</var>]</code> to <code><var>allowCredentialDescriptorList</var>[0].id</code>’s\nvalue (see <a href=\"https://w3c.github.io/webauthn/#authenticatorGetAssertion-return-values\">here</a> in <a href=\"https://w3c.github.io/webauthn/#sctn-op-get-assertion\">§ 6.3.3 The authenticatorGetAssertion Operation</a> for more information).</p>"
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑥\">For each</a> credential descriptor <var>C</var> in <var>allowCredentialDescriptorList</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">append</a> each value, if any, of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports\" id=\"ref-for-dom-publickeycredentialdescriptor-transports⑦\">transports</a></code></code> to <var>distinctTransports</var>.</p>"
                        },
                        {
                          "html": "If <var>distinctTransports</var>",
                          "rationale": ".switch",
                          "steps": [
                            {
                              "operation": "switch",
                              "steps": [
                                {
                                  "case": "is not empty",
                                  "steps": [
                                    {
                                      "html": "<p>The client selects one <var>transport</var> value from <var>distinctTransports</var>, possibly incorporating local\nconfiguration knowledge of the appropriate transport to use with <var>authenticator</var> in making its\nselection.</p>\n           <p>Then, using <var>transport</var>, invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion④\">authenticatorGetAssertion</a> operation on <var>authenticator</var>, with <var>rpId</var>, <var>clientDataHash</var>, <var>allowCredentialDescriptorList</var>, <var>userVerification</var>,\nand <var>authenticatorExtensions</var> as parameters.</p>"
                                    }
                                  ]
                                },
                                {
                                  "case": "is empty",
                                  "steps": [
                                    {
                                      "html": "<p>Using local configuration knowledge of the appropriate transport to use with <var>authenticator</var>,\ninvoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion⑤\">authenticatorGetAssertion</a> operation on <var>authenticator</var> with <var>rpId</var>, <var>clientDataHash</var>, <var>allowCredentialDescriptorList</var>, <var>userVerification</var>,\nand <var>authenticatorExtensions</var> as parameters.</p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "case": "is empty",
                  "steps": [
                    {
                      "html": "<p>Using local configuration knowledge of the appropriate transport to use with <var>authenticator</var>, invoke the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion⑥\">authenticatorGetAssertion</a> operation on <var>authenticator</var> with <var>rpId</var>, <var>clientDataHash</var>, <var>userVerification</var>,\nand <var>authenticatorExtensions</var> as parameters.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <code>true</code>.</p>"
        }
      ]
    },
    {
      "html": "When this method is invoked, the user agent MUST execute the following algorithm:",
      "rationale": "throw",
      "steps": [
        {
          "html": "<p>Throw a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑧\">DOMException</a></code>.</p>"
        }
      ]
    },
    {
      "html": "The serialization algorithm works by appending successive byte strings to an, initially empty, partial result until the complete result is obtained.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>result</var> be an empty byte string.</p>"
        },
        {
          "html": "<p>Append 0x7b2274797065223a (<code>{\"type\":</code>) to <var>result</var>.</p>"
        },
        {
          "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#ccdtostring\" id=\"ref-for-ccdtostring\">CCDToString</a>(<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-type\" id=\"ref-for-dom-collectedclientdata-type③\">type</a></code>) to <var>result</var>.</p>"
        },
        {
          "html": "<p>Append 0x2c226368616c6c656e6765223a (<code>,\"challenge\":</code>) to <var>result</var>.</p>"
        },
        {
          "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#ccdtostring\" id=\"ref-for-ccdtostring①\">CCDToString</a>(<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge\" id=\"ref-for-dom-collectedclientdata-challenge③\">challenge</a></code>) to <var>result</var>.</p>"
        },
        {
          "html": "<p>Append 0x2c226f726967696e223a (<code>,\"origin\":</code>) to <var>result</var>.</p>"
        },
        {
          "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#ccdtostring\" id=\"ref-for-ccdtostring②\">CCDToString</a>(<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-origin\" id=\"ref-for-dom-collectedclientdata-origin③\">origin</a></code>) to <var>result</var>.</p>"
        },
        {
          "html": "<p>Append 0x2c2263726f73734f726967696e223a (<code>,\"crossOrigin\":</code>) to <var>result</var>.</p>"
        },
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-crossorigin\" id=\"ref-for-dom-collectedclientdata-crossorigin④\">crossOrigin</a></code> is not present, or is <code>false</code>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append 0x66616c7365 (<code>false</code>) to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append 0x74727565 (<code>true</code>) to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin③\">topOrigin</a></code> is present:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append 0x2c22746f704f726967696e223a (<code>,\"topOrigin\":</code>) to <var>result</var>.</p>"
            },
            {
              "html": "<p>Append <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#ccdtostring\" id=\"ref-for-ccdtostring③\">CCDToString</a>(<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin④\">topOrigin</a></code>) to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Create a temporary copy of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-collectedclientdata\" id=\"ref-for-dictdef-collectedclientdata⑧\">CollectedClientData</a></code> and remove the fields <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-type\" id=\"ref-for-dom-collectedclientdata-type④\">type</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge\" id=\"ref-for-dom-collectedclientdata-challenge④\">challenge</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-origin\" id=\"ref-for-dom-collectedclientdata-origin④\">origin</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-crossorigin\" id=\"ref-for-dom-collectedclientdata-crossorigin⑤\">crossOrigin</a></code> (if present), and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin⑤\">topOrigin</a></code> (if present).</p>"
        },
        {
          "html": "If no fields remain in the temporary copy then:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p>Append 0x7d (<code>}</code>) to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "<p>Invoke <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#serialize-a-javascript-value-to-json-bytes\" id=\"ref-for-serialize-a-javascript-value-to-json-bytes①\">serialize JSON to bytes</a> on the temporary copy to produce a byte string <var>remainder</var>.</p>"
            },
            {
              "html": "<p>Append 0x2c (<code>,</code>) to <var>result</var>.</p>"
            },
            {
              "html": "<p>Remove the leading byte from <var>remainder</var>.</p>"
            },
            {
              "html": "<p>Append <var>remainder</var> to <var>result</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>The result of the serialization is the value of <var>result</var>.</p>"
        }
      ]
    },
    {
      "name": "CCDToString",
      "href": "https://w3c.github.io/webauthn/#ccdtostring",
      "html": "The function <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"ccdtostring\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">CCDToString</dfn> is used in the above algorithm and is defined as:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>encoded</var> be an empty byte string.</p>"
        },
        {
          "html": "<p>Append 0x22 (<code>\"</code>) to <var>encoded</var>.</p>"
        },
        {
          "html": "<p>Invoke <a href=\"https://tc39.es/ecma262/#sec-tostring\">ToString</a> on the given object to convert to a string.</p>"
        },
        {
          "html": "For each code point in the resulting string, if the code point:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "is in the set {U+0020, U+0021, U+0023–U+005B, U+005D–U+10FFFF}",
                  "steps": [
                    {
                      "html": "<p>Append the UTF-8 encoding of that code point to <var>encoded</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "is U+0022",
                  "steps": [
                    {
                      "html": "<p>Append 0x5c22 (<code>\\\"</code>) to <var>encoded</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "is U+005C",
                  "steps": [
                    {
                      "html": "<p>Append 0x5c5c (<kbd>\\\\</kbd>) to <var>encoded</var>.</p>"
                    }
                  ]
                },
                {
                  "case": "otherwise",
                  "steps": [
                    {
                      "html": "<p>Append 0x5c75 (<code>\\u</code>) to <var>encoded</var>, followed by four, lower-case hex digits that, when interpreted as a base-16 number, represent that code point.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Append 0x22 (<code>\"</code>) to <var>encoded</var>.</p>"
        },
        {
          "html": "<p>The result of this function is the value of <var>encoded</var>.</p>"
        }
      ]
    },
    {
      "html": "If <var>crossOrigin</var> is true:",
      "rationale": "append",
      "steps": [
        {
          "html": "<p>Append 0x74727565 (<code>true</code>) to <var>expected</var>.</p>"
        }
      ]
    },
    {
      "html": "Otherwise, i.e. <var>crossOrigin</var> is false:",
      "rationale": "append",
      "steps": [
        {
          "html": "<p>Append 0x66616c7365 (<code>false</code>) to <var>expected</var>.</p>"
        }
      ]
    },
    {
      "html": "If the byte of <var>clientDataJSON</var> at the offset equal to the length of <var>expected</var>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "is 0x7d",
              "steps": [
                {
                  "html": "<p>The verification is successful.</p>"
                }
              ]
            },
            {
              "case": "is 0x2c",
              "steps": [
                {
                  "html": "<p>The verification is successful.</p>"
                }
              ]
            },
            {
              "case": "otherwise",
              "steps": [
                {
                  "html": "<p>The verification has failed.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "credential id/looking up",
      "href": "https://w3c.github.io/webauthn/#credential-id-looking-up",
      "html": "The result of <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"credential id\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"credential-id-looking-up\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">looking up</dfn> a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id②⑦\">credential id</a> <var>credentialId</var> in an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑧③\">authenticator</a> <var>authenticator</var> is the result of the following algorithm:",
      "rationale": "if",
      "steps": [
        {
          "html": "If <var>authenticator</var> can decrypt <var>credentialId</var> into a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥①\">public key credential source</a> <var>credSource</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>credSource</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id\">id</a> to <var>credentialId</var>.</p>"
            },
            {
              "html": "<p>Return <var>credSource</var>.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate②\">For each</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥②\">public key credential source</a> <var>credSource</var> of <var>authenticator</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-credentials-map\" id=\"ref-for-authenticator-credentials-map①\">credentials map</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>credSource</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id①\">id</a> is <var>credentialId</var>, return <var>credSource</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <code>null</code>.</p>"
        }
      ]
    },
    {
      "html": "When this operation is invoked, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑧⑥\">authenticator</a> MUST perform the following procedure:",
      "rationale": "check",
      "steps": [
        {
          "html": "<p>Check if all the supplied parameters are syntactically well-formed and of the correct length. If not, return an error code\nequivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror\">UnknownError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<p>Check if at least one of the specified combinations of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-publickeycredentialtype\" id=\"ref-for-enumdef-publickeycredentialtype⑨\">PublicKeyCredentialType</a></code> and cryptographic parameters in <var>credTypesAndPubKeyAlgs</var> is supported.\nIf not, return an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror②\">NotSupportedError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑦\">For each</a> <var>descriptor</var> of <var>excludeCredentialDescriptorList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id-looking-up\" id=\"ref-for-credential-id-looking-up\">looking up</a> <code><var>descriptor</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id⑦\">id</a></code></code> in this authenticator\nreturns non-null, and the returned <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item⑨\">item</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#rp-id\" id=\"ref-for-rp-id③④\">RP ID</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-type\" id=\"ref-for-public-key-credential-source-type①\">type</a> match <code><var>rpEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id①⓪\">id</a></code></code> and <code><var>excludeCredentialDescriptorList</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type\" id=\"ref-for-dom-publickeycredentialdescriptor-type④\">type</a></code></code> respectively,\nthen collect an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture①⑥\">authorization gesture</a> confirming <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent①⑥\">user\nconsent</a> for creating a new credential. The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture①⑦\">authorization gesture</a> MUST include a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#test-of-user-presence\" id=\"ref-for-test-of-user-presence⑧\">test\nof user presence</a>. If the user",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "confirms consent to create a new credential",
                      "steps": [
                        {
                          "html": "<p>return an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" and terminate the operation.</p>"
                        }
                      ]
                    },
                    {
                      "case": "does not consent to create a new credential",
                      "steps": [
                        {
                          "html": "<p>return an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①②\">NotAllowedError</a></code>\" and terminate the operation.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If <var>requireResidentKey</var> is <code>true</code> and the authenticator cannot store a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-discoverable-public-key-credential-source\" id=\"ref-for-client-side-discoverable-public-key-credential-source⑤\">client-side discoverable public key credential source</a>,\nreturn an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#constrainterror\" id=\"ref-for-constrainterror①\">ConstraintError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<p>If <var>requireUserVerification</var> is <code>true</code> and the authenticator cannot perform <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④①\">user verification</a>, return an error code\nequivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#constrainterror\" id=\"ref-for-constrainterror②\">ConstraintError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#op-makecred-step-user-consent\"></a> Collect an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture①⑨\">authorization gesture</a> confirming <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent①⑦\">user consent</a> for creating a new credential.\n    The prompt for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②⓪\">authorization gesture</a> is shown by the\n    authenticator if it has its own output capability, or by the user agent otherwise. The prompt SHOULD display <code><var>rpEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id①①\">id</a></code></code>, <code><var>rpEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialentity-name\" id=\"ref-for-dom-publickeycredentialentity-name①②\">name</a></code></code>, <code><var>userEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialentity-name\" id=\"ref-for-dom-publickeycredentialentity-name①③\">name</a></code></code> and <code><var>userEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialuserentity-displayname\" id=\"ref-for-dom-publickeycredentialuserentity-displayname①⓪\">displayName</a></code></code>, if possible. \n     <p>If <var>requireUserVerification</var> is <code>true</code>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②①\">authorization gesture</a> MUST include <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④②\">user verification</a>.</p>\n     <p>If <var>requireUserPresence</var> is <code>true</code>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②②\">authorization gesture</a> MUST include a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#test-of-user-presence\" id=\"ref-for-test-of-user-presence⑨\">test of user presence</a>.</p>\n     <p>If the user does not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent①⑧\">consent</a> or if <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④③\">user verification</a> fails, return an error code equivalent to\n    \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①③\">NotAllowedError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "Once the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②③\">authorization gesture</a> has been completed and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent①⑨\">user consent</a> has been obtained, generate a new credential object:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let (<var>publicKey</var>, <var>privateKey</var>) be a new pair of cryptographic keys using the combination of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-publickeycredentialtype\" id=\"ref-for-enumdef-publickeycredentialtype①⓪\">PublicKeyCredentialType</a></code> and cryptographic parameters represented by the first <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item①⓪\">item</a> in <var>credTypesAndPubKeyAlgs</var> that is supported by\nthis authenticator.</p>"
            },
            {
              "html": "<p>Let <var>userHandle</var> be <code><var>userEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialuserentity-id\" id=\"ref-for-dom-publickeycredentialuserentity-id⑧\">id</a></code></code>.</p>"
            },
            {
              "html": "<p>Let <var>credentialSource</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥③\">public key credential source</a> with the fields:</p>\n       <dl>\n        <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-type\" id=\"ref-for-public-key-credential-source-type②\">type</a>\n        </dt><dd data-md=\"\">\n         <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key\" id=\"ref-for-dom-publickeycredentialtype-public-key④\">public-key</a></code>.</p>\n        </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-privatekey\" id=\"ref-for-public-key-credential-source-privatekey\">privateKey</a>\n        </dt><dd data-md=\"\">\n         <p><var>privateKey</var></p>\n        </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid②\">rpId</a>\n        </dt><dd data-md=\"\">\n         <p><code><var>rpEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id①②\">id</a></code></code></p>\n        </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-userhandle\" id=\"ref-for-public-key-credential-source-userhandle①\">userHandle</a>\n        </dt><dd data-md=\"\">\n         <p><var>userHandle</var></p>\n        </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-otherui\" id=\"ref-for-public-key-credential-source-otherui②\">otherUI</a>\n        </dt><dd data-md=\"\">\n         <p>Any other information the authenticator chooses to include.</p>\n       </dd></dl>"
            },
            {
              "html": "If <var>requireResidentKey</var> is <code>true</code> or the authenticator chooses to create a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-discoverable-public-key-credential-source\" id=\"ref-for-client-side-discoverable-public-key-credential-source⑥\">client-side discoverable public key credential source</a>:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>credentialId</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id②⑧\">credential id</a>.</p>"
                },
                {
                  "html": "<p>Set <var>credentialSource</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id②\">id</a> to <var>credentialId</var>.</p>"
                },
                {
                  "html": "<p>Let <var>credentials</var> be this authenticator’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-credentials-map\" id=\"ref-for-authenticator-credentials-map②\">credentials map</a>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-set\" id=\"ref-for-map-set⑤\">Set</a> <var>credentials</var>[(<code><var>rpEntity</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrpentity-id\" id=\"ref-for-dom-publickeycredentialrpentity-id①③\">id</a></code></code>, <var>userHandle</var>)] to <var>credentialSource</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>credentialId</var> be the result of serializing and encrypting <var>credentialSource</var> so that only this authenticator can\ndecrypt it.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>If any error occurred while creating the new credential object, return an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror①\">UnknownError</a></code>\" and\nterminate the operation.</p>"
        },
        {
          "html": "<p>Let <var>processedExtensions</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-processing\" id=\"ref-for-authenticator-extension-processing\">authenticator extension processing</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate③\">for each</a> supported <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier⑦\">extension\nidentifier</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-input\" id=\"ref-for-authenticator-extension-input②\">authenticator extension input</a> in <var>extensions</var>.</p>"
        },
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨⓪\">authenticator</a>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "is a U2F device",
                  "steps": [
                    {
                      "html": "<p>let the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter①④\">signature counter</a> value for the new credential be zero. (U2F devices may support signature counters but do not return a counter when making a credential. See <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fido-u2f-message-formats\" title=\"FIDO U2F Raw Message Formats\">[FIDO-U2F-Message-Formats]</a>.)</p>"
                    }
                  ]
                },
                {
                  "case": "supports a global signature counter",
                  "steps": [
                    {
                      "html": "<p>Use the global <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter①⑥\">signature counter</a>'s actual value when generating <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data\" id=\"ref-for-authenticator-data③⑦\">authenticator data</a>.</p>"
                    }
                  ]
                },
                {
                  "case": "supports a per credential signature counter",
                  "steps": [
                    {
                      "html": "<p>allocate the counter, associate it with the new credential, and initialize the counter value as zero.</p>"
                    }
                  ]
                },
                {
                  "case": "does not support a signature counter",
                  "steps": [
                    {
                      "html": "<p>let the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter①⑨\">signature counter</a> value for the new credential be constant at zero.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>attestedCredentialData</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attested-credential-data\" id=\"ref-for-attested-credential-data⑧\">attested credential data</a> byte array including the <var>credentialId</var> and <var>publicKey</var>.</p>"
        },
        {
          "html": "<p>Let <var>attestationFormat</var> be the first supported <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format-identifier\" id=\"ref-for-attestation-statement-format-identifier\">attestation statement format identifier</a> from <var>attestationFormats</var>, taking into account <var>enterpriseAttestationPossible</var>.\nIf <var>attestationFormats</var> contains no supported value, then let <var>attestationFormat</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format-identifier\" id=\"ref-for-attestation-statement-format-identifier①\">attestation statement format identifier</a> most preferred by this authenticator.</p>"
        },
        {
          "html": "<p>Let <var>authenticatorData</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data-perform-the-following-steps-to-generate-an-authenticator-data-structure\" id=\"ref-for-authenticator-data-perform-the-following-steps-to-generate-an-authenticator-data-structure\">be the byte array</a> specified in <a href=\"https://w3c.github.io/webauthn/#sctn-authenticator-data\">§ 6.1 Authenticator Data</a>, including <var>attestedCredentialData</var> as the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata\" id=\"ref-for-authdata-attestedcredentialdata⑤\">attestedCredentialData</a></code> and <var>processedExtensions</var>, if any, as the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-extensions\" id=\"ref-for-authdata-extensions⑤\">extensions</a></code>.</p>"
        },
        {
          "html": "<p>Create an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-object\" id=\"ref-for-attestation-object⑧\">attestation object</a> for the new credential using the procedure specified in <a href=\"https://w3c.github.io/webauthn/#sctn-generating-an-attestation-object\">§ 6.5.4 Generating an Attestation Object</a>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format①\">attestation statement format</a> <var>attestationFormat</var>, and the values <var>authenticatorData</var> and <var>hash</var>, as well as <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-attestationconveyancepreference-enterprise\" id=\"ref-for-dom-attestationconveyancepreference-enterprise③\">taking into account</a></code> the value of <var>enterpriseAttestationPossible</var>. For more details on attestation, see <a href=\"https://w3c.github.io/webauthn/#sctn-attestation\">§ 6.5 Attestation</a>.</p>"
        }
      ]
    },
    {
      "html": "When this method is invoked, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨①\">authenticator</a> MUST perform the following procedure:",
      "rationale": "check",
      "steps": [
        {
          "html": "<p>Check if all the supplied parameters are syntactically well-formed and of the correct length. If not, return an error code\nequivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror②\">UnknownError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<p>Let <var>credentialOptions</var> be a new empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥\">set</a> of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥④\">public key credential sources</a>.</p>"
        },
        {
          "html": "If <var>allowCredentialDescriptorList</var> was supplied, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑧\">for each</a> <var>descriptor</var> of <var>allowCredentialDescriptorList</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>credSource</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id-looking-up\" id=\"ref-for-credential-id-looking-up①\">looking up</a> <code><var>descriptor</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id①⓪\">id</a></code></code> in this\nauthenticator.</p>"
            },
            {
              "html": "<p>If <var>credSource</var> is not <code>null</code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">append</a> it to <var>credentialOptions</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise (<var>allowCredentialDescriptorList</var> was not supplied), <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate④\">for each</a> <var>key</var> → <var>credSource</var> of this\nauthenticator’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-credentials-map\" id=\"ref-for-authenticator-credentials-map③\">credentials map</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑤\">append</a> <var>credSource</var> to <var>credentialOptions</var>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-remove\" id=\"ref-for-list-remove②⓪\">Remove</a> any items from <var>credentialOptions</var> whose <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid③\">rpId</a> is not equal to <var>rpId</var>.</p>"
        },
        {
          "html": "<p>If <var>credentialOptions</var> is now empty, return an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①④\">NotAllowedError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#authenticatorGetAssertion-prompt-select-credential\"></a> Prompt the user to select a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥⑤\">public key credential source</a> <var>selectedCredential</var> from <var>credentialOptions</var>.\n    Collect an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②④\">authorization gesture</a> confirming <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent②⓪\">user consent</a> for using <var>selectedCredential</var>.\n    The prompt for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②⑤\">authorization gesture</a> may be shown\n    by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨②\">authenticator</a> if it has its own output capability, or by the user agent otherwise. \n     <p>If <var>requireUserVerification</var> is <code>true</code>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②⑥\">authorization gesture</a> MUST include <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④④\">user verification</a>.</p>\n     <p>If <var>requireUserPresence</var> is <code>true</code>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authorization-gesture\" id=\"ref-for-authorization-gesture②⑦\">authorization gesture</a> MUST include a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#test-of-user-presence\" id=\"ref-for-test-of-user-presence①①\">test of user presence</a>.</p>\n     <p>If the user does not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent②①\">consent</a>, return an error code equivalent to\n    \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①⑤\">NotAllowedError</a></code>\" and terminate the operation.</p>"
        },
        {
          "html": "<p>Let <var>processedExtensions</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-processing\" id=\"ref-for-authenticator-extension-processing①\">authenticator extension processing</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑤\">for each</a> supported <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier⑨\">extension\nidentifier</a> → <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-input\" id=\"ref-for-authenticator-extension-input④\">authenticator extension input</a> in <var>extensions</var>.</p>"
        },
        {
          "html": "<p>Increment the credential associated <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter②⓪\">signature counter</a> or the global <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter②①\">signature counter</a> value, depending on\nwhich approach is implemented by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨③\">authenticator</a>, by some positive value.\nIf the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨④\">authenticator</a> does not implement a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter②②\">signature counter</a>, let the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter②③\">signature counter</a> value remain constant at\nzero.</p>"
        },
        {
          "html": "<p>Let <var>authenticatorData</var> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data-perform-the-following-steps-to-generate-an-authenticator-data-structure\" id=\"ref-for-authenticator-data-perform-the-following-steps-to-generate-an-authenticator-data-structure①\">be the byte array</a> specified in <a href=\"https://w3c.github.io/webauthn/#sctn-authenticator-data\">§ 6.1 Authenticator Data</a> including <var>processedExtensions</var>, if any, as\nthe <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-extensions\" id=\"ref-for-authdata-extensions⑥\">extensions</a></code> and excluding <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata\" id=\"ref-for-authdata-attestedcredentialdata⑥\">attestedCredentialData</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signature</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion-signature\" id=\"ref-for-assertion-signature⑧\">assertion signature</a> of the concatenation <code><var>authenticatorData</var> || <var>hash</var></code> using the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-privatekey\" id=\"ref-for-public-key-credential-source-privatekey①\">privateKey</a> of <var>selectedCredential</var> as shown in <a href=\"https://w3c.github.io/webauthn/#fig-signature\">Figure <span class=\"figure-num-following\"></span></a>, below. A simple,\nundelimited\nconcatenation is safe to use here because the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data\" id=\"ref-for-authenticator-data③⑧\">authenticator data</a> describes its own length. The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-hash-of-the-serialized-client-data\" id=\"ref-for-collectedclientdata-hash-of-the-serialized-client-data①①\">hash of the serialized\nclient data</a> (which potentially has a variable length) is always the last element.</p>\n     <figure id=\"fig-signature\">\n       <img src=\"https://w3c.github.io/webauthn/#images/fido-signature-formats-figure2.svg\"> \n      <figcaption>Generating an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion-signature\" id=\"ref-for-assertion-signature⑨\">assertion signature</a>.</figcaption>\n     </figure>"
        },
        {
          "html": "<p>If any error occurred while generating the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion-signature\" id=\"ref-for-assertion-signature①⓪\">assertion signature</a>, return an error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror③\">UnknownError</a></code>\" and\nterminate the operation.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#authenticatorGetAssertion-return-values\"></a> Return to the user agent: \n     <ul>\n      <li data-md=\"\">\n       <p><var>selectedCredential</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id③\">id</a>, if either a list of credentials\n(i.e., <var>allowCredentialDescriptorList</var>) of length 2 or greater was\nsupplied by the client, or no such list was supplied.</p>\n       \n      </li><li data-md=\"\">\n       <p><var>authenticatorData</var></p>\n      </li><li data-md=\"\">\n       <p><var>signature</var></p>\n      </li><li data-md=\"\">\n       <p><var>selectedCredential</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-userhandle\" id=\"ref-for-public-key-credential-source-userhandle②\">userHandle</a></p>\n       \n     </li></ul>"
        }
      ]
    },
    {
      "html": "When this operation is invoked, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨⑥\">authenticator</a> MUST perform the following procedure:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>collectedDiscoverableCredentialMetadata</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list⑥\">list</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item①①\">items</a> are <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"discoverablecredentialmetadata\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">DiscoverableCredentialMetadata</dfn> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct④\">structs</a> with the following <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①⓪\">items</a>:</p>\n     <dl>\n      <dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DiscoverableCredentialMetadata\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"discoverablecredentialmetadata-type\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">type</dfn>\n      </dt><dd data-md=\"\">\n       <p>A <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#enumdef-publickeycredentialtype\" id=\"ref-for-enumdef-publickeycredentialtype①①\">PublicKeyCredentialType</a></code>.</p>\n      </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DiscoverableCredentialMetadata\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"discoverablecredentialmetadata-id\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">id</dfn>\n      </dt><dd data-md=\"\">\n       <p>A <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id③⓪\">Credential ID</a>.</p>\n      </dd><dt data-md=\"\">rpId\n      </dt><dd data-md=\"\">\n       <p>A <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party-identifier\" id=\"ref-for-relying-party-identifier④\">Relying Party Identifier</a>.</p>\n      </dd><dt data-md=\"\">userHandle\n      </dt><dd data-md=\"\">\n       <p>A <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-handle\" id=\"ref-for-user-handle②③\">user handle</a>.</p>\n      </dd><dt data-md=\"\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"DiscoverableCredentialMetadata\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"discoverablecredentialmetadata-otherui\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">otherUI</dfn>\n      </dt><dd data-md=\"\">\n       <p>Other information used by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator①⑨⑦\">authenticator</a> to inform its UI.</p>\n     </dd></dl>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑥\">For each</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥⑥\">public key credential source</a> <var>credSource</var> of <var>authenticator</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-credentials-map\" id=\"ref-for-authenticator-credentials-map④\">credentials map</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>credSource</var> is not a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-discoverable-credential\" id=\"ref-for-client-side-discoverable-credential①④\">client-side discoverable credential</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑦\">continue</a>.</p>"
            },
            {
              "html": "<p>If <var>credSource</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid④\">rpId</a> is not <var>rpId</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑧\">continue</a>.</p>"
            },
            {
              "html": "<p>Let <var>discoveredCredentialMetadata</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#discoverablecredentialmetadata\" id=\"ref-for-discoverablecredentialmetadata②\">DiscoverableCredentialMetadata</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct\" id=\"ref-for-struct⑤\">struct</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#struct-item\" id=\"ref-for-struct-item①①\">items</a> are copies of <var>credSource</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-type\" id=\"ref-for-public-key-credential-source-type③\">type</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id④\">id</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid⑤\">rpId</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-userhandle\" id=\"ref-for-public-key-credential-source-userhandle④\">userHandle</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-otherui\" id=\"ref-for-public-key-credential-source-otherui③\">otherUI</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-append\" id=\"ref-for-list-append③\">Append</a> <var>discoveredCredentialMetadata</var> to <var>collectedDiscoverableCredentialMetadata</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>collectedDiscoverableCredentialMetadata</var>.</p>"
        }
      ]
    },
    {
      "html": "In addition to the above, truncating on byte boundaries alone causes a known issue that user agents should be aware of: if the authenticator is using <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fido-ctap\" title=\"Client to Authenticator Protocol (CTAP)\">[FIDO-CTAP]</a> then future messages from the authenticator may contain invalid CBOR since the value is typed as a CBOR string and thus is required to be valid UTF-8. Thus, when dealing with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⓪①\">authenticators</a>, user agents SHOULD:",
      "rationale": "ensure",
      "steps": [
        {
          "html": "<p>Ensure that any strings sent to authenticators are validly encoded.</p>"
        },
        {
          "html": "<p>Handle the case where strings have been truncated resulting in an invalid encoding. For example, any partial code point at the end may be dropped or replaced with <a href=\"http://unicode.org/cldr/utility/character.jsp?a=FFFD\">U+FFFD</a>.</p>"
        }
      ]
    },
    {
      "html": "the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②②②\">authenticator</a> MUST:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>attStmt</var> be the result of running <var>attestationFormat</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signing-procedure\" id=\"ref-for-signing-procedure①\">signing procedure</a> given <var>authData</var> and <var>hash</var>.</p>"
        },
        {
          "html": "<p>Let <var>fmt</var> be <var>attestationFormat</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format-identifier\" id=\"ref-for-attestation-statement-format-identifier③\">attestation statement format identifier</a></p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-object\" id=\"ref-for-attestation-object①⑤\">attestation object</a> as a CBOR map with the following syntax, filled in with variables initialized by this\nalgorithm:</p>\n<pre>attObj = {\n            authData: bytes,\n            $$attStmtType\n         }\n\nattStmtTemplate = (\n                      fmt: text,\n                      attStmt: { * tstr =&gt; any } ; Map is filled in by each concrete attStmtType\n                  )\n\n; Every attestation statement format must have the above fields\nattStmtTemplate .within $$attStmtType\n</pre>"
        }
      ]
    },
    {
      "html": "In order to perform a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#registration-ceremony\" id=\"ref-for-registration-ceremony①①\">registration ceremony</a>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②④④\">Relying Party</a> MUST proceed as follows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>options</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-publickeycredentialcreationoptions\" id=\"ref-for-dictdef-publickeycredentialcreationoptions①②\">PublicKeyCredentialCreationOptions</a></code> structure configured to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②④⑤\">Relying Party</a>'s needs for the ceremony.</p>"
        },
        {
          "html": "<p>Call <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create\" id=\"ref-for-dom-credentialscontainer-create②⑧\">navigator.credentials.create()</a></code> and pass <var>options</var> as the <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialcreationoptions-publickey\" id=\"ref-for-dom-credentialcreationoptions-publickey④\">publicKey</a></code></code> option.\nLet <var>credential</var> be the result of the successfully resolved promise.\nIf the promise is rejected, abort the ceremony with a user-visible error, or otherwise guide the user experience as\nmight be determinable from the context available in the rejected promise. For example if the promise is rejected with\nan error code equivalent to \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\", the user might be instructed to use a different <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②②⑤\">authenticator</a>.\nFor information on different error contexts and the circumstances leading to them, see <a href=\"https://w3c.github.io/webauthn/#sctn-op-make-cred\">§ 6.3.2 The authenticatorMakeCredential Operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-response\" id=\"ref-for-dom-publickeycredential-response⑤\">response</a></code></code>.\nIf <var>response</var> is not an instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorattestationresponse\" id=\"ref-for-authenticatorattestationresponse⑥\">AuthenticatorAttestationResponse</a></code>, abort the ceremony with a user-visible error.</p>"
        },
        {
          "html": "<p>Let <var>clientExtensionResults</var> be the result of calling <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-getclientextensionresults\" id=\"ref-for-dom-publickeycredential-getclientextensionresults②\">getClientExtensionResults()</a></code></code>.</p>"
        },
        {
          "html": "<p>Let <var>JSONtext</var> be the result of\nrunning <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode\">UTF-8 decode</a> on the value of <code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson⑦\">clientDataJSON</a></code></code>.</p>"
        },
        {
          "html": "<p>Let <var>C</var>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-data\" id=\"ref-for-client-data⑨\">client data</a> claimed as collected during the credential creation, be the result of running an\nimplementation-specific JSON parser on <var>JSONtext</var>.</p>"
        },
        {
          "html": "<p>Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-type\" id=\"ref-for-dom-collectedclientdata-type⑦\">type</a></code></code> is <code>webauthn.create</code>.</p>"
        },
        {
          "html": "<p>Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge\" id=\"ref-for-dom-collectedclientdata-challenge⑥\">challenge</a></code></code> equals\nthe base64url encoding of <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-challenge\" id=\"ref-for-dom-publickeycredentialcreationoptions-challenge②\">challenge</a></code></code>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#rp-op-registering-a-new-credential-step-origin\"></a> Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-origin\" id=\"ref-for-dom-collectedclientdata-origin⑦\">origin</a></code></code> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin①③\">origin</a> expected by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②④⑥\">Relying Party</a>.\n  See <a href=\"https://w3c.github.io/webauthn/#sctn-validating-origin\">§ 13.4.9 Validating the origin of a credential</a> for guidance."
        },
        {
          "html": "If <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin⑦\">topOrigin</a></code></code> is present:",
          "rationale": "verify",
          "steps": [
            {
              "html": "<p>Verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②④⑦\">Relying Party</a> expects that this credential would have been created within an iframe that is\nnot <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-credential-management/#same-origin-with-its-ancestors\" id=\"ref-for-same-origin-with-its-ancestors④\">same-origin with its ancestors</a>.</p>"
            },
            {
              "html": "<p>Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin⑧\">topOrigin</a></code></code> matches the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin①④\">origin</a> of a page\nthat the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②④⑧\">Relying Party</a> expects to be sub-framed within.\nSee <a href=\"https://w3c.github.io/webauthn/#sctn-validating-origin\">§ 13.4.9 Validating the origin of a credential</a> for guidance.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>hash</var> be the result of computing a hash over <code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson⑧\">clientDataJSON</a></code></code> using SHA-256.</p>"
        },
        {
          "html": "<p>Perform CBOR decoding on the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-attestationobject\" id=\"ref-for-dom-authenticatorattestationresponse-attestationobject⑦\">attestationObject</a></code> field of the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorattestationresponse\" id=\"ref-for-authenticatorattestationresponse⑦\">AuthenticatorAttestationResponse</a></code> structure to obtain the attestation statement format <var>fmt</var>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data\" id=\"ref-for-authenticator-data④⑤\">authenticator data</a> <var>authData</var>, and the attestation statement <var>attStmt</var>.</p>"
        },
        {
          "html": "<p>Verify that the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-rpidhash\" id=\"ref-for-authdata-rpidhash②\">rpIdHash</a></code> in <var>authData</var> is the SHA-256 hash of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#rp-id\" id=\"ref-for-rp-id③⑦\">RP ID</a> expected by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②④⑨\">Relying Party</a>.</p>"
        },
        {
          "html": "<p>Verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-up\" id=\"ref-for-authdata-flags-up③\">UP</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags③⑤\">flags</a></code> in <var>authData</var> is set, unless <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialcreationoptions-mediation\" id=\"ref-for-dom-credentialcreationoptions-mediation⑦\">mediation</a></code></code> is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialmediationrequirement-conditional\" id=\"ref-for-dom-credentialmediationrequirement-conditional②⑥\">conditional</a></code>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤⓪\">Relying Party</a> requires <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④⑤\">user verification</a> for this registration,\nverify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-uv\" id=\"ref-for-authdata-flags-uv①②\">UV</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags③⑥\">flags</a></code> in <var>authData</var> is set.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-be\" id=\"ref-for-authdata-flags-be⑥\">BE</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags③⑦\">flags</a></code> in <var>authData</var> is not set, verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-bs\" id=\"ref-for-authdata-flags-bs⑦\">BS</a> bit is not set.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤①\">Relying Party</a> uses the credential’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-eligibility\" id=\"ref-for-backup-eligibility③\">backup eligibility</a> to inform its user experience flows and/or policies, evaluate the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-be\" id=\"ref-for-authdata-flags-be⑦\">BE</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags③⑧\">flags</a></code> in <var>authData</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤②\">Relying Party</a> uses the credential’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-state\" id=\"ref-for-backup-state③\">backup state</a> to inform its user experience flows and/or policies, evaluate the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-bs\" id=\"ref-for-authdata-flags-bs⑧\">BS</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags③⑨\">flags</a></code> in <var>authData</var>.</p>"
        },
        {
          "html": "<p>Verify that the \"alg\" parameter in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialpublickey\" id=\"ref-for-authdata-attestedcredentialdata-credentialpublickey⑤\">credential public key</a> in <var>authData</var> matches the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialparameters-alg\" id=\"ref-for-dom-publickeycredentialparameters-alg②\">alg</a></code> attribute of one of the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item①②\">items</a> in <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-pubkeycredparams\" id=\"ref-for-dom-publickeycredentialcreationoptions-pubkeycredparams④\">pubKeyCredParams</a></code></code>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#reg-ceremony-verify-extension-outputs\"></a> Verify that the values of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output⑥\">client extension outputs</a> in <var>clientExtensionResults</var> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-output\" id=\"ref-for-authenticator-extension-output③\">authenticator extension\n    outputs</a> in the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-extensions\" id=\"ref-for-authdata-extensions⑦\">extensions</a></code> in <var>authData</var> are as expected, considering the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-input\" id=\"ref-for-client-extension-input⑤\">client\n    extension input</a> values that were given in <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-extensions\" id=\"ref-for-dom-publickeycredentialcreationoptions-extensions④\">extensions</a></code></code> and any specific policy of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤③\">Relying Party</a> regarding unsolicited extensions, i.e., those that were not specified as part of <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-extensions\" id=\"ref-for-dom-publickeycredentialcreationoptions-extensions⑤\">extensions</a></code></code>.\n    In the general case, the meaning of \"are as expected\" is specific to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤④\">Relying Party</a> and which extensions are in use."
        },
        {
          "html": "<p>Determine the attestation statement format by performing a USASCII case-sensitive match on <var>fmt</var> against the set of\nsupported WebAuthn Attestation Statement Format Identifier values.\nAn up-to-date list of registered WebAuthn Attestation Statement Format Identifier values\nis maintained in the\nIANA \"WebAuthn Attestation Statement Format Identifiers\" registry <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-iana-webauthn-registries\" title=\"Web Authentication (WebAuthn) registries\">[IANA-WebAuthn-Registries]</a> established by <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-rfc8809\" title=\"Registries for Web Authentication (WebAuthn)\">[RFC8809]</a>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#reg-ceremony-verify-attestation\"></a> Verify that <var>attStmt</var> is a correct <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement③⑦\">attestation statement</a>, conveying a valid <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-signature\" id=\"ref-for-attestation-signature⑨\">attestation signature</a>, by using the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format①⑤\">attestation statement format</a> <var>fmt</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure③\">verification procedure</a> given <var>attStmt</var>, <var>authData</var> and <var>hash</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#reg-ceremony-attestation-trust-anchors\"></a> If validation is successful, obtain a list of acceptable trust anchors (i.e. attestation root certificates)\n    for that attestation type and attestation statement format <var>fmt</var>, from a trusted source or from policy. For\n    example, the FIDO Metadata Service <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fidometadataservice\" title=\"FIDO Metadata Service\">[FIDOMetadataService]</a> provides one way to obtain such information, using the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid④\">aaguid</a></code> in the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata\" id=\"ref-for-authdata-attestedcredentialdata⑦\">attestedCredentialData</a></code> in <var>authData</var>."
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#reg-ceremony-assess-trust\"></a> Assess the attestation trustworthiness using the outputs of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure⑤\">verification procedure</a> in <a href=\"https://w3c.github.io/webauthn/#reg-ceremony-verify-attestation\">step 22</a>, as follows: \n     <ul>\n      <li data-md=\"\">\n       <p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#none\" id=\"ref-for-none④\">no attestation</a> was provided, verify that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#none\" id=\"ref-for-none⑤\">None</a> attestation is acceptable under <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤⑧\">Relying Party</a> policy.</p>\n      </li><li data-md=\"\">\n       <p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self-attestation\" id=\"ref-for-self-attestation①③\">self attestation</a> was used, verify that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self-attestation\" id=\"ref-for-self-attestation①④\">self attestation</a> is acceptable under <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑤⑨\">Relying Party</a> policy.</p>\n      </li><li data-md=\"\">\n       <p>Otherwise, use the X.509 certificates returned as the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-trust-path\" id=\"ref-for-attestation-trust-path②\">attestation trust path</a> from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure⑥\">verification procedure</a> to verify that the attestation public key either correctly chains up to an acceptable root certificate, or is itself an acceptable certificate\n(i.e., it and the root certificate obtained in <a href=\"https://w3c.github.io/webauthn/#reg-ceremony-attestation-trust-anchors\">step 23</a> may be the same).</p>\n     </li></ul>"
        },
        {
          "html": "<p>Verify that the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialid\" id=\"ref-for-authdata-attestedcredentialdata-credentialid④\">credentialId</a></code> is ≤ 1023 bytes. Credential IDs larger than this many bytes SHOULD cause the RP to fail this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#registration-ceremony\" id=\"ref-for-registration-ceremony①②\">registration ceremony</a>.</p>"
        },
        {
          "html": "<p>Verify that the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialid\" id=\"ref-for-authdata-attestedcredentialdata-credentialid⑤\">credentialId</a></code> is not yet registered for any user. If the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialid\" id=\"ref-for-authdata-attestedcredentialdata-credentialid⑥\">credentialId</a></code> is already known then the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑥⓪\">Relying Party</a> SHOULD fail this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#registration-ceremony\" id=\"ref-for-registration-ceremony①③\">registration ceremony</a>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#reg-ceremony-store-credential-record\"></a> If the attestation statement <var>attStmt</var> verified successfully and is found to be trustworthy,\n    then create and store a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①①\">credential record</a> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-account\" id=\"ref-for-user-account③②\">user account</a> that was denoted in <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-user\" id=\"ref-for-dom-publickeycredentialcreationoptions-user⑥\">user</a></code></code>,\n    with the following contents: \n     <dl>\n      <dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-type\" id=\"ref-for-abstract-opdef-credential-record-type②\">type</a>\n      </dt><dd data-md=\"\">\n       <p><code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credential-type\" id=\"ref-for-dom-credential-type②\">type</a></code></code>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-id\" id=\"ref-for-abstract-opdef-credential-record-id②\">id</a>\n      </dt><dd data-md=\"\">\n       <p><code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credential-id\" id=\"ref-for-dom-credential-id①\">id</a></code></code> or <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-rawid\" id=\"ref-for-dom-publickeycredential-rawid②\">rawId</a></code></code>,\nwhichever format is preferred by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑥③\">Relying Party</a>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-publickey\" id=\"ref-for-abstract-opdef-credential-record-publickey\">publicKey</a>\n      </dt><dd data-md=\"\">\n       <p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-public-key\" id=\"ref-for-credential-public-key③①\">credential public key</a> in <var>authData</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-signcount\" id=\"ref-for-abstract-opdef-credential-record-signcount\">signCount</a>\n      </dt><dd data-md=\"\">\n       <p><code><var>authData</var>.<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-signcount\" id=\"ref-for-authdata-signcount⑤\">signCount</a></code>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-uvinitialized\" id=\"ref-for-abstract-opdef-credential-record-uvinitialized②\">uvInitialized</a>\n      </dt><dd data-md=\"\">\n       <p>The value of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-uv\" id=\"ref-for-authdata-flags-uv①③\">UV</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④⓪\">flag</a> in <var>authData</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-transports\" id=\"ref-for-abstract-opdef-credential-record-transports②\">transports</a>\n      </dt><dd data-md=\"\">\n       <p>The value returned from <code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-gettransports\" id=\"ref-for-dom-authenticatorattestationresponse-gettransports⑥\">getTransports()</a></code></code>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupeligible\" id=\"ref-for-abstract-opdef-credential-record-backupeligible\">backupEligible</a>\n      </dt><dd data-md=\"\">\n       <p>The value of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-be\" id=\"ref-for-authdata-flags-be⑧\">BE</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④①\">flag</a> in <var>authData</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupstate\" id=\"ref-for-abstract-opdef-credential-record-backupstate\">backupState</a>\n      </dt><dd data-md=\"\">\n       <p>The value of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-bs\" id=\"ref-for-authdata-flags-bs⑨\">BS</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④②\">flag</a> in <var>authData</var>.</p>\n     </dd></dl>\n     <p>The new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①②\">credential record</a> MAY also include the following OPTIONAL contents:</p>\n     <dl>\n      <dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-attestationobject\" id=\"ref-for-abstract-opdef-credential-record-attestationobject①\">attestationObject</a>\n      </dt><dd data-md=\"\">\n       <p><code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorattestationresponse-attestationobject\" id=\"ref-for-dom-authenticatorattestationresponse-attestationobject⑧\">attestationObject</a></code></code>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-attestationclientdatajson\" id=\"ref-for-abstract-opdef-credential-record-attestationclientdatajson\">attestationClientDataJSON</a>\n      </dt><dd data-md=\"\">\n       <p><code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson⑨\">clientDataJSON</a></code></code>.</p>\n     </dd></dl>"
        },
        {
          "html": "<p>If the attestation statement <var>attStmt</var> successfully verified but is not trustworthy per <a href=\"https://w3c.github.io/webauthn/#reg-ceremony-assess-trust\">step 24</a> above,\nthe <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑥④\">Relying Party</a> SHOULD fail the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#registration-ceremony\" id=\"ref-for-registration-ceremony①④\">registration ceremony</a>.</p>"
        }
      ]
    },
    {
      "html": "In order to perform an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authentication-ceremony\" id=\"ref-for-authentication-ceremony②⑥\">authentication ceremony</a>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦⓪\">Relying Party</a> MUST proceed as follows:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>options</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dictdef-publickeycredentialrequestoptions\" id=\"ref-for-dictdef-publickeycredentialrequestoptions①②\">PublicKeyCredentialRequestOptions</a></code> structure configured to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦①\">Relying Party</a>'s needs for the ceremony.</p>"
        },
        {
          "html": "<p>Call <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get\" id=\"ref-for-dom-credentialscontainer-get③①\">navigator.credentials.get()</a></code> and pass <var>options</var> as the <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey\" id=\"ref-for-dom-credentialrequestoptions-publickey④\">publicKey</a></code></code> option.\nLet <var>credential</var> be the result of the successfully resolved promise.\nIf the promise is rejected, abort the ceremony with a user-visible error, or otherwise guide the user experience as might\nbe determinable from the context available in the rejected promise. For information on different error contexts and the\ncircumstances leading to them, see <a href=\"https://w3c.github.io/webauthn/#sctn-op-get-assertion\">§ 6.3.3 The authenticatorGetAssertion Operation</a>.</p>"
        },
        {
          "html": "<p>Let <var>response</var> be <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-response\" id=\"ref-for-dom-publickeycredential-response⑥\">response</a></code></code>.\nIf <var>response</var> is not an instance of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#authenticatorassertionresponse\" id=\"ref-for-authenticatorassertionresponse⑦\">AuthenticatorAssertionResponse</a></code>, abort the ceremony with a user-visible error.</p>"
        },
        {
          "html": "<p>Let <var>clientExtensionResults</var> be the result of calling <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-getclientextensionresults\" id=\"ref-for-dom-publickeycredential-getclientextensionresults③\">getClientExtensionResults()</a></code></code>.</p>"
        },
        {
          "html": "<p>If <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials①⑨\">allowCredentials</a></code></code> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①③\">is not empty</a>,\nverify that <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credential-id\" id=\"ref-for-dom-credential-id②\">id</a></code></code> identifies one of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential\" id=\"ref-for-public-key-credential⑤④\">public key credentials</a> listed in <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials②⓪\">allowCredentials</a></code></code>.</p>"
        },
        {
          "html": "Identify the user being authenticated and let <var>credentialRecord</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①③\">credential record</a> for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-credential-management/#concept-credential\" id=\"ref-for-concept-credential①⑧\">credential</a>:",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "If the user was identified before the authentication ceremony was initiated, e.g., via a username or cookie,",
                  "steps": [
                    {
                      "html": "<p>verify that the identified <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-account\" id=\"ref-for-user-account③③\">user account</a> contains a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①④\">credential record</a> whose <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-id\" id=\"ref-for-abstract-opdef-credential-record-id③\">id</a> equals <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-rawid\" id=\"ref-for-dom-publickeycredential-rawid③\">rawId</a></code></code>.\nLet <var>credentialRecord</var> be that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①⑤\">credential record</a>.\nIf <code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-userhandle\" id=\"ref-for-dom-authenticatorassertionresponse-userhandle⑥\">userHandle</a></code></code> is present,\nverify that it equals the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-handle\" id=\"ref-for-user-handle②④\">user handle</a> of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-account\" id=\"ref-for-user-account③④\">user account</a>.</p>"
                    }
                  ]
                },
                {
                  "case": "If the user was not identified before the authentication ceremony was initiated,",
                  "steps": [
                    {
                      "html": "<p>verify that <code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-userhandle\" id=\"ref-for-dom-authenticatorassertionresponse-userhandle⑦\">userHandle</a></code></code> is present.\nVerify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-account\" id=\"ref-for-user-account③⑤\">user account</a> identified by <code><var>response</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-userhandle\" id=\"ref-for-dom-authenticatorassertionresponse-userhandle⑧\">userHandle</a></code></code> contains a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①⑥\">credential record</a> whose <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-id\" id=\"ref-for-abstract-opdef-credential-record-id④\">id</a> equals <code><var>credential</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-rawid\" id=\"ref-for-dom-publickeycredential-rawid④\">rawId</a></code></code>.\nLet <var>credentialRecord</var> be that <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record①⑦\">credential record</a>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>cData</var>, <var>authData</var> and <var>sig</var> denote the value of <var>response</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorresponse-clientdatajson\" id=\"ref-for-dom-authenticatorresponse-clientdatajson①⓪\">clientDataJSON</a></code>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-authenticatordata\" id=\"ref-for-dom-authenticatorassertionresponse-authenticatordata②\">authenticatorData</a></code>, and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticatorassertionresponse-signature\" id=\"ref-for-dom-authenticatorassertionresponse-signature②\">signature</a></code> respectively.</p>"
        },
        {
          "html": "<p>Let <var>JSONtext</var> be the result of running <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode③\">UTF-8 decode</a> on the value of <var>cData</var>.</p>"
        },
        {
          "html": "<p>Let <var>C</var>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-data\" id=\"ref-for-client-data①⓪\">client data</a> claimed as used for the signature, be the result of running an implementation-specific\nJSON parser on <var>JSONtext</var>.</p>"
        },
        {
          "html": "<p>Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-type\" id=\"ref-for-dom-collectedclientdata-type⑧\">type</a></code></code> is the string <code>webauthn.get</code>.</p>"
        },
        {
          "html": "<p>Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge\" id=\"ref-for-dom-collectedclientdata-challenge⑦\">challenge</a></code></code> equals\nthe base64url encoding of <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge\" id=\"ref-for-dom-publickeycredentialrequestoptions-challenge③\">challenge</a></code></code>.</p>"
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#rp-op-verifying-assertion-step-origin\"></a> Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-origin\" id=\"ref-for-dom-collectedclientdata-origin⑧\">origin</a></code></code> is an <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin①⑤\">origin</a> expected by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦②\">Relying Party</a>.\n  See <a href=\"https://w3c.github.io/webauthn/#sctn-validating-origin\">§ 13.4.9 Validating the origin of a credential</a> for guidance."
        },
        {
          "html": "If <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin⑨\">topOrigin</a></code></code> is present:",
          "rationale": "verify",
          "steps": [
            {
              "html": "<p>Verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦③\">Relying Party</a> expects this credential to be used within an iframe that is not <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webappsec-credential-management/#same-origin-with-its-ancestors\" id=\"ref-for-same-origin-with-its-ancestors⑤\">same-origin with its ancestors</a>.</p>"
            },
            {
              "html": "<p>Verify that the value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-collectedclientdata-toporigin\" id=\"ref-for-dom-collectedclientdata-toporigin①⓪\">topOrigin</a></code></code> matches the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin①⑥\">origin</a> of a page\nthat the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦④\">Relying Party</a> expects to be sub-framed within.\nSee <a href=\"https://w3c.github.io/webauthn/#sctn-validating-origin\">§ 13.4.9 Validating the origin of a credential</a> for guidance.</p>"
            }
          ]
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#rp-op-verifying-assertion-step-rpid-hash\"></a> Verify that the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-rpidhash\" id=\"ref-for-authdata-rpidhash③\">rpIdHash</a></code> in <var>authData</var> is the SHA-256 hash of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#rp-id\" id=\"ref-for-rp-id③⑧\">RP ID</a> expected by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦⑤\">Relying Party</a>."
        },
        {
          "html": "<p>Verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-up\" id=\"ref-for-authdata-flags-up④\">UP</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④③\">flags</a></code> in <var>authData</var> is set.</p>"
        },
        {
          "html": "<p>Determine whether <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④⑥\">user verification</a> is required for this assertion. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④⑦\">User verification</a> SHOULD be required if, and only if, <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification\" id=\"ref-for-dom-publickeycredentialrequestoptions-userverification④\">userVerification</a></code></code> is set to <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-userverificationrequirement-required\" id=\"ref-for-dom-userverificationrequirement-required⑥\">required</a></code>.</p>\n     <p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④⑧\">user verification</a> was determined to be required,\nverify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-uv\" id=\"ref-for-authdata-flags-uv①④\">UV</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④④\">flags</a></code> in <var>authData</var> is set.\nOtherwise, ignore the value of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-uv\" id=\"ref-for-authdata-flags-uv①⑤\">UV</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④⑤\">flag</a>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-be\" id=\"ref-for-authdata-flags-be⑨\">BE</a> bit of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④⑥\">flags</a></code> in <var>authData</var> is not set, verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-bs\" id=\"ref-for-authdata-flags-bs①⓪\">BS</a> bit is not set.</p>"
        },
        {
          "html": "If the credential <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-state\" id=\"ref-for-backup-state④\">backup state</a> is used as part of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦⑥\">Relying Party</a> business logic or policy,\nlet <var>currentBe</var> and <var>currentBs</var> be the values of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-be\" id=\"ref-for-authdata-flags-be①⓪\">BE</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-bs\" id=\"ref-for-authdata-flags-bs①①\">BS</a> bits, respectively,\nof the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④⑦\">flags</a></code> in <var>authData</var>.\nCompare <var>currentBe</var> and <var>currentBs</var> with <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupeligible\" id=\"ref-for-abstract-opdef-credential-record-backupeligible①\">backupEligible</a></code> and <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupstate\" id=\"ref-for-abstract-opdef-credential-record-backupstate①\">backupState</a></code>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupeligible\" id=\"ref-for-abstract-opdef-credential-record-backupeligible②\">backupEligible</a></code> is set, verify that <var>currentBe</var> is set.</p>"
            },
            {
              "html": "<p>If <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupeligible\" id=\"ref-for-abstract-opdef-credential-record-backupeligible③\">backupEligible</a></code> is not set, verify that <var>currentBe</var> is not set.</p>"
            },
            {
              "html": "<p>Apply <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦⑦\">Relying Party</a> policy, if any.</p>"
            }
          ]
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#authn-ceremony-verify-extension-outputs\"></a> Verify that the values of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output⑧\">client extension outputs</a> in <var>clientExtensionResults</var> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-output\" id=\"ref-for-authenticator-extension-output⑤\">authenticator extension\n    outputs</a> in the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-extensions\" id=\"ref-for-authdata-extensions⑧\">extensions</a></code> in <var>authData</var> are as expected, considering the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-input\" id=\"ref-for-client-extension-input⑥\">client\n    extension input</a> values that were given in <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions\" id=\"ref-for-dom-publickeycredentialrequestoptions-extensions④\">extensions</a></code></code> and any specific policy of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑦⑨\">Relying Party</a> regarding unsolicited extensions, i.e., those that were not specified as part of <code><var>options</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions\" id=\"ref-for-dom-publickeycredentialrequestoptions-extensions⑤\">extensions</a></code></code>.\n    In the general case, the meaning of \"are as expected\" is specific to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑧⓪\">Relying Party</a> and which extensions are in use."
        },
        {
          "html": "<p>Let <var>hash</var> be the result of computing a hash over the <var>cData</var> using SHA-256.</p>"
        },
        {
          "html": "<p>Using <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-publickey\" id=\"ref-for-abstract-opdef-credential-record-publickey①\">publicKey</a></code>,\nverify that <var>sig</var> is a valid signature over the binary concatenation of <var>authData</var> and <var>hash</var>.</p>"
        },
        {
          "html": "If <var>authData</var>.<code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-signcount\" id=\"ref-for-authdata-signcount⑦\">signCount</a></code> is",
          "rationale": ".switch",
          "steps": [
            {
              "operation": "switch",
              "steps": [
                {
                  "case": "greater than credentialRecord.signCount:",
                  "steps": [
                    {
                      "html": "The signature counter is valid."
                    }
                  ]
                },
                {
                  "case": "less than or equal to credentialRecord.signCount:",
                  "steps": [
                    {
                      "html": "This is a signal that\n          the authenticator may be cloned, i.e. at least\n          two copies of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-private-key\" id=\"ref-for-credential-private-key①⑥\">credential private key</a> may exist and are\n          being used in parallel. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑧④\">Relying Parties</a> should incorporate this information\n          into their risk scoring.\n          Whether the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑧⑤\">Relying Party</a> updates <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-signcount\" id=\"ref-for-abstract-opdef-credential-record-signcount④\">signCount</a></code> below in this case, or not, or fails the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authentication-ceremony\" id=\"ref-for-authentication-ceremony②⑨\">authentication ceremony</a> or not, is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑧⑥\">Relying Party</a>-specific."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<a class=\"self-link\" href=\"https://w3c.github.io/webauthn/#authn-ceremony-update-credential-record\"></a> Update <var>credentialRecord</var> with new state values:",
          "rationale": "update",
          "steps": [
            {
              "html": "<p>Update <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-signcount\" id=\"ref-for-abstract-opdef-credential-record-signcount⑤\">signCount</a></code> to the value of <var>authData</var>.<code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-signcount\" id=\"ref-for-authdata-signcount⑧\">signCount</a></code>.</p>"
            },
            {
              "html": "<p>Update <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-backupstate\" id=\"ref-for-abstract-opdef-credential-record-backupstate②\">backupState</a></code> to the value of <var>currentBs</var>.</p>"
            },
            {
              "html": "<p>If <code><var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-uvinitialized\" id=\"ref-for-abstract-opdef-credential-record-uvinitialized③\">uvInitialized</a></code> is <code>false</code>,\nupdate it to the value of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags-uv\" id=\"ref-for-authdata-flags-uv①⑥\">UV</a> bit in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-flags\" id=\"ref-for-authdata-flags④⑨\">flags</a> in <var>authData</var>.\nThis change SHOULD require authorization by an additional <a data-link-type=\"dfn\" href=\"https://pages.nist.gov/800-63-3/sp800-63-3.html#af\" id=\"ref-for-af②④\">authentication factor</a> equivalent to WebAuthn <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-verification\" id=\"ref-for-user-verification④⑨\">user verification</a>;\nif not authorized, skip this step.</p>"
            }
          ]
        },
        {
          "html": "<p>If all the above steps are successful, continue with the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authentication-ceremony\" id=\"ref-for-authentication-ceremony③①\">authentication ceremony</a> as appropriate. Otherwise, fail the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authentication-ceremony\" id=\"ref-for-authentication-ceremony③②\">authentication ceremony</a>.</p>"
        }
      ]
    },
    {
      "html": "The signing procedure for this attestation statement format is\nsimilar to <a href=\"https://w3c.github.io/webauthn/#fig-signature\">the procedure for generating assertion signatures</a>.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>authenticatorData</var> denote the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-data-for-the-attestation\" id=\"ref-for-authenticator-data-for-the-attestation\">authenticator data for the attestation</a>,\nand let <var>clientDataHash</var> denote the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-hash-of-the-serialized-client-data\" id=\"ref-for-collectedclientdata-hash-of-the-serialized-client-data①⑤\">hash of the serialized client data</a>.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#basic\" id=\"ref-for-basic②\">Basic</a> or <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attca\" id=\"ref-for-attca②\">AttCA</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation\" id=\"ref-for-attestation②③\">attestation</a> is in use, the authenticator produces the <var>sig</var> by concatenating <var>authenticatorData</var> and <var>clientDataHash</var>, and signing the result using an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-private-key\" id=\"ref-for-attestation-private-key③\">attestation private key</a> selected through an authenticator-specific\nmechanism. It sets <var>x5c</var> to <var>attestnCert</var> followed by the related certificate chain (if any). It sets <var>alg</var> to the algorithm of the\nattestation private key.</p>"
        },
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self-attestation\" id=\"ref-for-self-attestation①⑦\">self attestation</a> is in use, the authenticator produces <var>sig</var> by concatenating <var>authenticatorData</var> and <var>clientDataHash</var>,\nand signing the result using the credential private key. It sets <var>alg</var> to the algorithm of the credential private key and\nomits the other fields.</p>"
        }
      ]
    },
    {
      "html": "Given the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure-inputs\" id=\"ref-for-verification-procedure-inputs\">verification procedure inputs</a> <var>attStmt</var>, <var>authenticatorData</var> and <var>clientDataHash</var>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure⑦\">verification procedure</a> is\nas follows:",
      "rationale": "verify",
      "steps": [
        {
          "html": "<p>Verify that <var>attStmt</var> is valid CBOR conforming to the syntax defined above and perform CBOR decoding on it to extract\nthe contained fields.</p>"
        },
        {
          "html": "<p>If <var>x5c</var> is present:</p>\n       <ul>\n        <li data-md=\"\">\n         <p>Verify that <var>sig</var> is a valid signature over the concatenation of <var>authenticatorData</var> and <var>clientDataHash</var> using the\nattestation public key in <var>attestnCert</var> with the algorithm specified in <var>alg</var>.</p>\n        </li><li data-md=\"\">\n         <p>Verify that <var>attestnCert</var> meets the requirements in <a href=\"https://w3c.github.io/webauthn/#sctn-packed-attestation-cert-requirements\">§ 8.2.1 Packed Attestation Statement Certificate Requirements</a>.</p>\n        </li><li data-md=\"\">\n         <p>If <var>attestnCert</var> contains an extension with OID <code>1.3.6.1.4.1.45724.1.1.4</code> (<code>id-fido-gen-ce-aaguid</code>) verify that the\nvalue of this extension matches the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-aaguid\" id=\"ref-for-authdata-attestedcredentialdata-aaguid⑤\">aaguid</a></code> in <var>authenticatorData</var>.</p>\n        </li><li data-md=\"\">\n         <p>Optionally, inspect <var>x5c</var> and consult externally provided knowledge to determine whether <var>attStmt</var> conveys a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#basic\" id=\"ref-for-basic③\">Basic</a> or <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attca\" id=\"ref-for-attca③\">AttCA</a> attestation.</p>\n        </li><li data-md=\"\">\n         <p>If successful, return implementation-specific values representing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-type\" id=\"ref-for-attestation-type①⑦\">attestation type</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#basic\" id=\"ref-for-basic④\">Basic</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attca\" id=\"ref-for-attca④\">AttCA</a> or\nuncertainty, and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-trust-path\" id=\"ref-for-attestation-trust-path③\">attestation trust path</a> <var>x5c</var>.</p>\n       </li></ul>"
        },
        {
          "html": "<p>If <var>x5c</var> is not present, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self-attestation\" id=\"ref-for-self-attestation①⑧\">self attestation</a> is in use.</p>\n       <ul>\n        <li data-md=\"\">\n         <p>Validate that <var>alg</var> matches the algorithm of the <code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialpublickey\" id=\"ref-for-authdata-attestedcredentialdata-credentialpublickey⑥\">credentialPublicKey</a></code> in <var>authenticatorData</var>.</p>\n        </li><li data-md=\"\">\n         <p>Verify that <var>sig</var> is a valid signature over the concatenation of <var>authenticatorData</var> and <var>clientDataHash</var> using the\ncredential public key with <var>alg</var>.</p>\n        </li><li data-md=\"\">\n         <p>If successful, return implementation-specific values representing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-type\" id=\"ref-for-attestation-type①⑧\">attestation type</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#self\" id=\"ref-for-self①\">Self</a> and an empty <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-trust-path\" id=\"ref-for-attestation-trust-path④\">attestation trust path</a>.</p>\n       </li></ul>"
        }
      ]
    },
    {
      "html": "Given the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure-inputs\" id=\"ref-for-verification-procedure-inputs④\">verification procedure inputs</a> <var>attStmt</var>, <var>authenticatorData</var> and <var>clientDataHash</var>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure①①\">verification procedure</a> is\nas follows:",
      "rationale": "verify",
      "steps": [
        {
          "html": "<p>Verify that <var>attStmt</var> is valid CBOR conforming to the syntax defined above and perform CBOR decoding on it to extract the\ncontained fields.</p>"
        },
        {
          "html": "<p>Check that <var>x5c</var> has exactly one element and let <var>attCert</var> be that element. Let <var>certificate public key</var> be the public key\nconveyed by <var>attCert</var>. If <var>certificate public key</var> is not an Elliptic Curve (EC) public\nkey over the P-256 curve, terminate this algorithm and return an appropriate error.</p>"
        },
        {
          "html": "<p>Extract the claimed <var>rpIdHash</var> from <var>authenticatorData</var>, and the claimed <var>credentialId</var> and <var>credentialPublicKey</var> from <var>authenticatorData</var>.<code><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata\" id=\"ref-for-authdata-attestedcredentialdata①①\">attestedCredentialData</a></code>.</p>"
        },
        {
          "html": "<p>Convert the COSE_KEY formatted <var>credentialPublicKey</var> (see <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc9052#section-7\" id=\"ref-for-section-7③\">Section 7</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-rfc9052\" title=\"CBOR Object Signing and Encryption (COSE): Structures and Process\">[RFC9052]</a>) to Raw ANSI X9.62 public key\nformat (see ALG_KEY_ECC_X962_RAW in <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/common-specs/fido-registry-v2.1-ps-20191217.html#public-key-representation-formats\" id=\"ref-for-public-key-representation-formats\">Section 3.6.2 Public Key Representation Formats</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fido-registry\" title=\"FIDO Registry of Predefined Values\">[FIDO-Registry]</a>).</p>\n       <ul>\n        <li data-md=\"\">\n         <p>Let <var>x</var> be the value corresponding to the \"-2\" key (representing x coordinate) in <var>credentialPublicKey</var>, and confirm its\nsize to be of 32 bytes.\nIf size differs or \"-2\" key is not found, terminate this algorithm and return an appropriate error.</p>\n        </li><li data-md=\"\">\n         <p>Let <var>y</var> be the value corresponding to the \"-3\" key (representing y coordinate) in <var>credentialPublicKey</var>, and confirm its\nsize to be of 32 bytes.\nIf size differs or \"-3\" key is not found, terminate this algorithm and return an appropriate error.</p>\n        </li><li data-md=\"\">\n         <p>Let <var>publicKeyU2F</var> be the concatenation <code>0x04 || <var>x</var> || <var>y</var></code>.</p>\n         \n       </li></ul>"
        },
        {
          "html": "<p>Let <var>verificationData</var> be the concatenation of (0x00 || <var>rpIdHash</var> || <var>clientDataHash</var> || <var>credentialId</var> || <var>publicKeyU2F</var>) (see <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-u2f-v1.1-id-20160915/fido-u2f-raw-message-formats-v1.1-id-20160915.html#registration-response-message-success\" id=\"ref-for-registration-response-message-success①\">Section 4.3</a> of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fido-u2f-message-formats\" title=\"FIDO U2F Raw Message Formats\">[FIDO-U2F-Message-Formats]</a>).</p>"
        },
        {
          "html": "<p>Verify the <var>sig</var> using <var>verificationData</var> and the <var>certificate public key</var> per section 4.1.4 of <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-sec1\" title=\"SEC1: Elliptic Curve Cryptography, Version 2.0\">[SEC1]</a> with SHA-256 as the hash function used in step two.</p>"
        },
        {
          "html": "<p>Optionally, inspect <var>x5c</var> and consult externally provided knowledge to determine whether <var>attStmt</var> conveys a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#basic\" id=\"ref-for-basic①⓪\">Basic</a> or <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attca\" id=\"ref-for-attca⑧\">AttCA</a> attestation.</p>"
        },
        {
          "html": "<p>If successful, return implementation-specific values representing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-type\" id=\"ref-for-attestation-type②②\">attestation type</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#basic\" id=\"ref-for-basic①①\">Basic</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attca\" id=\"ref-for-attca⑨\">AttCA</a> or uncertainty,\nand <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-trust-path\" id=\"ref-for-attestation-trust-path⑧\">attestation trust path</a> <var>x5c</var>.</p>"
        }
      ]
    },
    {
      "html": "",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>authenticatorData</var> denote the authenticator data for the attestation, and let <var>clientDataHash</var> denote the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#collectedclientdata-hash-of-the-serialized-client-data\" id=\"ref-for-collectedclientdata-hash-of-the-serialized-client-data②⓪\">hash of the serialized client data</a>.</p>"
        },
        {
          "html": "<p>Concatenate <var>authenticatorData</var> and <var>clientDataHash</var> to form <var>nonceToHash</var>.</p>"
        },
        {
          "html": "<p>Perform SHA-256 hash of <var>nonceToHash</var> to produce <var>nonce</var>.</p>"
        },
        {
          "html": "<p>Let Apple anonymous attestation CA generate an X.509 certificate for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-public-key\" id=\"ref-for-credential-public-key③③\">credential public key</a> and include the <var>nonce</var> as a certificate extension with OID <code>1.2.840.113635.100.8.2</code>. <var>credCert</var> denotes this certificate. The <var>credCert</var> thus serves as a proof of the attestation, and the included <var>nonce</var> proves the attestation is live. In addition to that, the <var>nonce</var> also protects the integrity of the <var>authenticatorData</var> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-data\" id=\"ref-for-client-data①②\">client data</a>.</p>"
        },
        {
          "html": "<p>Set <var>x5c</var> to <var>credCert</var> followed by its certificate chain.</p>"
        }
      ]
    },
    {
      "html": "Given the verification procedure inputs <var>attStmt</var>, <var>authenticatorData</var> and <var>clientDataHash</var>, the verification procedure is as follows:",
      "rationale": "verify",
      "steps": [
        {
          "html": "<p>Verify that <var>attStmt</var> is valid CBOR conforming to the syntax defined above and perform CBOR decoding on it to extract the contained fields.</p>"
        },
        {
          "html": "<p>Concatenate <var>authenticatorData</var> and <var>clientDataHash</var> to form <var>nonceToHash</var>.</p>"
        },
        {
          "html": "<p>Perform SHA-256 hash of <var>nonceToHash</var> to produce <var>nonce</var>.</p>"
        },
        {
          "html": "<p>Verify that <var>nonce</var> equals the value of the extension with OID <code>1.2.840.113635.100.8.2</code> in <var>credCert</var>.</p>"
        },
        {
          "html": "<p>Verify that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-public-key\" id=\"ref-for-credential-public-key③④\">credential public key</a> equals the Subject Public Key of <var>credCert</var>.</p>"
        },
        {
          "html": "<p>If successful, return implementation-specific values representing attestation type <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#anonymization-ca\" id=\"ref-for-anonymization-ca⑤\">Anonymization CA</a> and attestation trust path <var>x5c</var>.</p>"
        }
      ]
    },
    {
      "html": "Given the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure-inputs\" id=\"ref-for-verification-procedure-inputs⑤\">verification procedure inputs</a> <var>attStmt</var>, <var>authenticatorData</var> and <var>clientDataHash</var>, the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure①②\">verification procedure</a> is\nas follows:",
      "rationale": "for",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①⑨\">For each</a> <var>subStmt</var> of <var>attStmt</var>, evaluate the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure①③\">verification procedure</a> corresponding to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format-identifier\" id=\"ref-for-attestation-statement-format-identifier⑤\">attestation statement format identifier</a> <code><var>subStmt</var>.fmt</code> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure-inputs\" id=\"ref-for-verification-procedure-inputs⑥\">verification procedure inputs</a> <var>subStmt</var>, <var>authenticatorData</var> and <var>clientDataHash</var>.</p>\n       <p>If validation fails for one or more <var>subStmt</var>, decide the appropriate result based on <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑨⓪\">Relying Party</a> policy.</p>"
        },
        {
          "html": "<p>If sufficiently many (as determined by <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party②⑨①\">Relying Party</a> policy) <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-item\" id=\"ref-for-list-item①③\">items</a> of <var>attStmt</var> verify successfully,\nreturn implementation-specific values representing any combination of outputs from successful <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure①④\">verification procedures</a>.</p>"
        }
      ]
    },
    {
      "html": "",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>facetId</var> be the result of passing the caller’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin①⑦\">origin</a> to the\nFIDO algorithm for <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-v2.0-id-20180227/fido-appid-and-facets-v2.0-id-20180227.html#determining-the-facetid-of-a-calling-application\" id=\"ref-for-determining-the-facetid-of-a-calling-application①\">determining the FacetID of a calling application</a>.</p>"
        },
        {
          "html": "<p>Let <var>appId</var> be the extension input.</p>"
        },
        {
          "html": "<p>Pass <var>facetId</var> and <var>appId</var> to the FIDO algorithm for <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-v2.0-id-20180227/fido-appid-and-facets-v2.0-id-20180227.html#determining-if-a-caller-s-facetid-is-authorized-for-an-appid\" id=\"ref-for-determining-if-a-caller-s-facetid-is-authorized-for-an-appid①\">determining if a\ncaller’s FacetID is authorized for an AppID</a>. If that algorithm rejects <var>appId</var> then return a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror④\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②③\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>When <a href=\"https://w3c.github.io/webauthn/#allowCredentialDescriptorListCreation\">building allowCredentialDescriptorList</a>,\nif a U2F authenticator indicates that a credential is inapplicable (i.e. by\nreturning <code>SW_WRONG_DATA</code>) then the client MUST retry with the U2F application\nparameter set to the SHA-256 hash of <var>appId</var>. If this results in an applicable\ncredential, the client MUST include the credential in <var>allowCredentialDescriptorList</var>. The value of <var>appId</var> then replaces the <code>rpId</code> parameter of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion②⓪\">authenticatorGetAssertion</a>.</p>"
        },
        {
          "html": "<p>Let <var>output</var> be the Boolean value <code>false</code>.</p>"
        },
        {
          "html": "<p>When <a href=\"https://w3c.github.io/webauthn/#assertionCreationDataCreation\">creating assertionCreationData</a>,\nif the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion\" id=\"ref-for-assertion⑤\">assertion</a> was created by a U2F authenticator with the U2F application parameter set to the SHA-256 hash of <var>appId</var> instead of the SHA-256 hash of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#rp-id\" id=\"ref-for-rp-id④⑥\">RP ID</a>, set <var>output</var> to <code>true</code>.</p>"
        }
      ]
    },
    {
      "html": "When <a href=\"https://w3c.github.io/webauthn/#sctn-createCredential\">creating a new credential</a>:",
      "rationale": "reject",
      "steps": [
        {
          "html": "Just after <a href=\"https://w3c.github.io/webauthn/#CreateCred-DetermineRpId\">establishing the RP ID</a> perform these steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>facetId</var> be the result of passing the caller’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/origin.html#concept-origin\" id=\"ref-for-concept-origin①⑧\">origin</a> to the FIDO algorithm\nfor <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-v2.0-id-20180227/fido-appid-and-facets-v2.0-id-20180227.html#determining-the-facetid-of-a-calling-application\" id=\"ref-for-determining-the-facetid-of-a-calling-application②\">determining the FacetID of a calling application</a>.</p>"
            },
            {
              "html": "<p>Let <var>appId</var> be the value of the extension input <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsclientinputs-appidexclude\" id=\"ref-for-dom-authenticationextensionsclientinputs-appidexclude\">appidExclude</a></code>.</p>"
            },
            {
              "html": "<p>Pass <var>facetId</var> and <var>appId</var> to the FIDO algorithm for <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-v2.0-id-20180227/fido-appid-and-facets-v2.0-id-20180227.html#determining-if-a-caller-s-facetid-is-authorized-for-an-appid\" id=\"ref-for-determining-if-a-caller-s-facetid-is-authorized-for-an-appid③\">determining if a caller’s\nFacetID is authorized for an AppID</a>. If the latter algorithm rejects <var>appId</var> then\nreturn a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#securityerror\" id=\"ref-for-securityerror⑤\">SecurityError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②④\">DOMException</a></code> and terminate the <a href=\"https://w3c.github.io/webauthn/#sctn-createCredential\">creating a new credential</a> algorithm as well as these steps.</p>"
            },
            {
              "html": "<p>Otherwise, continue with normal processing.</p>"
            }
          ]
        },
        {
          "html": "Just prior to <a href=\"https://w3c.github.io/webauthn/#CreateCred-InvokeAuthnrMakeCred\">invoking authenticatorMakeCredential</a> perform these steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>authenticator</var> supports the U2F protocol <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fido-u2f-message-formats\" title=\"FIDO U2F Raw Message Formats\">[FIDO-U2F-Message-Formats]</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②⓪\">for each</a> <a href=\"https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor\" id=\"ref-for-dictdef-publickeycredentialdescriptor①④\">credential descriptor</a> <var>C</var> in <var>excludeCredentialDescriptorList</var>:",
              "rationale": "check",
              "steps": [
                {
                  "html": "<p>Check whether <var>C</var> was created using U2F on <var>authenticator</var> by sending a <code>U2F_AUTHENTICATE</code> message to <var>authenticator</var> whose \"five parts\" are set to the following values:</p>\n           <dl>\n            <dt data-md=\"\"><var>control byte</var>\n            </dt><dd data-md=\"\">\n             <p><code>0x07</code> (\"check-only\")</p>\n            </dd><dt data-md=\"\"><var>challenge parameter</var>\n            </dt><dd data-md=\"\">\n             <p>32 random bytes</p>\n            </dd><dt data-md=\"\"><var>application parameter</var>\n            </dt><dd data-md=\"\">\n             <p>SHA-256 hash of <var>appId</var></p>\n            </dd><dt data-md=\"\"><var>key handle length</var>\n            </dt><dd data-md=\"\">\n             <p>The length of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id①③\">id</a></code></code> (in bytes)</p>\n            </dd><dt data-md=\"\"><var>key handle</var>\n            </dt><dd data-md=\"\">\n             <p>The value of <code><var>C</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id①④\">id</a></code></code>, i.e., the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id③⑧\">credential id</a>.</p>\n           </dd></dl>"
                },
                {
                  "html": "<p>If <var>authenticator</var> responds with <code>message:error:test-of-user-presence-required</code> (i.e., success):\ncease normal processing of this <var>authenticator</var> and indicate in a platform-specific manner\nthat the authenticator is inapplicable. For example, this could be in the form of UI, or\ncould involve requesting <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent②②\">user consent</a> from <var>authenticator</var> and, upon receipt, treating\nit as if the authenticator had returned <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror⑤\">InvalidStateError</a></code>. Requesting <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-consent\" id=\"ref-for-user-consent②③\">user consent</a> can be accomplished by sending another <code>U2F_AUTHENTICATE</code> message to <var>authenticator</var> as\nabove except for setting <var>control byte</var> to <code>0x03</code> (\"enforce-user-presence-and-sign\"),\nand ignoring the response.</p>"
                }
              ]
            },
            {
              "html": "<p>Continue with normal processing.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "",
      "rationale": "if",
      "steps": [
        {
          "html": "If processed during a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#registration-ceremony\" id=\"ref-for-registration-ceremony①⑤\">registration ceremony</a>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialpropertiesoutput-rk\" id=\"ref-for-dom-credentialpropertiesoutput-rk①\">rk</a></code> to the value of the <var>requireResidentKey</var> parameter that was used in the <a href=\"https://w3c.github.io/webauthn/#CreateCred-InvokeAuthnrMakeCred\">invocation</a> of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatormakecredential\" id=\"ref-for-authenticatormakecredential②⓪\">authenticatorMakeCredential</a> operation.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialpropertiesoutput-authenticatordisplayname\" id=\"ref-for-dom-credentialpropertiesoutput-authenticatordisplayname①\">authenticatorDisplayName</a></code> as described in its definition, using some client-specific procedure.\nIf no suitable value is found, let <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-credentialpropertiesoutput-authenticatordisplayname\" id=\"ref-for-dom-credentialpropertiesoutput-authenticatordisplayname②\">authenticatorDisplayName</a></code> be undefined.</p>"
        }
      ]
    },
    {
      "html": "",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-evalbycredential\" id=\"ref-for-dom-authenticationextensionsprfinputs-evalbycredential①\">evalByCredential</a></code> is present, return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑤\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror③\">NotSupportedError</a></code>”.</p>"
        },
        {
          "html": "<p>Set <code>hmac-secret</code> to <code>true</code> in the authenticator extensions input.</p>"
        },
        {
          "html": "<p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-eval\" id=\"ref-for-dom-authenticationextensionsprfinputs-eval①\">eval</a></code> is present and a future extension to <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-fido-ctap\" title=\"Client to Authenticator Protocol (CTAP)\">[FIDO-CTAP]</a> permits evaluation of the PRF at creation time, configure <code>hmac-secret</code> inputs accordingly:</p>\n       <ul>\n        <li data-md=\"\">\n         <p>Let <code>salt1</code> be the value of <code>SHA-256(UTF8Encode(\"WebAuthn PRF\") || 0x00 || <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-eval\" id=\"ref-for-dom-authenticationextensionsprfinputs-eval②\">eval</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfvalues-first\" id=\"ref-for-dom-authenticationextensionsprfvalues-first\">first</a></code>)</code>.</p>\n        </li><li data-md=\"\">\n         <p>If <code><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-eval\" id=\"ref-for-dom-authenticationextensionsprfinputs-eval③\">eval</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfvalues-second\" id=\"ref-for-dom-authenticationextensionsprfvalues-second\">second</a></code></code> is present, let <code>salt2</code> be the value of <code>SHA-256(UTF8Encode(\"WebAuthn PRF\") || 0x00 || <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-eval\" id=\"ref-for-dom-authenticationextensionsprfinputs-eval④\">eval</a></code>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfvalues-second\" id=\"ref-for-dom-authenticationextensionsprfvalues-second①\">second</a></code>)</code>.</p>\n       </li></ul>"
        },
        {
          "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfoutputs-enabled\" id=\"ref-for-dom-authenticationextensionsprfoutputs-enabled\">enabled</a></code> to the value of <code>hmac-secret</code> in the authenticator extensions output. If not present, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfoutputs-enabled\" id=\"ref-for-dom-authenticationextensionsprfoutputs-enabled①\">enabled</a></code> to <code>false</code>.</p>"
        },
        {
          "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfoutputs-results\" id=\"ref-for-dom-authenticationextensionsprfoutputs-results\">results</a></code> to the decrypted PRF result(s), if any.</p>"
        }
      ]
    },
    {
      "html": "",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-evalbycredential\" id=\"ref-for-dom-authenticationextensionsprfinputs-evalbycredential②\">evalByCredential</a></code> is not empty but <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials②④\">allowCredentials</a></code> is empty, return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑥\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror④\">NotSupportedError</a></code>”.</p>"
        },
        {
          "html": "<p>If any <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-key\" id=\"ref-for-map-key\">key</a> in <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-evalbycredential\" id=\"ref-for-dom-authenticationextensionsprfinputs-evalbycredential③\">evalByCredential</a></code> is the empty string, or is not a valid <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding①⑥\">base64url encoding</a>, or does not equal the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id\" id=\"ref-for-dom-publickeycredentialdescriptor-id①⑤\">id</a></code> of some element of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials②⑤\">allowCredentials</a></code> after performing <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding①⑦\">base64url decoding</a>, then return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑦\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#syntaxerror\" id=\"ref-for-syntaxerror\">SyntaxError</a></code>”.</p>"
        },
        {
          "html": "<p>Initialize the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsclientoutputs-prf\" id=\"ref-for-dom-authenticationextensionsclientoutputs-prf\">prf</a></code> extension output to an empty dictionary.</p>"
        },
        {
          "html": "Let <var>ev</var> be null, and try to find any applicable PRF input(s):",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-evalbycredential\" id=\"ref-for-dom-authenticationextensionsprfinputs-evalbycredential④\">evalByCredential</a></code> is present and <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">contains</a> an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-entry\" id=\"ref-for-map-entry①\">entry</a> whose <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-key\" id=\"ref-for-map-key①\">key</a> is the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding①⑧\">base64url encoding</a> of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-id\" id=\"ref-for-credential-id④⓪\">credential ID</a> that will be returned, let <var>ev</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-value\" id=\"ref-for-map-value\">value</a> of that entry.</p>"
            },
            {
              "html": "<p>If <var>ev</var> is null and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-eval\" id=\"ref-for-dom-authenticationextensionsprfinputs-eval⑤\">eval</a></code> is present, then let <var>ev</var> be the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfinputs-eval\" id=\"ref-for-dom-authenticationextensionsprfinputs-eval⑥\">eval</a></code>.</p>"
            }
          ]
        },
        {
          "html": "If <var>ev</var> is not null:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <code>salt1</code> be the value of <code>SHA-256(UTF8Encode(\"WebAuthn PRF\") || 0x00 || <var>ev</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfvalues-first\" id=\"ref-for-dom-authenticationextensionsprfvalues-first①\">first</a></code>)</code>.</p>"
            },
            {
              "html": "<p>If <code><var>ev</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfvalues-second\" id=\"ref-for-dom-authenticationextensionsprfvalues-second②\">second</a></code></code> is present, let <code>salt2</code> be the value of <code>SHA-256(UTF8Encode(\"WebAuthn PRF\") || 0x00 || <var>ev</var>.<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfvalues-second\" id=\"ref-for-dom-authenticationextensionsprfvalues-second③\">second</a></code>)</code>.</p>"
            },
            {
              "html": "<p>Send an <code>hmac-secret</code> extension to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②④②\">authenticator</a> using the values of <code>salt1</code> and, if set, <code>salt2</code> as the parameters of the same name in that process.</p>"
            },
            {
              "html": "<p>Decrypt the extension result and set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsprfoutputs-results\" id=\"ref-for-dom-authenticationextensionsprfoutputs-results①\">results</a></code> to the PRF result(s), if any.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "",
      "rationale": "if",
      "steps": [
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-read\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-read①\">read</a></code> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-write\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-write①\">write</a></code> is present:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑧\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑤\">NotSupportedError</a></code>”.</p>"
            }
          ]
        },
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-support\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-support①\">support</a></code> is present and has the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-largeblobsupport-required\" id=\"ref-for-dom-largeblobsupport-required\">required</a></code>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargebloboutputs-supported\" id=\"ref-for-dom-authenticationextensionslargebloboutputs-supported\">supported</a></code> to <code>true</code>.</p>"
            },
            {
              "html": "<p>If a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#create-candidate-authenticator\" id=\"ref-for-create-candidate-authenticator\">candidate authenticator</a> becomes available (<a href=\"https://w3c.github.io/webauthn/#CreateCred-async-loop\">step 21</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-create-slot\" id=\"ref-for-dom-publickeycredential-create-slot①①\">[[Create]]()</a></code>) then,\n  before evaluating any <code><var>options</var></code>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue①⑨\">continue</a> (i.e. ignore the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#create-candidate-authenticator\" id=\"ref-for-create-candidate-authenticator①\">candidate authenticator</a>)\n  if the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#create-candidate-authenticator\" id=\"ref-for-create-candidate-authenticator②\">candidate authenticator</a> is not capable of storing large blobs.</p>"
            }
          ]
        },
        {
          "html": "Otherwise (i.e. <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-support\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-support②\">support</a></code> is absent or has the value <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-largeblobsupport-preferred\" id=\"ref-for-dom-largeblobsupport-preferred\">preferred</a></code>):",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#create-selected-authenticator\" id=\"ref-for-create-selected-authenticator\">authenticator is selected</a> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#create-selected-authenticator\" id=\"ref-for-create-selected-authenticator①\">selected authenticator</a> supports large blobs, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargebloboutputs-supported\" id=\"ref-for-dom-authenticationextensionslargebloboutputs-supported①\">supported</a></code> to <code>true</code>, and <code>false</code> otherwise.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "",
      "rationale": "if",
      "steps": [
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-support\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-support③\">support</a></code> is present:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②⑨\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑥\">NotSupportedError</a></code>”.</p>"
            }
          ]
        },
        {
          "html": "If both <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-read\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-read②\">read</a></code> and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-write\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-write②\">write</a></code> are present:",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③⓪\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑦\">NotSupportedError</a></code>”.</p>"
            }
          ]
        },
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-read\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-read③\">read</a></code> is present and has the value <code>true</code>:",
          "rationale": "initialize",
          "steps": [
            {
              "html": "<p>Initialize the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-extension-output\" id=\"ref-for-client-extension-output①⑧\">client extension output</a>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsclientoutputs-largeblob\" id=\"ref-for-dom-authenticationextensionsclientoutputs-largeblob\">largeBlob</a></code>.</p>"
            },
            {
              "html": "<p>If any authenticator indicates success (in <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot\" id=\"ref-for-dom-publickeycredential-discoverfromexternalsource-slot①③\">[[DiscoverFromExternalSource]]()</a></code>), attempt to read any largeBlob data associated with the asserted credential.</p>"
            },
            {
              "html": "<p>If successful, set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargebloboutputs-blob\" id=\"ref-for-dom-authenticationextensionslargebloboutputs-blob\">blob</a></code> to the result.</p>"
            }
          ]
        },
        {
          "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-write\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-write③\">write</a></code> is present:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials\" id=\"ref-for-dom-publickeycredentialrequestoptions-allowcredentials②⑥\">allowCredentials</a></code> does not contain exactly one element:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③①\">DOMException</a></code> whose name is “<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror⑧\">NotSupportedError</a></code>”.</p>"
                }
              ]
            },
            {
              "html": "<p>If the <a href=\"https://w3c.github.io/webauthn/#sctn-getAssertion\">assertion</a> operation is successful, attempt to store the contents of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargeblobinputs-write\" id=\"ref-for-dom-authenticationextensionslargeblobinputs-write④\">write</a></code> on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②④⑤\">authenticator</a>, associated with the indicated credential.</p>"
            },
            {
              "html": "<p>Set <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionslargebloboutputs-written\" id=\"ref-for-dom-authenticationextensionslargebloboutputs-written\">written</a></code> to <code>true</code> if successful and <code>false</code> otherwise.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "For both <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatormakecredential\" id=\"ref-for-authenticatormakecredential②①\">authenticatorMakeCredential</a> and <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorgetassertion\" id=\"ref-for-authenticatorgetassertion②①\">authenticatorGetAssertion</a> operations:",
      "rationale": "create",
      "steps": [
        {
          "html": "<p>Create or select the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑥⑧\">public key credential source</a> as usual (see <a href=\"https://w3c.github.io/webauthn/#sctn-op-make-cred\">§ 6.3.2 The authenticatorMakeCredential Operation</a>, or <a href=\"https://w3c.github.io/webauthn/#sctn-op-get-assertion\">§ 6.3.3 The authenticatorGetAssertion Operation</a> as appropriate).</p>"
        },
        {
          "html": "<p>Let <var>scopes</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑦\">set</a> of all supplemental public key scopes that the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤③\">authenticator</a> supports. Update <var>scopes</var> to be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-intersection\" id=\"ref-for-set-intersection\">intersection</a> of itself and <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysinputs-scopes\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysinputs-scopes①\">scopes</a></code>. If <var>scopes</var> is empty, terminate these processing steps with no extension output.</p>"
        },
        {
          "html": "<p>Let <var>spks</var> and <var>spkSigs</var> be empty arrays.</p>"
        },
        {
          "html": "<p>Sort <var>scopes</var> lexicographically.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-iterate\" id=\"ref-for-map-iterate⑦\">For each</a> <var>scope</var> in <var>scopes</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If a supplemental key with scope <var>scope</var> does not already exist for this {<a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id⑤\">Credential ID</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid⑥\">RP ID</a>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid⑦\">userHandle</a>} tuple on the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤④\">authenticator</a>, create it using the same public key algorithm as that used by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-credential\" id=\"ref-for-user-credential①⑤\">user credential</a>'s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-key-pair\" id=\"ref-for-credential-key-pair⑥\">credential key pair</a>, otherwise locate the existing supplemental key.</p>"
            },
            {
              "html": "Let <var>attFormat</var> be the chosen <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format①⑧\">attestation statement format</a>, and <var>attAaguid</var> be a 16-byte value, based on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysinputs-attestation\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysinputs-attestation①\">attestation</a></code> in the extension input:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "none",
                      "steps": [
                        {
                          "html": "<p><var>attFormat</var> is \"none\" or \"self\", at the authenticator’s discretion, and <var>attAaguid</var> is 16 zero bytes. (Note that, since the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key\">supplemental public key</a> is already exercised during <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create\" id=\"ref-for-dom-credentialscontainer-create③⑧\">navigator.credentials.create()</a></code> calls, the proof-of-possession property provided by \"self\" attestation is superfluous in that context.)</p>"
                        }
                      ]
                    },
                    {
                      "case": "indirect, direct",
                      "steps": [
                        {
                          "html": "<p><var>attFormat</var> is an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format①⑨\">attestation statement format</a> appropriate for this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤⑤\">authenticator</a> based on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysinputs-attestationformats\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysinputs-attestationformats①\">attestationFormats</a></code>, and <var>attAaguid</var> is the corresponding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#aaguid\" id=\"ref-for-aaguid③\">AAGUID</a>, which MAY be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤⑥\">authenticator’s</a> AAGUID. (Since the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key①\">supplemental public key</a>'s scope is different from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-credential\" id=\"ref-for-user-credential①⑥\">user credential</a>, it will often have a different attestation. For example, the attestation for a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key②\">supplemental public key</a> with “device” scope can be tied to hardware roots of trust, although it does not have to be.)</p>"
                        }
                      ]
                    },
                    {
                      "case": "enterprise",
                      "steps": [
                        {
                          "html": "<p>The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③③④\">Relying Party</a> wants to receive an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement③⑨\">attestation statement</a> that may include uniquely identifying information. This is intended for controlled deployments within an enterprise where the organization wishes to tie registrations to specific authenticators. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤⑦\">Authenticators</a> MUST NOT provide such an attestation unless the user agent or authenticator configuration expressly permits it for the requested <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#rp-id\" id=\"ref-for-rp-id④⑧\">RP ID</a>. If <i>not</i> permitted, then follow the steps for <code>direct</code> attestation. Otherwise <var>attFormat</var> is an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format②⓪\">attestation statement format</a> appropriate for this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤⑧\">authenticator</a> based on <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysinputs-attestationformats\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysinputs-attestationformats②\">attestationFormats</a></code>, and <var>attAaguid</var> is the corresponding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#aaguid\" id=\"ref-for-aaguid④\">AAGUID</a>, which MAY be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator\" id=\"ref-for-authenticator②⑤⑨\">authenticator’s</a> AAGUID.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Let <var>spk</var> be the newly created or existing supplemental public key, in COSE_Key format <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authdata-attestedcredentialdata-credentialpublickey\" id=\"ref-for-authdata-attestedcredentialdata-credentialpublickey⑨\">in the same fashion as for the user credential’s credentialPublicKey</a> when the latter is conveyed in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attested-credential-data\" id=\"ref-for-attested-credential-data①③\">attested credential data</a>.</p>"
            },
            {
              "html": "<p>Let <var>supplementalPrivateKey</var> be the newly created or existing private key corresponding to <var>spk</var>.</p>"
            },
            {
              "html": "<p>Let <var>randomNonce</var> be a fresh randomly-generated byte string of 32 bytes maximum length, or a zero length byte string if the authenticator chooses to not generate a nonce.</p>"
            },
            {
              "html": "<span class=\"marker\">Note:</span> as with all CBOR structures used in this specification, the <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-v2.1-ps-20210615/fido-client-to-authenticator-protocol-v2.1-ps-errata-20220621.html#ctap2-canonical-cbor-encoding-form\" id=\"ref-for-ctap2-canonical-cbor-encoding-form⑤\">CTAP2 canonical CBOR encoding form</a> MUST be used.",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set a key and value for the <code>scope</code> group based on the value of <var>scope</var>.</p>"
                },
                {
                  "html": "<p>Let the <code>aaguid</code> key’s value be <var>attAaguid</var>.</p>"
                },
                {
                  "html": "<p>Let the <code>spk</code> key’s value be <var>spk</var>.</p>"
                },
                {
                  "html": "<p>Let the <code>nonce</code> key’s value be <var>randomNonce</var>.</p>"
                },
                {
                  "html": "<p>Let the values of the <code>$$attStmtType</code> <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc8610#section-3.9\" id=\"ref-for-section-3.9①\">group socket</a> be the result of generating an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement④⓪\">attestation statement</a> with the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format②①\">attestation statement format</a>, <var>attFormat</var>. See <a href=\"https://w3c.github.io/webauthn/#sctn-supplemental-public-keys-attestation-calculations\">§ 10.2.1.2.2 Attestation calculations</a>.</p>"
                },
                {
                  "html": "<p>If the <code>$$attStmtType</code> <a data-link-type=\"dfn\" href=\"https://tools.ietf.org/html/rfc8610#section-3.9\" id=\"ref-for-section-3.9②\">group socket</a> contains uniquely identifying information then let <code>epAtt</code> be <code>true</code>. Otherwise omit the <code>epAtt</code> field. (This field can only be <code>true</code> when the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysinputs-attestation\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysinputs-attestation②\">attestation</a></code> field of the extension input is \"enterprise\" and either the user-agent or the authenticator permits uniquely identifying attestation for the requested RP ID.)</p>"
                }
              ]
            },
            {
              "html": "<p>Append <var>supplementalPubKey</var> to <var>spks</var>.</p>"
            },
            {
              "html": "<p>Let <var>spkSig</var> be the result of signing the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion-signature\" id=\"ref-for-assertion-signature①①\">assertion signature</a> <a href=\"https://w3c.github.io/webauthn/#fig-signature\">input</a> with <var>supplementalPrivateKey</var>.</p>"
            },
            {
              "html": "<p>Append <var>spkSig</var> to <var>spkSigs</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let the <code>supplementalPubKeys</code> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-output\" id=\"ref-for-authenticator-extension-output①⑥\">authenticator extension output</a> value be the CBOR array <var>spks</var>.</p>"
        },
        {
          "html": "<p>Let the CBOR encoding of <var>spkSigs</var> be the extension’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#unsigned-extension-outputs\" id=\"ref-for-unsigned-extension-outputs⑦\">unsigned extension output</a>.</p>"
        }
      ]
    },
    {
      "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④⓪\">Relying Party</a> requested the <code>supplementalPubKeys</code> extension in a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create\" id=\"ref-for-dom-credentialscontainer-create③⑨\">navigator.credentials.create()</a></code> call,\nthen the below verification steps are performed in the context of <a href=\"https://w3c.github.io/webauthn/#reg-ceremony-verify-extension-outputs\">step 20</a> of <a href=\"https://w3c.github.io/webauthn/#sctn-registering-a-new-credential\">§ 7.1 Registering a New Credential</a> using these variables established therein: <var>credential</var>, <var>clientExtensionResults</var>, <var>authData</var>, and <var>hash</var>. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④①\">Relying Party</a> policy may specify whether a response without a <code>supplementalPubKeys</code> extension output is acceptable.",
      "rationale": "verify",
      "steps": [
        {
          "html": "<p>Verify that the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsclientoutputs-supplementalpubkeys\" id=\"ref-for-dom-authenticationextensionsclientoutputs-supplementalpubkeys\">supplementalPubKeys</a></code> member of <var>clientExtensionResults</var> exists, and contains the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysoutputs-signatures\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysoutputs-signatures\">signatures</a></code> field. Let <var>signatures</var> be the value of that field.</p>"
        },
        {
          "html": "<p>Let <var>attObjsForSupplementalPublicKey</var> be the value of the <code>supplementalPubKeys</code> member of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-output\" id=\"ref-for-authenticator-extension-output①⑧\">authenticator extension output</a> from <var>authData</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①\">size</a> of <var>attObjsForSupplementalPublicKey</var> is not equal to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size②\">size</a> of <var>signatures</var> then abort the registration process with an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②①\">Iterate</a> over the indices of <var>attObjsForSupplementalPublicKey</var> (which, after the check in the previous step, must also be the indices of <var>signatures</var>). Then, for each (<var>attObjForSupplementalPubKey</var>, <var>signature</var>) from the two lists:",
          "rationale": "extract",
          "steps": [
            {
              "html": "<p>Extract the contained fields from <var>attObjForSupplementalPubKey</var>: <var>aaguid</var>, <var>spk</var>, <var>nonce</var>, <var>fmt</var> and <var>attStmt</var>. Also let <var>scope</var> reflect the scope, specified by the member of the <code>scope</code> group that is present.</p>"
            },
            {
              "html": "<p>Verify that <var>signature</var> is a valid signature over the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion-signature\" id=\"ref-for-assertion-signature①③\">assertion signature</a> <a href=\"https://w3c.github.io/webauthn/#fig-signature\">input</a> (i.e. <code>authData</code> and <code>hash</code>) by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key⑤\">supplemental public key</a> <var>spk</var>. (The signature algorithm is the same as for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-credential\" id=\"ref-for-user-credential①⑨\">user credential</a>.)</p>"
            },
            {
              "html": "<p>Optionally, if attestation was requested and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④②\">Relying Party</a> wishes to verify it, verify that <var>attStmt</var> is a correct <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement\" id=\"ref-for-attestation-statement④⑤\">attestation statement</a>, conveying a valid <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-signature\" id=\"ref-for-attestation-signature①⑦\">attestation signature</a>, by using the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#attestation-statement-format\" id=\"ref-for-attestation-statement-format②③\">attestation statement format</a> <var>fmt</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#verification-procedure\" id=\"ref-for-verification-procedure①⑤\">verification procedure</a> given <var>attStmt</var>. See <a href=\"https://w3c.github.io/webauthn/#sctn-supplemental-public-keys-attestation-calculations\">§ 10.2.1.2.2 Attestation calculations</a>. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④③\">Relying Party</a> policy may specifiy which attestations are acceptable.</p>"
            },
            {
              "html": "<p>Create a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record-supplemental-public-key-record\" id=\"ref-for-credential-record-supplemental-public-key-record①\">supplemental public key record</a> with the contents:</p>\n       <dl>\n        <dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-aaguid\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-aaguid\">aaguid</a>\n        </dt><dd data-md=\"\">\n         <p>The value of <var>aaguid</var>.</p>\n        </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-spk\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-spk\">spk</a>\n        </dt><dd data-md=\"\">\n         <p>The value of <var>spk</var>.</p>\n        </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-scope\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-scope\">scope</a>\n        </dt><dd data-md=\"\">\n         <p>The value of <var>scope</var>.</p>\n        </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-fmt\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-fmt\">fmt</a>\n        </dt><dd data-md=\"\">\n         <p>The value of <var>fmt</var>.</p>\n        </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-attstmt\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-attstmt\">attStmt</a>\n        </dt><dd data-md=\"\">\n         <p>The value of <var>attStmt</var>.</p>\n       </dd></dl>\n       <p>In <a href=\"https://w3c.github.io/webauthn/#reg-ceremony-store-credential-record\">step 27</a> of <a href=\"https://w3c.github.io/webauthn/#sctn-registering-a-new-credential\">§ 7.1 Registering a New Credential</a>,\nadd this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record-supplemental-public-key-record\" id=\"ref-for-credential-record-supplemental-public-key-record②\">supplemental public key record</a> to the <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-supplementalpubkeys\" id=\"ref-for-abstract-opdef-credential-record-supplementalpubkeys\">supplementalPubKeys</a> member of the new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record\" id=\"ref-for-credential-record②④\">credential record</a>.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④④\">Relying Party</a> requested the <code>supplementalPubKeys</code> extension in a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get\" id=\"ref-for-dom-credentialscontainer-get④④\">navigator.credentials.get()</a></code> call,\nthen the below verification steps are performed in the context of <a href=\"https://w3c.github.io/webauthn/#authn-ceremony-verify-extension-outputs\">step 19</a> of <a href=\"https://w3c.github.io/webauthn/#sctn-verifying-assertion\">§ 7.2 Verifying an Authentication Assertion</a> using these variables established therein: <var>credential</var>, <var>clientExtensionResults</var>, <var>authData</var>, <var>hash</var>, and <var>credentialRecord</var>. <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④⑤\">Relying Party</a> policy may specify whether a response without a <code>supplementalPubKeys</code> extension output is acceptable.",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>recognizedSpks</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑦\">empty</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑨\">set</a>.</p>"
        },
        {
          "html": "<p>Verify that the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionsclientoutputs-supplementalpubkeys\" id=\"ref-for-dom-authenticationextensionsclientoutputs-supplementalpubkeys①\">supplementalPubKeys</a></code> member of <var>clientExtensionResults</var> exists, and contains the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-authenticationextensionssupplementalpubkeysoutputs-signatures\" id=\"ref-for-dom-authenticationextensionssupplementalpubkeysoutputs-signatures①\">signatures</a></code> field. Let <var>signatures</var> be the value of that field.</p>"
        },
        {
          "html": "<p>Let <var>attObjsForSupplementalPubKeys</var> be the value of the <code>supplementalPubKeys</code> member of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-output\" id=\"ref-for-authenticator-extension-output①⑨\">authenticator extension output</a> from <var>authData</var>.</p>"
        },
        {
          "html": "<p>If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size③\">size</a> of <var>attObjsForSupplementalPubKeys</var> is not equal to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size④\">size</a> of <var>signatures</var> then abort the authentication process with an error.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②②\">Iterate</a> over the indices of <var>attObjsForSupplementalPubKeys</var> (which, after the check in the previous step, must also be the indices of <var>signatures</var>). Then, for each (<var>attObjForSupplementalPubKey</var>, <var>signature</var>) from the two lists:",
          "rationale": "extract",
          "steps": [
            {
              "html": "<p>Extract the contained fields from <var>attObjForSupplementalPubKey</var>: <var>aaguid</var>, <var>spk</var>, <var>nonce</var>, <var>fmt</var>, <var>attStmt</var>. Also let <var>scope</var> reflect the scope, specified by the member of the <code>scope</code> group that is present.</p>"
            },
            {
              "html": "<p>Verify that <var>signature</var> is a valid signature over the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#assertion-signature\" id=\"ref-for-assertion-signature①④\">assertion signature</a> <a href=\"https://w3c.github.io/webauthn/#fig-signature\">input</a> (i.e. <code>authData</code> and <code>hash</code>) by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key⑥\">supplemental public key</a> <var>spk</var>. (The signature algorithm is the same as for the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#user-credential\" id=\"ref-for-user-credential②⓪\">user credential</a>.)</p>"
            },
            {
              "html": "Let <var>matchedSpkRecords</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty⑧\">empty</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①⓪\">set</a>. <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②③\">For each</a> <var>spkRecord</var> in <var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-supplementalpubkeys\" id=\"ref-for-abstract-opdef-credential-record-supplementalpubkeys①\">supplementalPubKeys</a>:",
              "rationale": "if",
              "steps": [
                {
                  "html": "If <var>spkRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-aaguid\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-aaguid①\">aaguid</a> equals <var>aaguid</var>, <var>spkRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-spk\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-spk①\">spk</a> equals <var>spk</var>,\n  and <var>spkRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-scope\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-scope①\">scope</a> equals <var>scope</var>:",
                  "rationale": "append",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑥\">Append</a> <var>spkRecord</var> to <var>matchedSpkRecords</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "If <var>matchedSpkRecords</var>",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "has size greater than one:",
                      "steps": [
                        {
                          "html": "<p>Some form of error has occurred: <var>credentialRecord</var> invariants have been broken. Terminate these verification steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "has size equal to one:",
                      "steps": [
                        {
                          "html": "Otherwise, let <var>spkRecord</var> be <var>matchedSpkRecords</var>[0]. If the <var>attStmt</var> in <var>attObjForSupplementalPubKey</var>:",
                          "rationale": ".switch",
                          "steps": [
                            {
                              "operation": "switch",
                              "steps": [
                                {
                                  "case": "equals spkRecord.attStmt by binary equality:",
                                  "steps": [
                                    {
                                      "html": "<p>This is a known <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key⑨\">supplemental public key</a> with a valid signature and valid attestation. Append <var>spkRecord</var> to <var>recognizedSpks</var> and continue to the next iteration, if any.</p>"
                                    }
                                  ]
                                },
                                {
                                  "case": "does not equal spkRecord.attStmt by binary equality:",
                                  "steps": [
                                    {
                                      "html": "If the result is:",
                                      "rationale": ".switch",
                                      "steps": [
                                        {
                                          "operation": "switch",
                                          "steps": [
                                            {
                                              "case": "successful",
                                              "steps": [
                                                {
                                                  "html": "<p>This is a known <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key①⓪\">supplemental public key</a> with a valid signature and valid attestation. Append <var>spkRecord</var> to <var>recognizedSpks</var> and continue to the next iteration, if any.</p>"
                                                }
                                              ]
                                            },
                                            {
                                              "case": "unsuccessful",
                                              "steps": [
                                                {
                                                  "html": "<p>Some form of error has occurred. It is indeterminate whether this is a valid <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key①①\">supplemental public key</a>. Either terminate these verification steps with an error or continue to the next iteration, if any, to ignore this key.</p>"
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "case": "is empty:",
                      "steps": [
                        {
                          "html": "This is possibly a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key①②\">supplemental public key</a>.",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "Let <var>matchedSpkKeys</var> be a new <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①⓪\">empty</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①①\">set</a>. <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②④\">For each</a> <var>spkRecord</var> in <var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-supplementalpubkeys\" id=\"ref-for-abstract-opdef-credential-record-supplementalpubkeys②\">supplementalPubKeys</a>:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>spkRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-spk\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-spk②\">spk</a> equals <var>spk</var>:",
                                  "rationale": "append",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑦\">Append</a> <var>spkRecord</var> to <var>matchedSpkKeys</var>.</p>"
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "html": "If <var>matchedSpkKeys</var> is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-empty\" id=\"ref-for-list-empty①①\">empty</a>:",
                              "rationale": ".switch",
                              "steps": [
                                {
                                  "operation": "switch",
                                  "steps": [
                                    {
                                      "case": "If fmt’s value is \"none\":",
                                      "steps": [
                                        {
                                          "html": "<p>There is no attestation signature to verify and this is a new supplemental key. Unless <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④⑦\">Relying Party</a> policy specifies that this attestation is unacceptable, <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-create-a-new-supplemental-public-key-record\" id=\"ref-for-abstract-opdef-create-a-new-supplemental-public-key-record\">Create a new supplemental public key record</a> and then continue to the next iteration, if any.</p>"
                                        }
                                      ]
                                    },
                                    {
                                      "case": "Otherwise:",
                                      "steps": [
                                        {
                                          "html": "If the result is:",
                                          "rationale": ".switch",
                                          "steps": [
                                            {
                                              "operation": "switch",
                                              "steps": [
                                                {
                                                  "case": "successful",
                                                  "steps": [
                                                    {
                                                      "html": "<p>This is a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#supplemental-public-key\" id=\"ref-for-supplemental-public-key①③\">supplemental public key</a>. <a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-create-a-new-supplemental-public-key-record\" id=\"ref-for-abstract-opdef-create-a-new-supplemental-public-key-record①\">Create a new supplemental public key record</a> then continue to the next iteration, if any.</p>"
                                                    }
                                                  ]
                                                },
                                                {
                                                  "case": "unsuccessful",
                                                  "steps": [
                                                    {
                                                      "html": "<p>Some form of error has occurred and a supplemental public key record cannot be created. Either terminate these verification steps with an error or continue to the next iteration, if any, to ignore this supplemental public key.</p>"
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "html": "<p>Otherwise there is some form of error: we recieved a known <var>spk</var> value, but one or more of the accompanying <var>aaguid</var> or <var>scope</var> values did not match what the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#relying-party\" id=\"ref-for-relying-party③④⑨\">Relying Party</a> has stored along with that <var>spk</var> value. Terminate these verification steps.</p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Create a new supplemental public key record",
      "href": "https://w3c.github.io/webauthn/#abstract-opdef-create-a-new-supplemental-public-key-record",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"abstract-op\" data-export=\"\" id=\"abstract-opdef-create-a-new-supplemental-public-key-record\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">Create a new supplemental public key record</dfn>, perform the following steps:",
      "rationale": "create",
      "steps": [
        {
          "html": "<p>Create a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record-supplemental-public-key-record\" id=\"ref-for-credential-record-supplemental-public-key-record③\">supplemental public key record</a> with the contents:</p>\n     <dl>\n      <dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-aaguid\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-aaguid②\">aaguid</a>\n      </dt><dd data-md=\"\">\n       <p>The value of <var>aaguid</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-spk\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-spk③\">spk</a>\n      </dt><dd data-md=\"\">\n       <p>The value of <var>spk</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-scope\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-scope②\">scope</a>\n      </dt><dd data-md=\"\">\n       <p>The value of <var>scope</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-fmt\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-fmt①\">fmt</a>\n      </dt><dd data-md=\"\">\n       <p>The value of <var>fmt</var>.</p>\n      </dd><dt data-md=\"\"><a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-supplementalpubkeys-record-attstmt\" id=\"ref-for-abstract-opdef-supplementalpubkeys-record-attstmt③\">attStmt</a>\n      </dt><dd data-md=\"\">\n       <p>The value of <var>attStmt</var>.</p>\n     </dd></dl>\n     <p>In <a href=\"https://w3c.github.io/webauthn/#authn-ceremony-update-credential-record\">step 23</a> of <a href=\"https://w3c.github.io/webauthn/#sctn-verifying-assertion\">§ 7.2 Verifying an Authentication Assertion</a>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑧\">append</a> this <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-record-supplemental-public-key-record\" id=\"ref-for-credential-record-supplemental-public-key-record④\">supplemental public key record</a> to <var>credentialRecord</var>.<a data-link-type=\"abstract-op\" href=\"https://w3c.github.io/webauthn/#abstract-opdef-credential-record-supplementalpubkeys\" id=\"ref-for-abstract-opdef-credential-record-supplementalpubkeys③\">supplementalPubKeys</a>.</p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-validate-capabilities\" id=\"ref-for-dfn-validate-capabilities\">validating capabilities</a>, the extension-specific substeps to validate <code>\"webauthn:virtualAuthenticators\"</code> with <code>value</code> are the following:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code>value</code> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean\">boolean</a> return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error\">WebDriver Error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Otherwise, let <code>deserialized</code> be set to <code>value</code>.</p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-matching-capabilities\" id=\"ref-for-dfn-matching-capabilities\">matching capabilities</a>, the extension-specific steps to match <code>\"webauthn:virtualAuthenticators\"</code> with <code>value</code> are the following:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code>value</code> is <code>true</code> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-endpoint-node\" id=\"ref-for-dfn-endpoint-node①\">endpoint node</a> does not support any of the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators①\">Virtual Authenticators</a> commands,\nthe match is unsuccessful.</p>"
        },
        {
          "html": "<p>Otherwise, the match is successful.</p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-validate-capabilities\" id=\"ref-for-dfn-validate-capabilities①\">validating capabilities</a>, the extension-specific substeps to validate an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-capabilities\" id=\"ref-for-authenticator-extension-capabilities\">authenticator extension capability</a> <code>key</code> with <code>value</code> are the following:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code>value</code> is not a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#boolean\" id=\"ref-for-boolean①\">boolean</a> return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①\">WebDriver Error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Otherwise, let <code>deserialized</code> be set to <code>value</code>.</p>"
        }
      ]
    },
    {
      "html": "When <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-matching-capabilities\" id=\"ref-for-dfn-matching-capabilities①\">matching capabilities</a>, the extension-specific steps to match an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension-capabilities\" id=\"ref-for-authenticator-extension-capabilities①\">authenticator extension capability</a> <code>key</code> with <code>value</code> are the following:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <code>value</code> is <code>true</code> and the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-endpoint-node\" id=\"ref-for-dfn-endpoint-node⑤\">endpoint node</a> WebAuthn WebDriver implementation does not support the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-extension\" id=\"ref-for-authenticator-extension①⑤\">authenticator extension</a> identified by the <code>key</code>,\nthe match is unsuccessful.</p>"
        },
        {
          "html": "<p>Otherwise, the match is successful.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-url-entry-object\" id=\"ref-for-blob-url-entry-object①\">Object</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>authenticator</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators①④\">Virtual Authenticator</a>.</p>"
        },
        {
          "html": "For each enumerable <a data-link-type=\"dfn\" href=\"https://tc39.github.io/ecma262/#sec-own-property\" id=\"ref-for-sec-own-property\">own property</a> in <var>parameters</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>key</var> be the name of the property.</p>"
            },
            {
              "html": "<p>Let <var>value</var> be the result of <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-getting-properties\" id=\"ref-for-dfn-getting-properties\">getting a property</a> named <var>key</var> from <var>parameters</var>.</p>"
            },
            {
              "html": "<p>If there is no matching <code>key</code> for <var>key</var> in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-configuration\" id=\"ref-for-authenticator-configuration①\">Authenticator Configuration</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error③\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code③\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument③\">invalid argument</a>.</p>"
            },
            {
              "html": "<p>If <var>value</var> is not one of the <code>valid values</code> for that <var>key</var>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error④\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code④\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument④\">invalid argument</a>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-set-a-property\" id=\"ref-for-dfn-set-a-property\">Set a property</a> <var>key</var> to <var>value</var> on <var>authenticator</var>.</p>"
            }
          ]
        },
        {
          "html": "For each property in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-configuration\" id=\"ref-for-authenticator-configuration②\">Authenticator Configuration</a> with a default defined:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code>key</code> is not a defined property of <var>authenticator</var>, <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-set-a-property\" id=\"ref-for-dfn-set-a-property①\">set a property</a> <code>key</code> to <code>default</code> on <var>authenticator</var>.</p>"
            }
          ]
        },
        {
          "html": "For each property in <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticator-configuration\" id=\"ref-for-authenticator-configuration③\">Authenticator Configuration</a>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <code>key</code> is not a defined property of <var>authenticator</var>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑤\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑤\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑤\">invalid argument</a>.</p>"
            }
          ]
        },
        {
          "html": "For each <var>extension</var> in <var>authenticator</var>.<var>extensions</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>extension</var> is not an <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#extension-identifier\" id=\"ref-for-extension-identifier②④\">extension identifier</a> supported by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-endpoint-node\" id=\"ref-for-dfn-endpoint-node⑥\">endpoint node</a> WebAuthn WebDriver implementation,\nreturn a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑥\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑥\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-unsupported-operation\" id=\"ref-for-dfn-unsupported-operation\">unsupported operation</a>.</p>"
            }
          ]
        },
        {
          "html": "<p>Generate a valid unique <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#authenticatorid\" id=\"ref-for-authenticatorid\">authenticatorId</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-set-a-property\" id=\"ref-for-dfn-set-a-property②\">Set a property</a> <code>authenticatorId</code> to <var>authenticatorId</var> on <var>authenticator</var>.</p>"
        },
        {
          "html": "<p>Store <var>authenticator</var> in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database\">Virtual Authenticator Database</a>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success\">success</a> with data <var>authenticatorId</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps②\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators①⑥\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database①\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑦\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑦\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Remove the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators①⑦\">Virtual Authenticator</a> identified by <var>authenticatorId</var> from the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database②\">Virtual Authenticator Database</a></p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success①\">success</a>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps④\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-url-entry-object\" id=\"ref-for-blob-url-entry-object③\">Object</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑧\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑧\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>credentialId</var> be the result of decoding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding②③\">Base64url Encoding</a> on the <var>parameters</var>’ <var>credentialId</var> property.</p>"
        },
        {
          "html": "<p>If <var>credentialId</var> is failure, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error⑨\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code⑨\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>isResidentCredential</var> be the <var>parameters</var>’ <var>isResidentCredential</var> property.</p>"
        },
        {
          "html": "<p>If <var>isResidentCredential</var> is not defined, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⓪\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⓪\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>rpId</var> be the <var>parameters</var>’ <var>rpId</var> property.</p>"
        },
        {
          "html": "<p>If <var>rpId</var> is not a valid <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#rp-id\" id=\"ref-for-rp-id④⑨\">RP ID</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①①\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①①\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⓪\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>privateKey</var> be the result of decoding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding②④\">Base64url Encoding</a> on the <var>parameters</var>’ <var>privateKey</var> property.</p>"
        },
        {
          "html": "<p>If <var>privateKey</var> is failure, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①②\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①②\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>privateKey</var> is not a validly-encoded asymmetric key package containing a single ECDSA private key on the P-256\n curve per <a data-link-type=\"biblio\" href=\"https://w3c.github.io/webauthn/#biblio-rfc5958\" title=\"Asymmetric Key Packages\">[RFC5958]</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①③\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①③\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①②\">invalid argument</a>.</p>"
        },
        {
          "html": "If the <var>parameters</var>’ <var>userHandle</var> property is defined:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>userHandle</var> be the result of decoding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding②⑤\">Base64url Encoding</a> on the <var>parameters</var>’ <var>userHandle</var> property.</p>"
            },
            {
              "html": "<p>If <var>userHandle</var> is failure, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①④\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①④\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①③\">invalid argument</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If <var>isResidentCredential</var> is <code>true</code>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑤\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑤\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①④\">invalid argument</a>.</p>"
            },
            {
              "html": "<p>Let <var>userHandle</var> be <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators②①\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database③\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑥\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑥\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>authenticator</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators②②\">Virtual Authenticator</a> matched by <var>authenticatorId</var>.</p>"
        },
        {
          "html": "<p>If <var>isResidentCredential</var> is <code>true</code> and the <var>authenticator</var>’s <var>hasResidentKey</var> property is <code>false</code>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑦\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑦\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "If the <var>authenticator</var> supports the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#largeblob\" id=\"ref-for-largeblob③\">largeBlob</a> extension and the <var>parameters</var>’ <var>largeBlob</var> feature is defined:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>largeBlob</var> be the result of decoding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#base64url-encoding\" id=\"ref-for-base64url-encoding②⑥\">Base64url Encoding</a> on the <var>parameters</var>’ <var>largeBlob</var> property.</p>"
            },
            {
              "html": "<p>If <var>largeBlob</var> is failure, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑧\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑧\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑦\">invalid argument</a>.</p>"
            }
          ]
        },
        {
          "html": "Otherwise:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>largeBlob</var> be <code>null</code>.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>backupEligibility</var> be the <var>parameters</var>’ <var>backupEligibility</var> property.</p>"
        },
        {
          "html": "<p>If <var>backupEligibility</var> is not defined, set <var>backupEligibility</var> to the value of the <var>authenticator</var>’s <var>defaultBackupEligibility</var>.</p>"
        },
        {
          "html": "<p>Let <var>backupState</var> be the <var>parameters</var>’ <var>backupState</var> property.</p>"
        },
        {
          "html": "<p>If <var>backupState</var> is not defined, set <var>backupState</var> to the value of the <var>authenticator</var>’s <var>defaultBackupState</var>.</p>"
        },
        {
          "html": "<p>Let <var>credential</var> be a new <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#client-side-discoverable-public-key-credential-source\" id=\"ref-for-client-side-discoverable-public-key-credential-source⑦\">Client-side discoverable Public Key Credential Source</a> if <var>isResidentCredential</var> is <code>true</code> or a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#server-side-public-key-credential-source\" id=\"ref-for-server-side-public-key-credential-source②\">Server-side Public Key Credential Source</a> otherwise whose items are:</p>\n     <dl>\n      <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-type\" id=\"ref-for-public-key-credential-source-type④\">type</a>\n      </dt><dd data-md=\"\">\n       <p><code class=\"idl\"><a data-link-type=\"idl\" href=\"https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key\" id=\"ref-for-dom-publickeycredentialtype-public-key⑥\">public-key</a></code></p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-id\" id=\"ref-for-public-key-credential-source-id⑦\">id</a>\n      </dt><dd data-md=\"\">\n       <p><var>credentialId</var></p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-privatekey\" id=\"ref-for-public-key-credential-source-privatekey③\">privateKey</a>\n      </dt><dd data-md=\"\">\n       <p><var>privateKey</var></p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-rpid\" id=\"ref-for-public-key-credential-source-rpid⑨\">rpId</a>\n      </dt><dd data-md=\"\">\n       <p><var>rpId</var></p>\n      </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source-userhandle\" id=\"ref-for-public-key-credential-source-userhandle⑥\">userHandle</a>\n      </dt><dd data-md=\"\">\n       <p><var>userHandle</var></p>\n     </dd></dl>"
        },
        {
          "html": "<p>Set the <var>credential</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-eligibility\" id=\"ref-for-backup-eligibility⑦\">backup eligibility</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-properties\" id=\"ref-for-credential-properties⑥\">credential property</a> to <var>backupEligibility</var>.</p>"
        },
        {
          "html": "<p>Set the <var>credential</var>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-state\" id=\"ref-for-backup-state⑧\">backup state</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-properties\" id=\"ref-for-credential-properties⑦\">credential property</a> to <var>backupState</var>.</p>"
        },
        {
          "html": "<p>Associate a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#signature-counter\" id=\"ref-for-signature-counter②⑤\">signature counter</a> <var>counter</var> to the <var>credential</var> with a starting value equal to the <var>parameters</var>’ <var>signCount</var> or <code>0</code> if <var>signCount</var> is <code>null</code>.</p>"
        },
        {
          "html": "<p>If <var>largeBlob</var> is not <code>null</code>, set the <a data-link-type=\"dfn\" href=\"https://fidoalliance.org/specs/fido-v2.1-ps-20210615/fido-client-to-authenticator-protocol-v2.1-ps-errata-20220621.html#authenticatorLargeBlobs\" id=\"ref-for-authenticatorLargeBlobs②\">large, per-credential blob</a> associated to the <var>credential</var> to <var>largeBlob</var>.</p>"
        },
        {
          "html": "<p>Store the <var>credential</var> and <var>counter</var> in the database of the <var>authenticator</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success②\">success</a>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑤\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators②④\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database④\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error①⑨\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code①⑨\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑧\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>credentialsArray</var> be an empty array.</p>"
        },
        {
          "html": "<p>For each <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑧⓪\">Public Key Credential Source</a> <var>credential</var>, managed by the authenticator identified by <var>authenticatorId</var>,\nconstruct a corresponding <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-parameters\" id=\"ref-for-credential-parameters②\">Credential Parameters</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-url-entry-object\" id=\"ref-for-blob-url-entry-object④\">Object</a> and add it to <var>credentialsArray</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success③\">success</a> with data containing <var>credentialsArray</var>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑥\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators②⑥\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database⑤\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②⓪\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⓪\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument①⑨\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>authenticator</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators②⑦\">Virtual Authenticator</a> identified by <var>authenticatorId</var>.</p>"
        },
        {
          "html": "<p>If <var>credentialId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑧②\">Public Key Credential Source</a> managed by <var>authenticator</var>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②①\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②①\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⓪\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Remove the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑧③\">Public Key Credential Source</a> identified by <var>credentialId</var> managed by <var>authenticator</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success④\">success</a>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑦\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators②⑨\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database⑥\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②②\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②②\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②①\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Remove all <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑧⑤\">Public Key Credential Sources</a> managed by the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators③⓪\">Virtual Authenticator</a> identified by <var>authenticatorId</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑤\">success</a>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps⑧\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-url-entry-object\" id=\"ref-for-blob-url-entry-object⑤\">Object</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②③\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②③\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②②\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators③②\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database⑦\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②④\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②④\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②③\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>isUserVerified</var> is not a defined property of <var>parameters</var>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②⑤\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑤\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②④\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>authenticator</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators③③\">Virtual Authenticator</a> identified by <var>authenticatorId</var>.</p>"
        },
        {
          "html": "<p>Set the <var>authenticator</var>’s <var>isUserVerified</var> property to the <var>parameters</var>’ <var>isUserVerified</var> property.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑥\">success</a>.</p>"
        }
      ]
    },
    {
      "html": "The <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-remote-end-steps\" id=\"ref-for-dfn-remote-end-steps①⓪\">remote end steps</a> are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>parameters</var> is not a JSON <a data-link-type=\"dfn\" href=\"https://w3c.github.io/FileAPI/#blob-url-entry-object\" id=\"ref-for-blob-url-entry-object⑦\">Object</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②⑥\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑥\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑤\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>If <var>authenticatorId</var> does not match any <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticators\" id=\"ref-for-virtual-authenticators③⑤\">Virtual Authenticator</a> stored in the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#virtual-authenticator-database\" id=\"ref-for-virtual-authenticator-database⑧\">Virtual Authenticator\n Database</a>, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②⑦\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑦\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑥\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>credential</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#public-key-credential-source\" id=\"ref-for-public-key-credential-source⑧⑦\">public key credential source</a> managed by <var>authenticator</var> matched by <var>credentialId</var>.</p>"
        },
        {
          "html": "<p>If <var>credential</var> is empty, return a <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error\" id=\"ref-for-dfn-error②⑧\">WebDriver error</a> with <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-error-code\" id=\"ref-for-dfn-error-code②⑧\">WebDriver error code</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-invalid-argument\" id=\"ref-for-dfn-invalid-argument②⑦\">invalid argument</a>.</p>"
        },
        {
          "html": "<p>Let <var>backupEligibility</var> be the <var>parameters</var>’ <var>backupEligibility</var> property.</p>"
        },
        {
          "html": "<p>If <var>backupEligibility</var> is defined, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-eligibility\" id=\"ref-for-backup-eligibility⑨\">backup eligibility</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-properties\" id=\"ref-for-credential-properties①①\">credential property</a> of <var>credential</var> to the value of <var>backupEligibility</var>.</p>"
        },
        {
          "html": "<p>Let <var>backupState</var> be the <var>parameters</var>’ <var>backupState</var> property.</p>"
        },
        {
          "html": "<p>If <var>backupState</var> is defined, set the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#backup-state\" id=\"ref-for-backup-state①⓪\">backup state</a> <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webauthn/#credential-properties\" id=\"ref-for-credential-properties①②\">credential property</a> of <var>credential</var> to the value of <var>backupState</var>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"dfn\" href=\"https://w3c.github.io/webdriver/#dfn-success\" id=\"ref-for-dfn-success⑦\">success</a>.</p>"
        }
      ]
    }
  ]
}
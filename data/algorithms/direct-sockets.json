{
  "spec": {
    "title": "Direct Sockets API",
    "url": "https://wicg.github.io/direct-sockets/"
  },
  "algorithms": [
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document<!---0.252779%--></a> is\n          not <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use<!---0.252779%--></a> the <a data-link-type=\"dfn|abstract-op\" data-cite=\"permissions-policy\" data-cite-path=\"/\" data-cite-frag=\"policy-controlled-feature\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature<!---0.252779%--></a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-1\"><code>direct-sockets<!---0.252779%--></code></a>\", throw a\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"notallowederror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOptions\" data-xref-for=\"TCPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketoptions-keepalivedelay\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketoptions-keepalivedelay-1\"><code>keepAliveDelay<!---0.252779%--></code></a><!---0.252779%-->\"] is less than 1,000, throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOptions\" data-xref-for=\"TCPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketoptions-sendbuffersize\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketoptions-sendbuffersize-1\"><code>sendBufferSize<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOptions\" data-xref-for=\"TCPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketoptions-receivebuffersize\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketoptions-receivebuffersize-1\"><code>receiveBufferSize<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0, throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to open a TCP socket using the given <var>remoteAddress<!---0.252779%--></var> and\n              <var>remotePort<!---0.252779%--></var> and the connection parameters (or their defaults) specified in <var>options<!---0.252779%--></var>."
            },
            {
              "html": "If this fails for any reason, <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-1\">TCPSocket task source<!---0.252779%--></a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> the <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> the <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                }
              ]
            },
            {
              "html": "On success, <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-2\">TCPSocket task source<!---0.252779%--></a> to run the\n              following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize TCPSocket readable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-tcpsocket-readable-stream-1\">Initialize<!---0.252779%--></a> <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize TCPSocket writable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-tcpsocket-writable-stream-1\">Initialize<!---0.252779%--></a> <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-1\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Let <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-2\"><code>TCPSocketOpenInfo<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Set <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-readable\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-readable-3\"><code>readable<!---0.252779%--></code></a><!---0.252779%-->\"] to\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-2\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Set <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-writable\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-writable-3\"><code>writable<!---0.252779%--></code></a><!---0.252779%-->\"] to\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-2\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Populate the remaining fields of <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var> using the information provided by the\n                  operating system:\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-remoteaddress-1\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"],\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-remoteport-1\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"],\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-localaddress-1\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n                  <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPSocketOpenInfo\" data-xref-for=\"TCPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocketopeninfo-localport-1\"><code>localPort<!---0.252779%--></code></a><!---0.252779%-->\"]."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-2\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <var data-type=\"TCPSocketOpenInfo\">openInfo<!---0.252779%--></var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream\" data-type=\"interface\" href=\"https://streams.spec.whatwg.org/#readablestream\"><code>ReadableStream<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var>pullAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>desiredSize<!---0.252779%--></var> be the\n              <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-desired-size-to-fill-up-to-the-high-water-mark\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-desired-size-to-fill-up-to-the-high-water-mark\">desired size to fill up to the high water mark<!---0.252779%--></a> for\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-4\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
            },
            {
              "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-5\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-current-byob-request-view\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view<!---0.252779%--></a>\n              is non-null, then set <var>desiredSize<!---0.252779%--></var> to <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-6\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->'s\n              <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-current-byob-request-view\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"BufferSource\" data-xref-for=\"BufferSource\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"buffersource-byte-length\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#buffersource-byte-length\">byte length<!---0.252779%--></a>."
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to read up to <var>desiredSize<!---0.252779%--></var> bytes from the socket,\n                  placing the result in the <a data-link-type=\"dfn|abstract-op\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"byte-sequence\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\">byte sequence<!---0.252779%--></a> <var>bytes<!---0.252779%--></var>."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-3\">TCPSocket task source<!---0.252779%--></a> to run the\n                  following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the connection was closed gracefully, run the following steps:",
                      "rationale": "invoke",
                      "steps": [
                        {
                          "html": "Invoke <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-close\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\">close<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-7\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-readable-stream-1\">handle closing the TCPSocket readable stream<!---0.252779%--></a>."
                        }
                      ]
                    },
                    {
                      "html": "If no errors were encountered, then:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-8\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->'s\n                          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-current-byob-request-view\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view<!---0.252779%--></a> is non-null,\n                          then <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ArrayBufferView\" data-xref-for=\"ArrayBufferView\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"arraybufferview-write\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#arraybufferview-write\">write<!---0.252779%--></a> <var>bytes<!---0.252779%--></var> into\n                          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-9\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->'s\n                          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-current-byob-request-view\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view<!---0.252779%--></a>, and set\n                          <var>view<!---0.252779%--></var> to <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-10\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->'s\n                          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-current-byob-request-view\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-current-byob-request-view\">current BYOB request view<!---0.252779%--></a>."
                        },
                        {
                          "html": "Otherwise, set <var>view<!---0.252779%--></var> to the result of\n                          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ArrayBufferView\" data-xref-for=\"ArrayBufferView\" data-lt=\"create\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"arraybufferview-create\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#arraybufferview-create\">creating<!---0.252779%--></a> a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"Uint8Array\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-Uint8Array\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\"><code>Uint8Array<!---0.252779%--></code></a><!---0.252779%--> from\n                          <var>bytes<!---0.252779%--></var> in <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-realm\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\">relevant Realm<!---0.252779%--></a>."
                        },
                        {
                          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-enqueue\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\">Enqueue<!---0.252779%--></a> <var>view<!---0.252779%--></var> into\n                          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-11\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                        }
                      ]
                    },
                    {
                      "html": "If a network or operating system error was encountered, invoke\n                      <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-error\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\">error<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-12\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with\n                      a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%--> and invoke the steps\n                      to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-readable-stream-2\">handle closing the TCPSocket readable stream<!---0.252779%--></a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "Let <var>cancelAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-readable-stream-3\">handle closing the TCPSocket readable stream<!---0.252779%--></a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support\">Set up with byte reading support<!---0.252779%--></a> <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> with\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream/set up with byte reading support\" data-xref-for=\"ReadableStream/set up with byte reading support\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support-pullalgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support-pullalgorithm\">pullAlgorithm<!---0.252779%--></a></i>\n          set to <var>pullAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream/set up with byte reading support\" data-xref-for=\"ReadableStream/set up with byte reading support\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support-cancelalgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support-cancelalgorithm\">cancelAlgorithm<!---0.252779%--></a></i>\n          set to <var>cancelAlgorithm<!---0.252779%--></var>, and\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream/set up with byte reading support\" data-xref-for=\"ReadableStream/set up with byte reading support\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-with-byte-reading-support-highwatermark\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-with-byte-reading-support-highwatermark\">highWaterMark<!---0.252779%--></a></i>\n          set to an implementation-defined value."
        },
        {
          "html": "Set <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-13\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> to <var data-type=\"ReadableStream\">stream<!---0.252779%--></var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-3\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-4\">TCPSocket task source<!---0.252779%--></a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-4\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-2\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-5\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-14\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-3\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-15\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-4\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <code>undefined<!---0.252779%--></code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"WritableStream\">stream<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream\" data-type=\"interface\" href=\"https://streams.spec.whatwg.org/#writablestream\"><code>WritableStream<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> be <var data-type=\"WritableStream\">stream<!---0.252779%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-signal\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-signal\">signal<!---0.252779%--></a>."
        },
        {
          "html": "Let <var>writeAlgorithm<!---0.252779%--></var> be the following steps, given <var>chunk<!---0.252779%--></var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise<!---0.252779%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise<!---0.252779%--></a>."
            },
            {
              "html": "Assert: <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> is not <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-aborted\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted<!---0.252779%--></a>."
            },
            {
              "html": "If <var>chunk<!---0.252779%--></var> cannot be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value<!---0.252779%--></a> of type\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"BufferSource\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"BufferSource\" data-type=\"typedef\" href=\"https://webidl.spec.whatwg.org/#BufferSource\"><code>BufferSource<!---0.252779%--></code></a><!---0.252779%-->, reject <var data-type=\"Promise\">promise<!---0.252779%--></var> with a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%--> and return\n              <var data-type=\"Promise\">promise<!---0.252779%--></var>. Otherwise, save the result of the conversion in\n              <var data-type=\"BufferSource\">source<!---0.252779%--></var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-get-buffer-source-copy\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-get-buffer-source-copy\">Get a copy of the buffer source<!---0.252779%--></a> <var data-type=\"BufferSource\">source<!---0.252779%--></var> and save the result in\n              <var>bytes<!---0.252779%--></var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">In parallel<!---0.252779%--></a>, run the following steps:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to write <var>bytes<!---0.252779%--></var> to the socket."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-5\">TCPSocket task source<!---0.252779%--></a> to run the\n                  following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the chunk was successfully written, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var> with <code>undefined<!---0.252779%--></code>."
                    },
                    {
                      "html": "If a network or operating system error was encountered:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-writable-stream-1\">handle closing the TCPSocket writable stream<!---0.252779%--></a>."
                        }
                      ]
                    },
                    {
                      "html": "If <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> is <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-aborted\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted<!---0.252779%--></a>, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var>\n                      with <var data-type=\"AbortSignal\">signal<!---0.252779%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-abort-reason\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\">abort reason<!---0.252779%--></a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise<!---0.252779%--></var>."
            }
          ]
        },
        {
          "html": "Let <var>abortAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise<!---0.252779%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise<!---0.252779%--></a>."
            },
            {
              "html": "Run the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to shutdown the socket for writing."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-6\">TCPSocket task source<!---0.252779%--></a> to run the\n                  following steps:",
                  "rationale": "invoke",
                  "steps": [
                    {
                      "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-writable-stream-2\">handle closing the TCPSocket writable stream<!---0.252779%--></a>."
                    },
                    {
                      "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var> with <code>undefined<!---0.252779%--></code>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise<!---0.252779%--></var>."
            }
          ]
        },
        {
          "html": "Let <var>closeAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise<!---0.252779%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise<!---0.252779%--></a>."
            },
            {
              "html": "Run the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to shutdown the socket for writing."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-7\">TCPSocket task source<!---0.252779%--></a> to run the\n                  following steps:",
                  "rationale": "invoke",
                  "steps": [
                    {
                      "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpsocket-writable-stream-3\">handle closing the TCPSocket writable stream<!---0.252779%--></a>."
                    },
                    {
                      "html": "If <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> is <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-aborted\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted<!---0.252779%--></a>, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var>\n                      with <var data-type=\"AbortSignal\">signal<!---0.252779%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-abort-reason\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\">abort reason<!---0.252779%--></a>."
                    },
                    {
                      "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var> with <code>undefined<!---0.252779%--></code>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise<!---0.252779%--></var>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up\">Set up<!---0.252779%--></a> <var data-type=\"WritableStream\">stream<!---0.252779%--></var> with\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-writealgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm\">writeAlgorithm<!---0.252779%--></a></i>\n          set to <var>writeAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-abortalgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm\">abortAlgorithm<!---0.252779%--></a></i>\n          set to <var>abortAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-closealgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm\">closeAlgorithm<!---0.252779%--></a></i>\n          set to <var>closeAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-highwatermark\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-highwatermark\">highWaterMark<!---0.252779%--></a></i>\n          set to an implementation-defined value."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-add\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\">Add<!---0.252779%--></a> the following abort steps to <var data-type=\"AbortSignal\">signal<!---0.252779%--></var>:",
          "rationale": "cause",
          "steps": [
            {
              "html": "Cause any invocation of the operating system to write to the\n              socket to return as soon as possible no matter how much data has\n              been written."
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-7\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> to <var data-type=\"WritableStream\">stream<!---0.252779%--></var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-16\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpsocket-task-source-8\">TCPSocket task source<!---0.252779%--></a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-17\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-5\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-18\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-8\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-6\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-9\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-7\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <code>undefined<!---0.252779%--></code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-4\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is rejected or not yet resolved, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a>\n          with\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-9\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is settled, return\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-10\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-21\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> or <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-12\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> are <a href=\"https://streams.spec.whatwg.org/#lock\">locked</a>,\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var data-type=\"Promise\">cancelPromise<!---0.252779%--></var> be the result of invoking\n          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-cancel\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\">cancel<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable\" class=\"internalDFN\" id=\"ref-for-dfn-readable-22\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Set <var data-type=\"Promise\">cancelPromise<!---0.252779%--></var>.[[PromiseIsHandled]] to true."
        },
        {
          "html": "Let <var data-type=\"Promise\">abortPromise<!---0.252779%--></var> be the result of invoking\n          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-abort\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-abort\">abort<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable\" class=\"internalDFN\" id=\"ref-for-dfn-writable-13\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Set <var data-type=\"Promise\">abortPromise<!---0.252779%--></var>.[[PromiseIsHandled]] to true."
        },
        {
          "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPSocket\" data-xref-for=\"TCPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-11\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document<!---0.252779%--></a> is\n          not <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use<!---0.252779%--></a> the <a data-link-type=\"dfn|abstract-op\" data-cite=\"permissions-policy\" data-cite-path=\"/\" data-cite-frag=\"policy-controlled-feature\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature<!---0.252779%--></a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-2\"><code>direct-sockets<!---0.252779%--></code></a>\", throw a\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"notallowederror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If only one of <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteaddress-2\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n          <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteport-2\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"] is specified, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Alternatively, if both <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteaddress-3\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n          <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-remoteport-3\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"] are specified, assume <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-2\"><code>connected<!---0.252779%--></code></a><!---0.252779%-->\n          <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-7\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localport-1\"><code>localPort<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0 or specified without\n          <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-2\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"], throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-3\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] is specified:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-3\"><code>connected<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-8\"><code>mode<!---0.252779%--></code></a><!---0.252779%--> was previously inferred, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
            },
            {
              "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-4\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] is not a valid IP address,\n              throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
            },
            {
              "html": "Assume <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-2\"><code>bound<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-9\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->."
            }
          ]
        },
        {
          "html": "If no <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-10\"><code>mode<!---0.252779%--></code></a><!---0.252779%--> has been inferred at this point, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-dnsquerytype\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-dnsquerytype-1\"><code>dnsQueryType<!---0.252779%--></code></a><!---0.252779%-->\"] is specified in <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-3\"><code>bound<!---0.252779%--></code></a><!---0.252779%-->\n          <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-11\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-ipv6only\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-ipv6only-1\"><code>ipv6Only<!---0.252779%--></code></a><!---0.252779%-->\"] is specified:",
          "rationale": "if",
          "steps": [
            {
              "html": "If inferred <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-12\"><code>mode<!---0.252779%--></code></a><!---0.252779%--> is <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-4\"><code>connected<!---0.252779%--></code></a><!---0.252779%-->, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
            },
            {
              "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-localaddress-5\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] is not equal to the IPv6\n              unspecified address (<code>::<!---0.252779%--></code>), throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
            }
          ]
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-sendbuffersize\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-sendbuffersize-1\"><code>sendBufferSize<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOptions\" data-xref-for=\"UDPSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketoptions-receivebuffersize\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketoptions-receivebuffersize-1\"><code>receiveBufferSize<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0, throw a\n          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to open a UDP socket using the inferred\n              <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-13\"><code>mode<!---0.252779%--></code></a><!---0.252779%--> and the parameters (or their defaults) specified in <var>options<!---0.252779%--></var>."
            },
            {
              "html": "If this fails for any reason, <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-1\">UDPSocket task source<!---0.252779%--></a> to run the following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> the <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-1\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> the <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-1\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                }
              ]
            },
            {
              "html": "On success, <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-2\">UDPSocket task source<!---0.252779%--></a> to run the following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize UDPSocket readable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-udpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-udpsocket-readable-stream-1\">Initialize<!---0.252779%--></a> <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-1\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize UDPSocket writable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-udpsocket-writable-stream-1\">Initialize<!---0.252779%--></a> <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-1\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Let <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-2\"><code>UDPSocketOpenInfo<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Set <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-readable\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-readable-3\"><code>readable<!---0.252779%--></code></a><!---0.252779%-->\"] to\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-2\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Set <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-writable\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-writable-3\"><code>writable<!---0.252779%--></code></a><!---0.252779%-->\"] to\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-2\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Populate the remaining fields of <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var> using the information provided by the\n                  operating system:\n                  <ul>\n                    <li>\n                      For <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-4\"><code>bound<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-14\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->, populate only\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localaddress-1\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localport-1\"><code>localPort<!---0.252779%--></code></a><!---0.252779%-->\"].\n                    </li><li>\n                      For <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-5\"><code>connected<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-15\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->, populate\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localaddress-2\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-localport-2\"><code>localPort<!---0.252779%--></code></a><!---0.252779%-->\"] as well as\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-remoteaddress-1\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n                      <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocketOpenInfo\" data-xref-for=\"UDPSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-udpsocketopeninfo-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpsocketopeninfo-remoteport-1\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"].\n                  </li></ul>"
                },
                {
                  "html": "Resolve <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-2\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <var data-type=\"UDPSocketOpenInfo\">openInfo<!---0.252779%--></var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream\" data-type=\"interface\" href=\"https://streams.spec.whatwg.org/#readablestream\"><code>ReadableStream<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var>pullAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>desiredSize<!---0.252779%--></var> be the\n              <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-desired-size-to-fill-up-to-the-high-water-mark\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-desired-size-to-fill-up-to-the-high-water-mark\">desired size to fill up to the high water mark<!---0.252779%--></a> for\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-9\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to provide up to <var>desiredSize<!---0.252779%--></var> UDP packets from the\n                  socket."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-3\">UDPSocket task source<!---0.252779%--></a> to run the\n                  following steps for each received packet:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If no errors were encountered, for each packet received run the following\n                      steps:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var>bytes<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"infra\" data-cite-path=\"/\" data-cite-frag=\"byte-sequence\" data-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#byte-sequence\">byte sequence<!---0.252779%--></a> containing the packet payload."
                        },
                        {
                          "html": "Let <var>buffer<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"ArrayBuffer\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-ArrayBuffer\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-ArrayBuffer\"><code>ArrayBuffer<!---0.252779%--></code></a><!---0.252779%--> created from <var>bytes<!---0.252779%--></var>."
                        },
                        {
                          "html": "Let <var>chunk<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"Uint8Array\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-Uint8Array\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-Uint8Array\"><code>Uint8Array<!---0.252779%--></code></a><!---0.252779%--> view over <var>buffer<!---0.252779%--></var>,\n                          who's length is the length of <var>bytes<!---0.252779%--></var>."
                        },
                        {
                          "html": "Let <var data-type=\"UDPMessage\">message<!---0.252779%--></var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-4\"><code>UDPMessage<!---0.252779%--></code></a><!---0.252779%-->."
                        },
                        {
                          "html": "Set <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-data\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-data-2\"><code>data<!---0.252779%--></code></a><!---0.252779%-->\"] to <var>chunk<!---0.252779%--></var>."
                        },
                        {
                          "html": "If the socket is operating in <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-9\"><code>bound<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-25\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->:",
                          "rationale": "set",
                          "steps": [
                            {
                              "html": "Set <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-2\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"] to the source address\n                              of the packet."
                            },
                            {
                              "html": "Set <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-2\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"] to the source port of the\n                              packet."
                            }
                          ]
                        },
                        {
                          "html": "Invoke <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-enqueue\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\">enqueue<!---0.252779%--></a> on\n                          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-10\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <var data-type=\"UDPMessage\">message<!---0.252779%--></var>."
                        }
                      ]
                    },
                    {
                      "html": "If a network or operating system error was encountered, invoke\n                      <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-error\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\">error<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-11\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with\n                      a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->, discard other packets and invoke the\n                      steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-readable-stream-1\">handle closing the UDPSocket readable stream<!---0.252779%--></a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "Let <var>cancelAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-readable-stream-2\">handle closing the UDPSocket readable stream<!---0.252779%--></a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\">Set up<!---0.252779%--></a> <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> with\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream/set up\" data-xref-for=\"ReadableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-pullalgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm\">pullAlgorithm<!---0.252779%--></a></i>\n          set to <var>pullAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream/set up\" data-xref-for=\"ReadableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-cancelalgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\">cancelAlgorithm<!---0.252779%--></a></i>\n          set to <var>cancelAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream/set up\" data-xref-for=\"ReadableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up-highwatermark\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark\">highWaterMark<!---0.252779%--></a></i>\n          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\">Set up<!---0.252779%--></a> <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> with\n          set to an implementation-defined value."
        },
        {
          "html": "Set <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-12\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> to <var data-type=\"ReadableStream\">stream<!---0.252779%--></var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-9\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-4\">UDPSocket task source<!---0.252779%--></a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-10\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-2\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-11\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-13\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-3\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-14\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-4\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <code>undefined<!---0.252779%--></code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"WritableStream\">stream<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream\" data-type=\"interface\" href=\"https://streams.spec.whatwg.org/#writablestream\"><code>WritableStream<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> be <var data-type=\"WritableStream\">stream<!---0.252779%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-signal\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-signal\">signal<!---0.252779%--></a>."
        },
        {
          "html": "Let <var>writeAlgorithm<!---0.252779%--></var> be the following steps, given <var>chunk<!---0.252779%--></var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var data-type=\"Promise\">promise<!---0.252779%--></var> be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-new-promise\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\">a new promise<!---0.252779%--></a>."
            },
            {
              "html": "Assert: <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> is not <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-aborted\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted<!---0.252779%--></a>."
            },
            {
              "html": "Let <var data-type=\"UDPMessage\">message<!---0.252779%--></var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-5\"><code>UDPMessage<!---0.252779%--></code></a><!---0.252779%-->."
            },
            {
              "html": "If <var>chunk<!---0.252779%--></var> cannot be <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-convert-ecmascript-to-idl-value\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-convert-ecmascript-to-idl-value\">converted to an IDL value<!---0.252779%--></a> of type\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-6\"><code>UDPMessage<!---0.252779%--></code></a><!---0.252779%-->, reject <var data-type=\"Promise\">promise<!---0.252779%--></var> with a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%--> and return\n              <var data-type=\"Promise\">promise<!---0.252779%--></var>. Otherwise, save the result of the conversion in\n              <var data-type=\"UDPMessage\">message<!---0.252779%--></var>."
            },
            {
              "html": "If either <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-3\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"],\n              <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-3\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"] or\n              <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-dnsquerytype\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-dnsquerytype-2\"><code>dnsQueryType<!---0.252779%--></code></a><!---0.252779%-->\"] <b>is specified</b> in\n              <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-10\"><code>connected<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-26\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->, reject <var data-type=\"Promise\">promise<!---0.252779%--></var> with a\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%--> and return <var data-type=\"Promise\">promise<!---0.252779%--></var>."
            },
            {
              "html": "If either <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-4\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"]\n              or <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-4\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"] <b>is not specified</b> in\n              <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-10\"><code>bound<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-27\"><code>mode<!---0.252779%--></code></a><!---0.252779%-->, reject <var data-type=\"Promise\">promise<!---0.252779%--></var> with a\n              <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%--> and return <var data-type=\"Promise\">promise<!---0.252779%--></var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"dfn-get-buffer-source-copy\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-get-buffer-source-copy\">Get a copy of the buffer source<!---0.252779%--></a> <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-data\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-data-3\"><code>data<!---0.252779%--></code></a><!---0.252779%-->\"] and save the\n              result in <var>bytes<!---0.252779%--></var>."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">In parallel<!---0.252779%--></a>, run the following steps:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to send <var>bytes<!---0.252779%--></var> to the socket.\n                  <ul>\n                    <li>\n                      In <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-connected\" class=\"internalDFN\" id=\"ref-for-dfn-connected-11\"><code>connected<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-28\"><code>mode<!---0.252779%--></code></a><!---0.252779%--> the data is routed to the\n                      address/port specified upon construction.\n                    </li><li>\n                      In <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-bound\" class=\"internalDFN\" id=\"ref-for-dfn-bound-11\"><code>bound<!---0.252779%--></code></a><!---0.252779%--> <!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" href=\"https://wicg.github.io/direct-sockets/#dfn-mode\" class=\"internalDFN\" id=\"ref-for-dfn-mode-29\"><code>mode<!---0.252779%--></code></a><!---0.252779%--> the data is routed to\n                      <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteaddress\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteaddress-5\"><code>remoteAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n                      <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-remoteport\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-remoteport-5\"><code>remotePort<!---0.252779%--></code></a><!---0.252779%-->\"].\n                      <var data-type=\"UDPMessage\">message<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"UDPMessage\" data-xref-for=\"UDPMessage\" href=\"https://wicg.github.io/direct-sockets/#dom-udpmessage-dnsquerytype\" class=\"internalDFN\" id=\"ref-for-dom-udpmessage-dnsquerytype-3\"><code>dnsQueryType<!---0.252779%--></code></a><!---0.252779%-->\"] can be optionally supplied to\n                      control whether DNS resolution routine returns an IPv4 or an IPv6 record.\n                  </li></ul>"
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-5\">UDPSocket task source<!---0.252779%--></a> to run the\n                  following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the data was successfully written, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var> with <code>undefined<!---0.252779%--></code>."
                    },
                    {
                      "html": "If a network or operating system error was encountered:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                          <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-writable-stream-1\">handle closing the UDPSocket writable stream<!---0.252779%--></a>."
                        }
                      ]
                    },
                    {
                      "html": "If <var data-type=\"AbortSignal\">signal<!---0.252779%--></var> is <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-aborted\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\">aborted<!---0.252779%--></a>, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <var data-type=\"Promise\">promise<!---0.252779%--></var>\n                      with <var data-type=\"AbortSignal\">signal<!---0.252779%--></var>'s <a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-abort-reason\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\">abort reason<!---0.252779%--></a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <var data-type=\"Promise\">promise<!---0.252779%--></var>."
            }
          ]
        },
        {
          "html": "Let <var>abortAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-writable-stream-2\">handle closing the UDPSocket writable stream<!---0.252779%--></a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "Let <var>closeAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-udpsocket-writable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-udpsocket-writable-stream-3\">handle closing the UDPSocket writable stream<!---0.252779%--></a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up\">Set up<!---0.252779%--></a> <var data-type=\"WritableStream\">stream<!---0.252779%--></var> with\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-writealgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm\">writeAlgorithm<!---0.252779%--></a></i>\n          set to <var>writeAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-abortalgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm\">abortAlgorithm<!---0.252779%--></a></i>\n          set to <var>abortAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-closealgorithm\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm\">closeAlgorithm<!---0.252779%--></a></i>\n          set to <var>closeAlgorithm<!---0.252779%--></var>,\n          <i><a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream/set up\" data-xref-for=\"WritableStream/set up\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-set-up-highwatermark\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-set-up-highwatermark\">highWaterMark<!---0.252779%--></a></i>\n          set to an implementation-defined value."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"AbortSignal\" data-xref-for=\"AbortSignal\" data-cite=\"dom\" data-cite-path=\"/\" data-cite-frag=\"abortsignal-add\" data-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\">Add<!---0.252779%--></a> the following abort steps to <var data-type=\"AbortSignal\">signal<!---0.252779%--></var>:",
          "rationale": "cause",
          "steps": [
            {
              "html": "Cause any invocation of the operating system to write to the\n              socket to return as soon as possible no matter how much data has\n              been written."
            }
          ]
        },
        {
          "html": "Set <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-13\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> to <var data-type=\"WritableStream\">stream<!---0.252779%--></var>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-15\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is active, abort these steps."
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to close the socket."
            },
            {
              "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-udpsocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-udpsocket-task-source-6\">UDPSocket task source<!---0.252779%--></a> to run the\n              following steps:\n              <ul>\n                <li>\n                  If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-16\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-5\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-17\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, if <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-14\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is errored,\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-6\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n                  with <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-15\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->.<code>[[storedPromise]]<!---0.252779%--></code>.\n                </li><li>\n                  Otherwise, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-7\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <code>undefined<!---0.252779%--></code>.\n              </li></ul>"
            }
          ]
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-0-4\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is rejected or not yet resolved, <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a>\n          with\n          \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-9\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is settled, return\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-10\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-20\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> or <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-18\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> are <a href=\"https://streams.spec.whatwg.org/#lock\">locked</a>,\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var data-type=\"Promise\">cancelPromise<!---0.252779%--></var> be the result of invoking\n          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-cancel\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\">cancel<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-0\" class=\"internalDFN\" id=\"ref-for-dfn-readable-0-21\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Set <var data-type=\"Promise\">cancelPromise<!---0.252779%--></var>.[[PromiseIsHandled]] as handled."
        },
        {
          "html": "Let <var data-type=\"Promise\">abortPromise<!---0.252779%--></var> be the result of invoking\n          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"WritableStream\" data-xref-for=\"WritableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"writablestream-abort\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#writablestream-abort\">abort<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[writable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-writable-0\" class=\"internalDFN\" id=\"ref-for-dfn-writable-0-19\"><code>[[writable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Set <var data-type=\"Promise\">abortPromise<!---0.252779%--></var>.[[PromiseIsHandled]] as handled."
        },
        {
          "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"UDPSocket\" data-xref-for=\"UDPSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-0\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-0-11\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a>'s <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/nav-history-apis.html\" data-cite-frag=\"concept-document-window\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\">associated Document<!---0.252779%--></a> is\n          not <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/iframe-embed-object.html\" data-cite-frag=\"allowed-to-use\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/iframe-embed-object.html#allowed-to-use\">allowed to use<!---0.252779%--></a> the <a data-link-type=\"dfn|abstract-op\" data-cite=\"permissions-policy\" data-cite-path=\"/\" data-cite-frag=\"policy-controlled-feature\" data-type=\"dfn\" href=\"https://www.w3.org/TR/permissions-policy-1/#policy-controlled-feature\">policy-controlled feature<!---0.252779%--></a> named \"<a data-link-type=\"dfn|abstract-op\" data-link-for=\"policy-controlled feature\" data-xref-for=\"policy-controlled feature\" href=\"https://wicg.github.io/direct-sockets/#dfn-direct-sockets\" class=\"internalDFN\" id=\"ref-for-dfn-direct-sockets-3\"><code>direct-sockets<!---0.252779%--></code></a>\", throw a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NotAllowedError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"notallowederror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#notallowederror\"><code>NotAllowedError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>localAddress<!---0.252779%--></var> is not a valid IP address, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOptions\" data-xref-for=\"TCPServerSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketoptions-localport\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketoptions-localport-1\"><code>localPort<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOptions\" data-xref-for=\"TCPServerSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketoptions-backlog\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketoptions-backlog-1\"><code>backlog<!---0.252779%--></code></a><!---0.252779%-->\"] is equal to 0, throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <var>options<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOptions\" data-xref-for=\"TCPServerSocketOptions\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketoptions-ipv6only\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketoptions-ipv6only-1\"><code>ipv6Only<!---0.252779%--></code></a><!---0.252779%-->\"] is true but <code>localAddress<!---0.252779%--></code> is not equal\n          to the IPv6 unspecified address (<code>::<!---0.252779%--></code>), throw a <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TypeError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"exceptiondef-typeerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\"><code>TypeError<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Perform the following steps <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/infrastructure.html\" data-cite-frag=\"in-parallel\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\">in parallel<!---0.252779%--></a>.",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the operating system to open a TCP server socket using the given <var>localAddress<!---0.252779%--></var>\n              and the connection parameters (or their defaults) specified in <var>options<!---0.252779%--></var>."
            },
            {
              "html": "If this fails for any reason, <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-1\">TCPServerSocket task source<!---0.252779%--></a> to run the\n              following steps:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> the <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-1\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">Reject<!---0.252779%--></a> the <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-1\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\"\n                  <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
                }
              ]
            },
            {
              "html": "On success, <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n              <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-2\">TCPServerSocket task source<!---0.252779%--></a> to run the following steps:",
              "rationale": "initialize",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-lt=\"initialize TCPServerSocket readable stream\" href=\"https://wicg.github.io/direct-sockets/#dfn-initialize-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-initialize-tcpserversocket-readable-stream-1\">Initialize<!---0.252779%--></a> <!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-1\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Let <var data-type=\"TCPServerSocketOpenInfo\">openInfo<!---0.252779%--></var> be a new <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-2\"><code>TCPServerSocketOpenInfo<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Set <var data-type=\"TCPServerSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOpenInfo\" data-xref-for=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo-readable\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-readable-2\"><code>readable<!---0.252779%--></code></a><!---0.252779%-->\"] to\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-2\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                },
                {
                  "html": "Populate the remaining fields of <var data-type=\"TCPServerSocketOpenInfo\">openInfo<!---0.252779%--></var> using the information provided by the\n                  operating system:\n                  <var data-type=\"TCPServerSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOpenInfo\" data-xref-for=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo-localaddress\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-localaddress-1\"><code>localAddress<!---0.252779%--></code></a><!---0.252779%-->\"] and\n                  <var data-type=\"TCPServerSocketOpenInfo\">openInfo<!---0.252779%--></var>[\"<!---0.252779%--><a data-link-type=\"idl\" data-xref-type=\"attribute|dict-member|const\" data-link-for=\"TCPServerSocketOpenInfo\" data-xref-for=\"TCPServerSocketOpenInfo\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpserversocketopeninfo-localport\" class=\"internalDFN\" id=\"ref-for-dom-tcpserversocketopeninfo-localport-1\"><code>localPort<!---0.252779%--></code></a><!---0.252779%-->\"]."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">Resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-2\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <var data-type=\"TCPServerSocketOpenInfo\">openInfo<!---0.252779%--></var>."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "rationale": "let",
      "steps": [
        {
          "html": "Let <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream\" data-type=\"interface\" href=\"https://streams.spec.whatwg.org/#readablestream\"><code>ReadableStream<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var>pullAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>desiredSize<!---0.252779%--></var> be the\n              <a href=\"https://streams.spec.whatwg.org/#desired-size-to-fill-a-streams-internal-queue\">desired\n                size</a>\n              of <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-4\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->'s\n              <a href=\"https://streams.spec.whatwg.org/#internal-queues\">internal queue</a>."
            },
            {
              "html": "Run the following steps in parallel:",
              "rationale": "invoke",
              "steps": [
                {
                  "html": "Invoke the operating system to accept up to <var>desiredSize<!---0.252779%--></var> incoming connections."
                },
                {
                  "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n                  <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-3\">TCPServerSocket task source<!---0.252779%--></a> to run the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If the connection was closed gracefully, run the following steps:",
                      "rationale": "invoke",
                      "steps": [
                        {
                          "html": "Invoke <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-close\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\">close<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-5\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
                        },
                        {
                          "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpserversocket-readable-stream-1\">handle closing the TCPServerSocket readable stream<!---0.252779%--></a>."
                        }
                      ]
                    },
                    {
                      "html": "If no errors were encountered run the following steps:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "Let <var>tcpSocket<!---0.252779%--></var> be a <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"new\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\">new<!---0.252779%--></a> <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"TCPSocket\" href=\"https://wicg.github.io/direct-sockets/#dom-tcpsocket\" class=\"internalDFN\" id=\"ref-for-dom-tcpsocket-3\"><code>TCPSocket<!---0.252779%--></code></a><!---0.252779%--> accepted by the operating system."
                        },
                        {
                          "html": "Invoke <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-enqueue\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\">enqueue<!---0.252779%--></a> on\n                          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-6\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with <var>tcpSocket<!---0.252779%--></var>."
                        }
                      ]
                    },
                    {
                      "html": "If a network or operating system error was encountered, invoke\n                      <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-error\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\">error<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-7\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> with\n                      a \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"NetworkError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"networkerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#networkerror\"><code>NetworkError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%--> and invoke the steps\n                      to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpserversocket-readable-stream-2\">handle closing the TCPServerSocket readable stream<!---0.252779%--></a>."
                    }
                  ]
                }
              ]
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "Let <var>cancelAlgorithm<!---0.252779%--></var> be the following steps:",
          "rationale": "invoke",
          "steps": [
            {
              "html": "Invoke the steps to <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-handle-closing-the-tcpserversocket-readable-stream\" class=\"internalDFN\" id=\"ref-for-dfn-handle-closing-the-tcpserversocket-readable-stream-3\">handle closing the TCPServerSocket readable stream<!---0.252779%--></a>."
            },
            {
              "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"a-promise-resolved-with\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-resolved-with\">a promise resolved with<!---0.252779%--></a> <code>undefined<!---0.252779%--></code>."
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-set-up\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\">Set up<!---0.252779%--></a> <var data-type=\"ReadableStream\">stream<!---0.252779%--></var> with\n          <a href=\"https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm\">pullAlgorithm</a>\n          set to <var>pullAlgorithm<!---0.252779%--></var>,\n          <a href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a>\n          set to <var>cancelAlgorithm<!---0.252779%--></var>,\n          <a href=\"https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark\">highWaterMark</a>\n          set to an implementation-defined value."
        },
        {
          "html": "Set <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-8\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> to <var data-type=\"ReadableStream\">stream<!---0.252779%--></var>."
        }
      ]
    },
    {
      "rationale": "invoke",
      "steps": [
        {
          "html": "Invoke the operating system to close the socket."
        },
        {
          "html": "<a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"queue-a-global-task\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\">Queue a global task<!---0.252779%--></a> on the <a data-link-type=\"dfn|abstract-op\" data-cite=\"html\" data-cite-path=\"/webappapis.html\" data-cite-frag=\"concept-relevant-global\" data-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\">relevant global object<!---0.252779%--></a> of\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a> using the <a data-link-type=\"dfn|abstract-op\" href=\"https://wicg.github.io/direct-sockets/#dfn-tcpserversocket-task-source\" class=\"internalDFN\" id=\"ref-for-dfn-tcpserversocket-task-source-4\">TCPServerSocket task source<!---0.252779%--></a> to\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"resolve\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\">resolve<!---0.252779%--></a> <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-2\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->\n          with <code>undefined<!---0.252779%--></code>."
        }
      ]
    },
    {
      "rationale": "if",
      "steps": [
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[openedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-openedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-openedpromise-1-4\"><code>[[openedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is rejected or not yet resolved,\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-4\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is settled, return\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-5\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "If <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-11\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%--> is <a href=\"https://streams.spec.whatwg.org/#lock\">locked</a>,\n          <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"reject\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\">reject<!---0.252779%--></a> with \"<a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"InvalidStateError\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"invalidstateerror\" data-type=\"exception\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\"><code>InvalidStateError<!---0.252779%--></code></a><!---0.252779%-->\" <a data-xref-type=\"_IDL_\" data-link-type=\"idl\" data-lt=\"DOMException\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"idl-DOMException\" data-type=\"interface\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\"><code>DOMException<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Let <var data-type=\"Promise\">cancelPromise<!---0.252779%--></var> be the result of invoking\n          <a data-link-type=\"dfn|abstract-op\" data-link-for=\"ReadableStream\" data-xref-for=\"ReadableStream\" data-cite=\"streams\" data-cite-path=\"/\" data-cite-frag=\"readablestream-cancel\" data-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-cancel\">cancel<!---0.252779%--></a> on <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[readable]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-readable-1\" class=\"internalDFN\" id=\"ref-for-dfn-readable-1-12\"><code>[[readable<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        },
        {
          "html": "Set <var data-type=\"Promise\">cancelPromise<!---0.252779%--></var>.[[PromiseIsHandled]] to true."
        },
        {
          "html": "Return <a data-link-type=\"dfn|abstract-op\" data-cite=\"webidl\" data-cite-path=\"/\" data-cite-frag=\"this\" data-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\">this<!---0.252779%--></a>.<!---0.252779%--><a data-xref-type=\"attribute\" data-link-type=\"attribute\" data-link-for=\"TCPServerSocket\" data-xref-for=\"TCPServerSocket\" data-lt=\"[[closedPromise]]\" href=\"https://wicg.github.io/direct-sockets/#dfn-closedpromise-1\" class=\"internalDFN\" id=\"ref-for-dfn-closedpromise-1-6\"><code>[[closedPromise<!---0.252779%-->]]<!---0.252779%--></code></a><!---0.252779%-->."
        }
      ]
    }
  ]
}